<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
		<head>
			<!-- template designed by Marco Von Ballmoos -->
			<title>File Source for Smarty_Compiler.class.php</title>
			<link rel="stylesheet" href="../media/stylesheet.css" />
			<meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
		</head>
		<body>
						<h1>Source for file Smarty_Compiler.class.php</h1>
<p>Documentation is available at <a href="../lib/smarty/_smarty_Smarty_Compiler_class_php.html">Smarty_Compiler.class.php</a></p>
<div class="src-code">
<pre><ol><li><a name="a1"></a><span class="src-php">&lt;?php</span></li>
<li><a name="a2"></a><span class="src-doc">/**</span></li>
<li><a name="a3"></a><span class="src-doc"> * smarty页面处理编译类</span></li>
<li><a name="a4"></a><span class="src-doc"> * </span></li>
<li><a name="a5"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@package</span><span class="src-doc"> lib</span></li>
<li><a name="a6"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@subpackage</span><span class="src-doc"> smarty</span></li>
<li><a name="a7"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@author</span><span class="src-doc"> 张立冰 &lt;roast@php.net&gt;</span></li>
<li><a name="a8"></a><span class="src-doc"> * </span></li>
<li><a name="a9"></a><span class="src-doc"> *  $Id: Smarty_Compiler.class.php 1 2008-08-14 10:05:35Z libing $</span></li>
<li><a name="a10"></a><span class="src-doc"> */</span></li>
<li><a name="a11"></a>&nbsp;</li>
<li><a name="a12"></a><span class="src-doc">/**</span></li>
<li><a name="a13"></a><span class="src-doc"> * Project:     Smarty: the PHP compiling template engine</span></li>
<li><a name="a14"></a><span class="src-doc"> * File:        Smarty_Compiler.class.php</span></li>
<li><a name="a15"></a><span class="src-doc"> *</span></li>
<li><a name="a16"></a><span class="src-doc"> * This library is free software; you can redistribute it and/or</span></li>
<li><a name="a17"></a><span class="src-doc"> * modify it under the terms of the GNU Lesser General Public</span></li>
<li><a name="a18"></a><span class="src-doc"> * License as published by the Free Software Foundation; either</span></li>
<li><a name="a19"></a><span class="src-doc"> * version 2.1 of the License, or (at your option) any later version.</span></li>
<li><a name="a20"></a><span class="src-doc"> *</span></li>
<li><a name="a21"></a><span class="src-doc"> * This library is distributed in the hope that it will be useful,</span></li>
<li><a name="a22"></a><span class="src-doc"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></li>
<li><a name="a23"></a><span class="src-doc"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></li>
<li><a name="a24"></a><span class="src-doc"> * Lesser General Public License for more details.</span></li>
<li><a name="a25"></a><span class="src-doc"> *</span></li>
<li><a name="a26"></a><span class="src-doc"> * You should have received a copy of the GNU Lesser General Public</span></li>
<li><a name="a27"></a><span class="src-doc"> * License along with this library; if not, write to the Free Software</span></li>
<li><a name="a28"></a><span class="src-doc"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span></li>
<li><a name="a29"></a><span class="src-doc"> *</span></li>
<li><a name="a30"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@link</span><span class="src-doc"> http://smarty.php.net/</span></li>
<li><a name="a31"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@author</span><span class="src-doc"> Monte Ohrt &lt;monte at ohrt dot com&gt;</span></li>
<li><a name="a32"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@author</span><span class="src-doc"> Andrei Zmievski &lt;andrei@php.net&gt;</span></li>
<li><a name="a33"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@version</span><span class="src-doc"> 2.6.10</span></li>
<li><a name="a34"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@copyright</span><span class="src-doc"> 2001-2005 New Digital Group, Inc.</span></li>
<li><a name="a35"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@package</span><span class="src-doc"> Smarty</span></li>
<li><a name="a36"></a><span class="src-doc"> */</span></li>
<li><a name="a37"></a>&nbsp;</li>
<li><a name="a38"></a><span class="src-comm">/* $Id: Smarty_Compiler.class.php 1 2008-08-14 10:05:35Z libing $ */</span></li>
<li><a name="a39"></a>&nbsp;</li>
<li><a name="a40"></a><span class="src-doc">/**</span></li>
<li><a name="a41"></a><span class="src-doc"> * Template compiling class</span></li>
<li><a name="a42"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@package</span><span class="src-doc"> Smarty</span></li>
<li><a name="a43"></a><span class="src-doc"> */</span></li>
<li><a name="a44"></a><span class="src-key">class </span><a href="../Smarty/Smarty_Compiler.html">Smarty_Compiler</a> <span class="src-key">extends </span><a href="../Smarty/Smarty.html">Smarty</a> <span class="src-sym">{</span></li>
<li><a name="a45"></a>&nbsp;</li>
<li><a name="a46"></a>    <span class="src-comm">// internal vars</span></li>
<li><a name="a46"></a>    </li>
<li><a name="a47"></a>    <span class="src-doc-template">/**#@+</span></li>
<li><a name="a48"></a><span class="src-doc-template">     * </span><span class="src-doc-coretag">@access</span><span class="src-doc-template"> private</span></li>
<li><a name="a49"></a><span class="src-doc-template">     */</span></li>
<li><a name="a50"></a>    <span class="src-key">var </span><span class="src-var">$_folded_blocks         </span>=   <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;    </span><span class="src-comm">// keeps folded template blocks</span></li>
<li><a name="a50"></a>    </li>
<li><a name="a51"></a>    <span class="src-key">var </span><span class="src-var">$_current_file          </span>=   <span class="src-id">null</span><span class="src-sym">;       </span><span class="src-comm">// the current template being compiled</span></li>
<li><a name="a51"></a>    </li>
<li><a name="a52"></a>    <span class="src-key">var </span><span class="src-var">$_current_line_no       </span>=   <span class="src-num">1</span><span class="src-sym">;          </span><span class="src-comm">// line number for error messages</span></li>
<li><a name="a52"></a>    </li>
<li><a name="a53"></a>    <span class="src-key">var </span><span class="src-var">$_capture_stack         </span>=   <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;    </span><span class="src-comm">// keeps track of nested capture buffers</span></li>
<li><a name="a53"></a>    </li>
<li><a name="a54"></a>    <span class="src-key">var </span><span class="src-var">$_plugin_info           </span>=   <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;    </span><span class="src-comm">// keeps track of plugins to load</span></li>
<li><a name="a54"></a>    </li>
<li><a name="a55"></a>    <span class="src-key">var </span><span class="src-var">$_init_smarty_vars      </span>=   <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a56"></a>    <span class="src-key">var </span><span class="src-var">$_permitted_tokens      </span>=   <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'true'</span><span class="src-sym">,</span><span class="src-str">'false'</span><span class="src-sym">,</span><span class="src-str">'yes'</span><span class="src-sym">,</span><span class="src-str">'no'</span><span class="src-sym">,</span><span class="src-str">'on'</span><span class="src-sym">,</span><span class="src-str">'off'</span><span class="src-sym">,</span><span class="src-str">'null'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a57"></a>    <span class="src-key">var </span><span class="src-var">$_db_qstr_regexp        </span>=   <span class="src-id">null</span><span class="src-sym">;        </span><span class="src-comm">// regexps are setup in the constructor</span></li>
<li><a name="a57"></a>    </li>
<li><a name="a58"></a>    <span class="src-key">var </span><span class="src-var">$_si_qstr_regexp        </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a59"></a>    <span class="src-key">var </span><span class="src-var">$_qstr_regexp           </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a60"></a>    <span class="src-key">var </span><span class="src-var">$_func_regexp           </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a61"></a>    <span class="src-key">var </span><span class="src-var">$_reg_obj_regexp        </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a62"></a>    <span class="src-key">var </span><span class="src-var">$_var_bracket_regexp    </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a63"></a>    <span class="src-key">var </span><span class="src-var">$_num_const_regexp      </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a64"></a>    <span class="src-key">var </span><span class="src-var">$_dvar_guts_regexp      </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a65"></a>    <span class="src-key">var </span><span class="src-var">$_dvar_regexp           </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a66"></a>    <span class="src-key">var </span><span class="src-var">$_cvar_regexp           </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a67"></a>    <span class="src-key">var </span><span class="src-var">$_svar_regexp           </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a68"></a>    <span class="src-key">var </span><span class="src-var">$_avar_regexp           </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a69"></a>    <span class="src-key">var </span><span class="src-var">$_mod_regexp            </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a70"></a>    <span class="src-key">var </span><span class="src-var">$_var_regexp            </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a71"></a>    <span class="src-key">var </span><span class="src-var">$_parenth_param_regexp  </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a72"></a>    <span class="src-key">var </span><span class="src-var">$_func_call_regexp      </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a73"></a>    <span class="src-key">var </span><span class="src-var">$_obj_ext_regexp        </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a74"></a>    <span class="src-key">var </span><span class="src-var">$_obj_start_regexp      </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a75"></a>    <span class="src-key">var </span><span class="src-var">$_obj_params_regexp     </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a76"></a>    <span class="src-key">var </span><span class="src-var">$_obj_call_regexp       </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a77"></a>    <span class="src-key">var </span><span class="src-var">$_cacheable_state       </span>=   <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a78"></a>    <span class="src-key">var </span><span class="src-var">$_cache_attrs_count     </span>=   <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a79"></a>    <span class="src-key">var </span><span class="src-var">$_nocache_count         </span>=   <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a80"></a>    <span class="src-key">var </span><span class="src-var">$_cache_serial          </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a81"></a>    <span class="src-key">var </span><span class="src-var">$_cache_include         </span>=   <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a82"></a>&nbsp;</li>
<li><a name="a83"></a>    <span class="src-key">var </span><span class="src-var">$_strip_depth           </span>=   <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a84"></a>    <span class="src-key">var </span><span class="src-var">$_additional_newline    </span>=   <span class="src-str">&quot;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a85"></a>&nbsp;</li>
<li><a name="a86"></a>    <span class="src-doc-close-template">/**#@-*/</span></li>
<li><a name="a87"></a>    <span class="src-doc">/**</span></li>
<li><a name="a88"></a><span class="src-doc">     * The class constructor.</span></li>
<li><a name="a89"></a><span class="src-doc">     */</span></li>
<li><a name="a90"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#methodSmarty_Compiler">Smarty_Compiler</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a91"></a>    <span class="src-sym">{</span></li>
<li><a name="a92"></a>        <span class="src-comm">// matches double quoted strings:</span></li>
<li><a name="a93"></a>        <span class="src-comm">// &quot;foobar&quot;</span></li>
<li><a name="a94"></a>        <span class="src-comm">// &quot;foo\&quot;bar&quot;</span></li>
<li><a name="a95"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_db_qstr_regexp </span>= <span class="src-str">'&quot;[^&quot;\\\\]*(?:\\\\.[^&quot;\\\\]*)*&quot;'</span><span class="src-sym">;</span></li>
<li><a name="a96"></a>&nbsp;</li>
<li><a name="a97"></a>        <span class="src-comm">// matches single quoted strings:</span></li>
<li><a name="a98"></a>        <span class="src-comm">// 'foobar'</span></li>
<li><a name="a99"></a>        <span class="src-comm">// 'foo\'bar'</span></li>
<li><a name="a100"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_si_qstr_regexp </span>= <span class="src-str">'\'[^\'\\\\]*(?:\\\\.[^\'\\\\]*)*\''</span><span class="src-sym">;</span></li>
<li><a name="a101"></a>&nbsp;</li>
<li><a name="a102"></a>        <span class="src-comm">// matches single or double quoted strings</span></li>
<li><a name="a103"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_qstr_regexp </span>= <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_db_qstr_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_si_qstr_regexp </span>. <span class="src-str">')'</span><span class="src-sym">;</span></li>
<li><a name="a104"></a>&nbsp;</li>
<li><a name="a105"></a>        <span class="src-comm">// matches bracket portion of vars</span></li>
<li><a name="a106"></a>        <span class="src-comm">// [0]</span></li>
<li><a name="a107"></a>        <span class="src-comm">// [foo]</span></li>
<li><a name="a108"></a>        <span class="src-comm">// [$bar]</span></li>
<li><a name="a109"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_bracket_regexp </span>= <span class="src-str">'\[\$?[\w\.]+\]'</span><span class="src-sym">;</span></li>
<li><a name="a110"></a>&nbsp;</li>
<li><a name="a111"></a>        <span class="src-comm">// matches numerical constants</span></li>
<li><a name="a112"></a>        <span class="src-comm">// 30</span></li>
<li><a name="a113"></a>        <span class="src-comm">// -12</span></li>
<li><a name="a114"></a>        <span class="src-comm">// 13.22</span></li>
<li><a name="a115"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp </span>= <span class="src-str">'(?:\-?\d+(?:\.\d+)?)'</span><span class="src-sym">;</span></li>
<li><a name="a116"></a>&nbsp;</li>
<li><a name="a117"></a>        <span class="src-comm">// matches $ vars (not objects):</span></li>
<li><a name="a118"></a>        <span class="src-comm">// $foo</span></li>
<li><a name="a119"></a>        <span class="src-comm">// $foo.bar</span></li>
<li><a name="a120"></a>        <span class="src-comm">// $foo.bar.foobar</span></li>
<li><a name="a121"></a>        <span class="src-comm">// $foo[0]</span></li>
<li><a name="a122"></a>        <span class="src-comm">// $foo[$bar]</span></li>
<li><a name="a123"></a>        <span class="src-comm">// $foo[5][blah]</span></li>
<li><a name="a124"></a>        <span class="src-comm">// $foo[5].bar[$foobar][4]</span></li>
<li><a name="a125"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_math_regexp </span>= <span class="src-str">'(?:[\+\*\/\%]|(?:-(?!&gt;)))'</span><span class="src-sym">;</span></li>
<li><a name="a126"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_math_var_regexp </span>= <span class="src-str">'[\$\w\.\+\-\*\/\%\d\&gt;\[\]]'</span><span class="src-sym">;</span></li>
<li><a name="a127"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_guts_regexp </span>= <span class="src-str">'\w+(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_bracket_regexp</span></li>
<li><a name="a128"></a>                . <span class="src-str">')*(?:\.\$?\w+(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_bracket_regexp </span>. <span class="src-str">')*)*(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_math_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_math_var_regexp </span>. <span class="src-str">')*)?'</span><span class="src-sym">;</span></li>
<li><a name="a129"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_regexp </span>= <span class="src-str">'\$' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_guts_regexp</span><span class="src-sym">;</span></li>
<li><a name="a130"></a>&nbsp;</li>
<li><a name="a131"></a>        <span class="src-comm">// matches config vars:</span></li>
<li><a name="a132"></a>        <span class="src-comm">// #foo#</span></li>
<li><a name="a133"></a>        <span class="src-comm">// #foobar123_foo#</span></li>
<li><a name="a134"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cvar_regexp </span>= <span class="src-str">'\#\w+\#'</span><span class="src-sym">;</span></li>
<li><a name="a135"></a>&nbsp;</li>
<li><a name="a136"></a>        <span class="src-comm">// matches section vars:</span></li>
<li><a name="a137"></a>        <span class="src-comm">// %foo.bar%</span></li>
<li><a name="a138"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_svar_regexp </span>= <span class="src-str">'\%\w+\.\w+\%'</span><span class="src-sym">;</span></li>
<li><a name="a139"></a>&nbsp;</li>
<li><a name="a140"></a>        <span class="src-comm">// matches all valid variables (no quotes, no modifiers)</span></li>
<li><a name="a141"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_avar_regexp </span>= <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_regexp </span>. <span class="src-str">'|'</span></li>
<li><a name="a142"></a>           . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cvar_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_svar_regexp </span>. <span class="src-str">')'</span><span class="src-sym">;</span></li>
<li><a name="a143"></a>&nbsp;</li>
<li><a name="a144"></a>        <span class="src-comm">// matches valid variable syntax:</span></li>
<li><a name="a145"></a>        <span class="src-comm">// $foo</span></li>
<li><a name="a146"></a>        <span class="src-comm">// $foo</span></li>
<li><a name="a147"></a>        <span class="src-comm">// #foo#</span></li>
<li><a name="a148"></a>        <span class="src-comm">// #foo#</span></li>
<li><a name="a149"></a>        <span class="src-comm">// &quot;text&quot;</span></li>
<li><a name="a150"></a>        <span class="src-comm">// &quot;text&quot;</span></li>
<li><a name="a151"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_regexp </span>= <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_avar_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_qstr_regexp </span>. <span class="src-str">')'</span><span class="src-sym">;</span></li>
<li><a name="a152"></a>&nbsp;</li>
<li><a name="a153"></a>        <span class="src-comm">// matches valid object call (one level of object nesting allowed in parameters):</span></li>
<li><a name="a154"></a>        <span class="src-comm">// $foo-&gt;bar</span></li>
<li><a name="a155"></a>        <span class="src-comm">// $foo-&gt;bar()</span></li>
<li><a name="a156"></a>        <span class="src-comm">// $foo-&gt;bar(&quot;text&quot;)</span></li>
<li><a name="a157"></a>        <span class="src-comm">// $foo-&gt;bar($foo, $bar, &quot;text&quot;)</span></li>
<li><a name="a158"></a>        <span class="src-comm">// $foo-&gt;bar($foo, &quot;foo&quot;)</span></li>
<li><a name="a159"></a>        <span class="src-comm">// $foo-&gt;bar-&gt;foo()</span></li>
<li><a name="a160"></a>        <span class="src-comm">// $foo-&gt;bar-&gt;foo-&gt;bar()</span></li>
<li><a name="a161"></a>        <span class="src-comm">// $foo-&gt;bar($foo-&gt;bar)</span></li>
<li><a name="a162"></a>        <span class="src-comm">// $foo-&gt;bar($foo-&gt;bar())</span></li>
<li><a name="a163"></a>        <span class="src-comm">// $foo-&gt;bar($foo-&gt;bar($blah,$foo,44,&quot;foo&quot;,$foo[0].bar))</span></li>
<li><a name="a164"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_ext_regexp </span>= <span class="src-str">'\-&gt;(?:\$?' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_guts_regexp </span>. <span class="src-str">')'</span><span class="src-sym">;</span></li>
<li><a name="a165"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_restricted_param_regexp </span>= <span class="src-str">'(?:'</span></li>
<li><a name="a166"></a>                . <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp </span>. <span class="src-str">')(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_ext_regexp </span>. <span class="src-str">'(?:\((?:(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp </span>. <span class="src-str">')'</span></li>
<li><a name="a167"></a>                . <span class="src-str">'(?:\s*,\s*(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp </span>. <span class="src-str">'))*)?\))?)*)'</span><span class="src-sym">;</span></li>
<li><a name="a168"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_single_param_regexp </span>= <span class="src-str">'(?:\w+|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_restricted_param_regexp </span>. <span class="src-str">'(?:\s*,\s*(?:(?:\w+|'</span></li>
<li><a name="a169"></a>                . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_regexp </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_restricted_param_regexp </span>. <span class="src-str">')))*)'</span><span class="src-sym">;</span></li>
<li><a name="a170"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_params_regexp </span>= <span class="src-str">'\((?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_single_param_regexp</span></li>
<li><a name="a171"></a>                . <span class="src-str">'(?:\s*,\s*' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_single_param_regexp </span>. <span class="src-str">')*)?\)'</span><span class="src-sym">;</span></li>
<li><a name="a172"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_start_regexp </span>= <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_ext_regexp </span>. <span class="src-str">')+)'</span><span class="src-sym">;</span></li>
<li><a name="a173"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_call_regexp </span>= <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_start_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_params_regexp </span>. <span class="src-str">')?(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_math_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_math_var_regexp </span>. <span class="src-str">')*)?)'</span><span class="src-sym">;</span></li>
<li><a name="a174"></a>        </li>
<li><a name="a175"></a>        <span class="src-comm">// matches valid modifier syntax:</span></li>
<li><a name="a176"></a>        <span class="src-comm">// |foo</span></li>
<li><a name="a177"></a>        <span class="src-comm">// |@foo</span></li>
<li><a name="a178"></a>        <span class="src-comm">// |foo:&quot;bar&quot;</span></li>
<li><a name="a179"></a>        <span class="src-comm">// |foo:$bar</span></li>
<li><a name="a180"></a>        <span class="src-comm">// |foo:&quot;bar&quot;:$foobar</span></li>
<li><a name="a181"></a>        <span class="src-comm">// |foo|bar</span></li>
<li><a name="a182"></a>        <span class="src-comm">// |foo:$foo-&gt;bar</span></li>
<li><a name="a183"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>= <span class="src-str">'(?:\|@?\w+(?::(?:\w+|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp </span>. <span class="src-str">'|'</span></li>
<li><a name="a184"></a>           . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_call_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_avar_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_qstr_regexp </span>.<span class="src-str">'))*)'</span><span class="src-sym">;</span></li>
<li><a name="a185"></a>&nbsp;</li>
<li><a name="a186"></a>        <span class="src-comm">// matches valid function name:</span></li>
<li><a name="a187"></a>        <span class="src-comm">// foo123</span></li>
<li><a name="a188"></a>        <span class="src-comm">// _foo_bar</span></li>
<li><a name="a189"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_func_regexp </span>= <span class="src-str">'[a-zA-Z_]\w*'</span><span class="src-sym">;</span></li>
<li><a name="a190"></a>&nbsp;</li>
<li><a name="a191"></a>        <span class="src-comm">// matches valid registered object:</span></li>
<li><a name="a192"></a>        <span class="src-comm">// foo-&gt;bar</span></li>
<li><a name="a193"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_reg_obj_regexp </span>= <span class="src-str">'[a-zA-Z_]\w*-&gt;[a-zA-Z_]\w*'</span><span class="src-sym">;</span></li>
<li><a name="a194"></a>&nbsp;</li>
<li><a name="a195"></a>        <span class="src-comm">// matches valid parameter values:</span></li>
<li><a name="a196"></a>        <span class="src-comm">// true</span></li>
<li><a name="a197"></a>        <span class="src-comm">// $foo</span></li>
<li><a name="a198"></a>        <span class="src-comm">// $foo|bar</span></li>
<li><a name="a199"></a>        <span class="src-comm">// #foo#</span></li>
<li><a name="a200"></a>        <span class="src-comm">// #foo#|bar</span></li>
<li><a name="a201"></a>        <span class="src-comm">// &quot;text&quot;</span></li>
<li><a name="a202"></a>        <span class="src-comm">// &quot;text&quot;|bar</span></li>
<li><a name="a203"></a>        <span class="src-comm">// $foo-&gt;bar</span></li>
<li><a name="a204"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_param_regexp </span>= <span class="src-str">'(?:\s*(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_call_regexp </span>. <span class="src-str">'|'</span></li>
<li><a name="a205"></a>           . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp  </span>. <span class="src-str">'|\w+)(?&gt;' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)\s*)'</span><span class="src-sym">;</span></li>
<li><a name="a206"></a>&nbsp;</li>
<li><a name="a207"></a>        <span class="src-comm">// matches valid parenthesised function parameters:</span></li>
<li><a name="a208"></a>        <span class="src-comm">//</span></li>
<li><a name="a209"></a>        <span class="src-comm">// &quot;text&quot;</span></li>
<li><a name="a210"></a>        <span class="src-comm">//    $foo, $bar, &quot;text&quot;</span></li>
<li><a name="a211"></a>        <span class="src-comm">// $foo|bar, &quot;foo&quot;|bar, $foo-&gt;bar($foo)|bar</span></li>
<li><a name="a212"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_parenth_param_regexp </span>= <span class="src-str">'(?:\((?:\w+|'</span></li>
<li><a name="a213"></a>                . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_param_regexp </span>. <span class="src-str">'(?:\s*,\s*(?:(?:\w+|'</span></li>
<li><a name="a214"></a>                . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_param_regexp </span>. <span class="src-str">')))*)?\))'</span><span class="src-sym">;</span></li>
<li><a name="a215"></a>&nbsp;</li>
<li><a name="a216"></a>        <span class="src-comm">// matches valid function call:</span></li>
<li><a name="a217"></a>        <span class="src-comm">// foo()</span></li>
<li><a name="a218"></a>        <span class="src-comm">// foo_bar($foo)</span></li>
<li><a name="a219"></a>        <span class="src-comm">// _foo_bar($foo,&quot;bar&quot;)</span></li>
<li><a name="a220"></a>        <span class="src-comm">// foo123($foo,$foo-&gt;bar(),&quot;foo&quot;)</span></li>
<li><a name="a221"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_func_call_regexp </span>= <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_func_regexp </span>. <span class="src-str">'\s*(?:'</span></li>
<li><a name="a222"></a>           . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_parenth_param_regexp </span>. <span class="src-str">'))'</span><span class="src-sym">;</span></li>
<li><a name="a223"></a>    <span class="src-sym">}</span></li>
<li><a name="a224"></a>&nbsp;</li>
<li><a name="a225"></a>    <span class="src-doc">/**</span></li>
<li><a name="a226"></a><span class="src-doc">     * compile a resource</span></li>
<li><a name="a227"></a><span class="src-doc">     *</span></li>
<li><a name="a228"></a><span class="src-doc">     * sets $compiled_content to the compiled source</span></li>
<li><a name="a229"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$resource_name </span></li>
<li><a name="a230"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$source_content </span></li>
<li><a name="a231"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$compiled_content </span></li>
<li><a name="a232"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">true </span></li>
<li><a name="a233"></a><span class="src-doc">     */</span></li>
<li><a name="a234"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_file">_compile_file</a><span class="src-sym">(</span><span class="src-var">$resource_name</span><span class="src-sym">, </span><span class="src-var">$source_content</span><span class="src-sym">, </span><span class="src-sym">&amp;</span><span class="src-var">$compiled_content</span><span class="src-sym">)</span></li>
<li><a name="a235"></a>    <span class="src-sym">{</span></li>
<li><a name="a236"></a>&nbsp;</li>
<li><a name="a237"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">security</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a238"></a>            <span class="src-comm">// do not allow php syntax to be executed unless specified</span></li>
<li><a name="a239"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">php_handling </span>== <span class="src-id"><a href="../lib/smarty/_smarty_Smarty_class_php.html#defineSMARTY_PHP_ALLOW">SMARTY_PHP_ALLOW</a> </span>&amp;&amp;</li>
<li><a name="a240"></a>                <span class="src-sym">!</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">security_settings</span><span class="src-sym">[</span><span class="src-str">'PHP_HANDLING'</span><span class="src-sym">]</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a241"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">php_handling </span>= <span class="src-id"><a href="../lib/smarty/_smarty_Smarty_class_php.html#defineSMARTY_PHP_PASSTHRU">SMARTY_PHP_PASSTHRU</a></span><span class="src-sym">;</span></li>
<li><a name="a242"></a>            <span class="src-sym">}</span></li>
<li><a name="a243"></a>        <span class="src-sym">}</span></li>
<li><a name="a244"></a>&nbsp;</li>
<li><a name="a245"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_load_filters">_load_filters</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a246"></a>&nbsp;</li>
<li><a name="a247"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_file </span>= <span class="src-var">$resource_name</span><span class="src-sym">;</span></li>
<li><a name="a248"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_line_no </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a249"></a>        <span class="src-var">$ldq </span>= <a href="http://www.php.net/preg_quote">preg_quote</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">left_delimiter</span><span class="src-sym">, </span><span class="src-str">'~'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a250"></a>        <span class="src-var">$rdq </span>= <a href="http://www.php.net/preg_quote">preg_quote</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">right_delimiter</span><span class="src-sym">, </span><span class="src-str">'~'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a251"></a>&nbsp;</li>
<li><a name="a252"></a>        <span class="src-comm">// run template source through prefilter functions</span></li>
<li><a name="a253"></a>        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'prefilter'</span><span class="src-sym">]</span><span class="src-sym">) </span>&gt; <span class="src-num">0</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a254"></a>            <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'prefilter'</span><span class="src-sym">] </span><span class="src-key">as </span><span class="src-var">$filter_name </span>=&gt; <span class="src-var">$prefilter</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a255"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$prefilter </span>=== <span class="src-id">false</span><span class="src-sym">) </span><span class="src-key">continue</span><span class="src-sym">;</span></li>
<li><a name="a256"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$prefilter</span><span class="src-sym">[</span><span class="src-num">3</span><span class="src-sym">] </span>|| <a href="http://www.php.net/is_callable">is_callable</a><span class="src-sym">(</span><span class="src-var">$prefilter</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a257"></a>                    <span class="src-var">$source_content </span>= <a href="http://www.php.net/call_user_func_array">call_user_func_array</a><span class="src-sym">(</span><span class="src-var">$prefilter</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">,</span></li>
<li><a name="a258"></a>                                                            <span class="src-key">array</span><span class="src-sym">(</span><span class="src-var">$source_content</span><span class="src-sym">, </span><span class="src-sym">&amp;</span><span class="src-var">$this</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a259"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'prefilter'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$filter_name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">3</span><span class="src-sym">] </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a260"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a261"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_trigger_fatal_error</span><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-sym">[</span><span class="src-id">plugin</span><span class="src-sym">]</span> <span class="src-id">prefilter</span> '<span class="src-var">$filter_name</span>' <span class="src-id">is</span> <span class="src-id">not</span> <span class="src-id">implemented</span></span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a262"></a>                <span class="src-sym">}</span></li>
<li><a name="a263"></a>            <span class="src-sym">}</span></li>
<li><a name="a264"></a>        <span class="src-sym">}</span></li>
<li><a name="a265"></a>&nbsp;</li>
<li><a name="a266"></a>        <span class="src-comm">/* fetch all special blocks */</span></li>
<li><a name="a267"></a>        <span class="src-var">$search </span>= <span class="src-str">&quot;</span><span class="src-str">~{<span class="src-var">$ldq</span><span class="src-sym">}</span>\*(.*?)\*{<span class="src-var">$rdq</span><span class="src-sym">}</span>|{<span class="src-var">$ldq</span><span class="src-sym">}</span>\s*<span class="src-id">literal</span>\s*{<span class="src-var">$rdq</span><span class="src-sym">}</span>(.*?){<span class="src-var">$ldq</span><span class="src-sym">}</span>\s*/<span class="src-id">literal</span>\s*{<span class="src-var">$rdq</span><span class="src-sym">}</span>|{<span class="src-var">$ldq</span><span class="src-sym">}</span>\s*<span class="src-id">php</span>\s*{<span class="src-var">$rdq</span><span class="src-sym">}</span>(.*?){<span class="src-var">$ldq</span><span class="src-sym">}</span>\s*/<span class="src-id">php</span>\s*{<span class="src-var">$rdq</span><span class="src-sym">}</span>~<span class="src-id">s</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a268"></a>&nbsp;</li>
<li><a name="a269"></a>        <a href="http://www.php.net/preg_match_all">preg_match_all</a><span class="src-sym">(</span><span class="src-var">$search</span><span class="src-sym">, </span><span class="src-var">$source_content</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">,  </span><span class="src-id">PREG_SET_ORDER</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a270"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_folded_blocks </span>= <span class="src-var">$match</span><span class="src-sym">;</span></li>
<li><a name="a271"></a>        <a href="http://www.php.net/reset">reset</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_folded_blocks</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a272"></a>&nbsp;</li>
<li><a name="a273"></a>        <span class="src-comm">/* replace special blocks by &quot;{php}&quot; */</span></li>
<li><a name="a274"></a>        <span class="src-var">$source_content </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-var">$search</span>.<span class="src-str">'e'</span><span class="src-sym">, </span><span class="src-str">&quot;'&quot;</span></li>
<li><a name="a275"></a>                                       . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_quote_replace">_quote_replace</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">left_delimiter</span><span class="src-sym">) </span>. <span class="src-str">'php'</span></li>
<li><a name="a276"></a>                                       . <span class="src-str">&quot;' . str_repeat(\&quot;\n\&quot;, substr_count('\\0', \&quot;\n\&quot;)) .'&quot;</span></li>
<li><a name="a277"></a>                                       . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_quote_replace">_quote_replace</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">right_delimiter</span><span class="src-sym">)</span></li>
<li><a name="a278"></a>                                       . <span class="src-str">&quot;'&quot;</span></li>
<li><a name="a279"></a>                                       <span class="src-sym">, </span><span class="src-var">$source_content</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a280"></a>&nbsp;</li>
<li><a name="a281"></a>        <span class="src-comm">/* Gather all template tags. */</span></li>
<li><a name="a282"></a>        <a href="http://www.php.net/preg_match_all">preg_match_all</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str">~{<span class="src-var">$ldq</span><span class="src-sym">}</span>\s*(.*?)\s*{<span class="src-var">$rdq</span><span class="src-sym">}</span>~<span class="src-id">s</span></span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$source_content</span><span class="src-sym">, </span><span class="src-var">$_match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a283"></a>        <span class="src-var">$template_tags </span>= <span class="src-var">$_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a284"></a>        <span class="src-comm">/* Split content by template tags to obtain non-template content. */</span></li>
<li><a name="a285"></a>        <span class="src-var">$text_blocks </span>= <a href="http://www.php.net/preg_split">preg_split</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str">~{<span class="src-var">$ldq</span><span class="src-sym">}</span>.*?{<span class="src-var">$rdq</span><span class="src-sym">}</span>~<span class="src-id">s</span></span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$source_content</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a286"></a>&nbsp;</li>
<li><a name="a287"></a>        <span class="src-comm">/* loop through text blocks */</span></li>
<li><a name="a288"></a>        <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$curr_tb </span>= <span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$for_max </span>= <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$text_blocks</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-var">$curr_tb </span>&lt; <span class="src-var">$for_max</span><span class="src-sym">; </span><span class="src-var">$curr_tb</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a289"></a>            <span class="src-comm">/* match anything resembling php tags */</span></li>
<li><a name="a290"></a>            <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match_all">preg_match_all</a><span class="src-sym">(</span><span class="src-str">'~(&lt;\?(?:\w+|=)?|\?&gt;|language\s*=\s*[\&quot;\']?php[\&quot;\']?)~is'</span><span class="src-sym">, </span><span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$curr_tb</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-var">$sp_match</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a291"></a>                <span class="src-comm">/* replace tags with placeholders to prevent recursive replacements */</span></li>
<li><a name="a292"></a>                <span class="src-var">$sp_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">] </span>= <a href="http://www.php.net/array_unique">array_unique</a><span class="src-sym">(</span><span class="src-var">$sp_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a293"></a>                <a href="http://www.php.net/usort">usort</a><span class="src-sym">(</span><span class="src-var">$sp_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-str">'_smarty_sort_length'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a294"></a>                <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$curr_sp </span>= <span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$for_max2 </span>= <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$sp_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-var">$curr_sp </span>&lt; <span class="src-var">$for_max2</span><span class="src-sym">; </span><span class="src-var">$curr_sp</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a295"></a>                    <span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$curr_tb</span><span class="src-sym">] </span>= <a href="http://www.php.net/str_replace">str_replace</a><span class="src-sym">(</span><span class="src-var">$sp_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$curr_sp</span><span class="src-sym">]</span><span class="src-sym">,</span><span class="src-str">'%%%SMARTYSP'</span>.<span class="src-var">$curr_sp</span>.<span class="src-str">'%%%'</span><span class="src-sym">,</span><span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$curr_tb</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a296"></a>                <span class="src-sym">}</span></li>
<li><a name="a297"></a>                <span class="src-comm">/* process each one */</span></li>
<li><a name="a298"></a>                <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$curr_sp </span>= <span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$for_max2 </span>= <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$sp_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-var">$curr_sp </span>&lt; <span class="src-var">$for_max2</span><span class="src-sym">; </span><span class="src-var">$curr_sp</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a299"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">php_handling </span>== <span class="src-id"><a href="../lib/smarty/_smarty_Smarty_class_php.html#defineSMARTY_PHP_PASSTHRU">SMARTY_PHP_PASSTHRU</a></span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a300"></a>                        <span class="src-comm">/* echo php contents */</span></li>
<li><a name="a301"></a>                        <span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$curr_tb</span><span class="src-sym">] </span>= <a href="http://www.php.net/str_replace">str_replace</a><span class="src-sym">(</span><span class="src-str">'%%%SMARTYSP'</span>.<span class="src-var">$curr_sp</span>.<span class="src-str">'%%%'</span><span class="src-sym">, </span><span class="src-str">'&lt;?php echo \''</span>.<a href="http://www.php.net/str_replace">str_replace</a><span class="src-sym">(</span><span class="src-str">&quot;'&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;\'&quot;</span><span class="src-sym">, </span><span class="src-var">$sp_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$curr_sp</span><span class="src-sym">]</span><span class="src-sym">)</span>.<span class="src-str">'\'; ?&gt;'</span>.<span class="src-str">&quot;\n&quot;</span><span class="src-sym">, </span><span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$curr_tb</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a302"></a>                    <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">php_handling </span>== <span class="src-id"><a href="../lib/smarty/_smarty_Smarty_class_php.html#defineSMARTY_PHP_QUOTE">SMARTY_PHP_QUOTE</a></span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a303"></a>                        <span class="src-comm">/* quote php tags */</span></li>
<li><a name="a304"></a>                        <span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$curr_tb</span><span class="src-sym">] </span>= <a href="http://www.php.net/str_replace">str_replace</a><span class="src-sym">(</span><span class="src-str">'%%%SMARTYSP'</span>.<span class="src-var">$curr_sp</span>.<span class="src-str">'%%%'</span><span class="src-sym">, </span><a href="http://www.php.net/htmlspecialchars">htmlspecialchars</a><span class="src-sym">(</span><span class="src-var">$sp_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$curr_sp</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$curr_tb</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a305"></a>                    <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">php_handling </span>== <span class="src-id"><a href="../lib/smarty/_smarty_Smarty_class_php.html#defineSMARTY_PHP_REMOVE">SMARTY_PHP_REMOVE</a></span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a306"></a>                        <span class="src-comm">/* remove php tags */</span></li>
<li><a name="a307"></a>                        <span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$curr_tb</span><span class="src-sym">] </span>= <a href="http://www.php.net/str_replace">str_replace</a><span class="src-sym">(</span><span class="src-str">'%%%SMARTYSP'</span>.<span class="src-var">$curr_sp</span>.<span class="src-str">'%%%'</span><span class="src-sym">, </span><span class="src-str">''</span><span class="src-sym">, </span><span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$curr_tb</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a308"></a>                    <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a309"></a>                        <span class="src-comm">/* SMARTY_PHP_ALLOW, but echo non php starting tags */</span></li>
<li><a name="a310"></a>                        <span class="src-var">$sp_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$curr_sp</span><span class="src-sym">] </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">'~(&lt;\?(?!php|=|$))~i'</span><span class="src-sym">, </span><span class="src-str">'&lt;?php echo \'\\1\'?&gt;'</span>.<span class="src-str">&quot;\n&quot;</span><span class="src-sym">, </span><span class="src-var">$sp_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$curr_sp</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a311"></a>                        <span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$curr_tb</span><span class="src-sym">] </span>= <a href="http://www.php.net/str_replace">str_replace</a><span class="src-sym">(</span><span class="src-str">'%%%SMARTYSP'</span>.<span class="src-var">$curr_sp</span>.<span class="src-str">'%%%'</span><span class="src-sym">, </span><span class="src-var">$sp_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$curr_sp</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$curr_tb</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a312"></a>                    <span class="src-sym">}</span></li>
<li><a name="a313"></a>                <span class="src-sym">}</span></li>
<li><a name="a314"></a>            <span class="src-sym">}</span></li>
<li><a name="a315"></a>        <span class="src-sym">}</span></li>
<li><a name="a316"></a>&nbsp;</li>
<li><a name="a317"></a>        <span class="src-comm">/* Compile the template tags into PHP code. */</span></li>
<li><a name="a318"></a>        <span class="src-var">$compiled_tags </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a319"></a>        <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$i </span>= <span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$for_max </span>= <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$template_tags</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-var">$i </span>&lt; <span class="src-var">$for_max</span><span class="src-sym">; </span><span class="src-var">$i</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a320"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_line_no </span>+= <a href="http://www.php.net/substr_count">substr_count</a><span class="src-sym">(</span><span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-str">&quot;\n&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a321"></a>            <span class="src-var">$compiled_tags</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_tag">_compile_tag</a><span class="src-sym">(</span><span class="src-var">$template_tags</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a322"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_line_no </span>+= <a href="http://www.php.net/substr_count">substr_count</a><span class="src-sym">(</span><span class="src-var">$template_tags</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-str">&quot;\n&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a323"></a>        <span class="src-sym">}</span></li>
<li><a name="a324"></a>        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_tag_stack</span><span class="src-sym">)</span>&gt;<span class="src-num">0</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a325"></a>            list<span class="src-sym">(</span><span class="src-var">$_open_tag</span><span class="src-sym">, </span><span class="src-var">$_line_no</span><span class="src-sym">) </span>= <a href="http://www.php.net/end">end</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_tag_stack</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a326"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">unclosed</span> <span class="src-id">tag</span> <span class="src-id">\{</span><span class="src-var">$_open_tag</span><span class="src-sym">}</span> (<span class="src-id">opened</span> <span class="src-id">line</span> <span class="src-var">$_line_no</span>).</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a327"></a>            <span class="src-key">return</span><span class="src-sym">;</span></li>
<li><a name="a328"></a>        <span class="src-sym">}</span></li>
<li><a name="a329"></a>&nbsp;</li>
<li><a name="a330"></a>        <span class="src-comm">/* Reformat $text_blocks between 'strip' and '/strip' tags,</span></li>
<li><a name="a331"></a><span class="src-comm">           removing spaces, tabs and newlines. */</span></li>
<li><a name="a332"></a>        <span class="src-var">$strip </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a333"></a>        <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$i </span>= <span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$for_max </span>= <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$compiled_tags</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-var">$i </span>&lt; <span class="src-var">$for_max</span><span class="src-sym">; </span><span class="src-var">$i</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a334"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$compiled_tags</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">] </span>== <span class="src-str">'{strip}'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a335"></a>                <span class="src-var">$compiled_tags</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">] </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a336"></a>                <span class="src-var">$strip </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a337"></a>                <span class="src-comm">/* remove leading whitespaces */</span></li>
<li><a name="a338"></a>                <span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$i </span>+ <span class="src-num">1</span><span class="src-sym">] </span>= <a href="http://www.php.net/ltrim">ltrim</a><span class="src-sym">(</span><span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$i </span>+ <span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a339"></a>            <span class="src-sym">}</span></li>
<li><a name="a340"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$strip</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a341"></a>                <span class="src-comm">/* strip all $text_blocks before the next '/strip' */</span></li>
<li><a name="a342"></a>                <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$j </span>= <span class="src-var">$i </span>+ <span class="src-num">1</span><span class="src-sym">; </span><span class="src-var">$j </span>&lt; <span class="src-var">$for_max</span><span class="src-sym">; </span><span class="src-var">$j</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a343"></a>                    <span class="src-comm">/* remove leading and trailing whitespaces of each line */</span></li>
<li><a name="a344"></a>                    <span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$j</span><span class="src-sym">] </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">'![\t ]*[\r\n]+[\t ]*!'</span><span class="src-sym">, </span><span class="src-str">''</span><span class="src-sym">, </span><span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$j</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a345"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$compiled_tags</span><span class="src-sym">[</span><span class="src-var">$j</span><span class="src-sym">] </span>== <span class="src-str">'{/strip}'</span><span class="src-sym">) </span><span class="src-sym">{                       </span></li>
<li><a name="a346"></a>                        <span class="src-comm">/* remove trailing whitespaces from the last text_block */</span></li>
<li><a name="a347"></a>                        <span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$j</span><span class="src-sym">] </span>= <a href="http://www.php.net/rtrim">rtrim</a><span class="src-sym">(</span><span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$j</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a348"></a>                    <span class="src-sym">}</span></li>
<li><a name="a349"></a>                    <span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$j</span><span class="src-sym">] </span>= <span class="src-str">&quot;&lt;?php echo '&quot; </span>. <a href="http://www.php.net/strtr">strtr</a><span class="src-sym">(</span><span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$j</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;'&quot;</span>=&gt;<span class="src-str">&quot;\'&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;\\&quot;</span>=&gt;<span class="src-str">&quot;\\\\&quot;</span><span class="src-sym">)) </span>. <span class="src-str">&quot;'; ?&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a350"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$compiled_tags</span><span class="src-sym">[</span><span class="src-var">$j</span><span class="src-sym">] </span>== <span class="src-str">'{/strip}'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a351"></a>                        <span class="src-var">$compiled_tags</span><span class="src-sym">[</span><span class="src-var">$j</span><span class="src-sym">] </span>= <span class="src-str">&quot;\n&quot;</span><span class="src-sym">; </span><span class="src-comm">/* slurped by php, but necessary</span></li>
<li><a name="a352"></a><span class="src-comm">                                    if a newline is following the closing strip-tag */</span></li>
<li><a name="a353"></a>                        <span class="src-var">$strip </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a354"></a>                        <span class="src-var">$i </span>= <span class="src-var">$j</span><span class="src-sym">;</span></li>
<li><a name="a355"></a>                        <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a356"></a>                    <span class="src-sym">}</span></li>
<li><a name="a357"></a>                <span class="src-sym">}</span></li>
<li><a name="a358"></a>            <span class="src-sym">}</span></li>
<li><a name="a359"></a>        <span class="src-sym">}</span></li>
<li><a name="a360"></a>        <span class="src-var">$compiled_content </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a361"></a>&nbsp;</li>
<li><a name="a362"></a>        <span class="src-comm">/* Interleave the compiled contents and text blocks to get the final result. */</span></li>
<li><a name="a363"></a>        <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$i </span>= <span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$for_max </span>= <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$compiled_tags</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-var">$i </span>&lt; <span class="src-var">$for_max</span><span class="src-sym">; </span><span class="src-var">$i</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a364"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$compiled_tags</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">] </span>== <span class="src-str">''</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a365"></a>                <span class="src-comm">// tag result empty, remove first newline from following text block</span></li>
<li><a name="a366"></a>                <span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$i</span>+<span class="src-num">1</span><span class="src-sym">] </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">'~^(\r\n|\r|\n)~'</span><span class="src-sym">, </span><span class="src-str">''</span><span class="src-sym">, </span><span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$i</span>+<span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a367"></a>            <span class="src-sym">}</span></li>
<li><a name="a368"></a>            <span class="src-var">$compiled_content </span>.= <span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span>.<span class="src-var">$compiled_tags</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a369"></a>        <span class="src-sym">}</span></li>
<li><a name="a370"></a>        <span class="src-var">$compiled_content </span>.= <span class="src-var">$text_blocks</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a371"></a>&nbsp;</li>
<li><a name="a372"></a>        <span class="src-comm">// remove \n from the end of the file, if any</span></li>
<li><a name="a373"></a>        <span class="src-key">if </span><span class="src-sym">((</span><span class="src-var">$_len</span>=<a href="http://www.php.net/strlen">strlen</a><span class="src-sym">(</span><span class="src-var">$compiled_content</span><span class="src-sym">)) </span>&amp;&amp; <span class="src-sym">(</span><span class="src-var">$compiled_content</span><span class="src-sym">{</span><span class="src-var">$_len </span>- <span class="src-num">1</span><span class="src-sym">} </span>== <span class="src-str">&quot;\n&quot; </span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a374"></a>            <span class="src-var">$compiled_content </span>= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$compiled_content</span><span class="src-sym">, </span><span class="src-num">0</span><span class="src-sym">, </span>-<span class="src-num">1</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a375"></a>        <span class="src-sym">}</span></li>
<li><a name="a376"></a>&nbsp;</li>
<li><a name="a377"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cache_serial</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a378"></a>            <span class="src-var">$compiled_content </span>= <span class="src-str">&quot;&lt;?php \$this-&gt;_cache_serials['&quot;</span>.<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cache_include</span>.<span class="src-str">&quot;'] = '&quot;</span>.<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cache_serial</span>.<span class="src-str">&quot;'; ?&gt;&quot; </span>. <span class="src-var">$compiled_content</span><span class="src-sym">;</span></li>
<li><a name="a379"></a>        <span class="src-sym">}</span></li>
<li><a name="a380"></a>&nbsp;</li>
<li><a name="a381"></a>        <span class="src-comm">// remove unnecessary close/open tags</span></li>
<li><a name="a382"></a>        <span class="src-var">$compiled_content </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">'~\?&gt;\n?&lt;\?php~'</span><span class="src-sym">, </span><span class="src-str">''</span><span class="src-sym">, </span><span class="src-var">$compiled_content</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a383"></a>&nbsp;</li>
<li><a name="a384"></a>        <span class="src-comm">// run compiled template through postfilter functions</span></li>
<li><a name="a385"></a>        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'postfilter'</span><span class="src-sym">]</span><span class="src-sym">) </span>&gt; <span class="src-num">0</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a386"></a>            <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'postfilter'</span><span class="src-sym">] </span><span class="src-key">as </span><span class="src-var">$filter_name </span>=&gt; <span class="src-var">$postfilter</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a387"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$postfilter </span>=== <span class="src-id">false</span><span class="src-sym">) </span><span class="src-key">continue</span><span class="src-sym">;</span></li>
<li><a name="a388"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$postfilter</span><span class="src-sym">[</span><span class="src-num">3</span><span class="src-sym">] </span>|| <a href="http://www.php.net/is_callable">is_callable</a><span class="src-sym">(</span><span class="src-var">$postfilter</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a389"></a>                    <span class="src-var">$compiled_content </span>= <a href="http://www.php.net/call_user_func_array">call_user_func_array</a><span class="src-sym">(</span><span class="src-var">$postfilter</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">,</span></li>
<li><a name="a390"></a>                                                              <span class="src-key">array</span><span class="src-sym">(</span><span class="src-var">$compiled_content</span><span class="src-sym">, </span><span class="src-sym">&amp;</span><span class="src-var">$this</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a391"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'postfilter'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$filter_name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">3</span><span class="src-sym">] </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a392"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a393"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_trigger_fatal_error</span><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">Smarty</span> <span class="src-id">plugin</span> <span class="src-id">error</span>: <span class="src-id">postfilter</span> '<span class="src-var">$filter_name</span>' <span class="src-id">is</span> <span class="src-id">not</span> <span class="src-id">implemented</span></span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a394"></a>                <span class="src-sym">}</span></li>
<li><a name="a395"></a>            <span class="src-sym">}</span></li>
<li><a name="a396"></a>        <span class="src-sym">}</span></li>
<li><a name="a397"></a>&nbsp;</li>
<li><a name="a398"></a>        <span class="src-comm">// put header at the top of the compiled template</span></li>
<li><a name="a399"></a>        <span class="src-var">$template_header </span>= <span class="src-str">&quot;&lt;?php /* Smarty version &quot;</span>.<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_version</span>.<span class="src-str">&quot;, created on &quot;</span>.<a href="http://www.php.net/strftime">strftime</a><span class="src-sym">(</span><span class="src-str">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="src-sym">)</span>.<span class="src-str">&quot;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a400"></a>        <span class="src-var">$template_header </span>.= <span class="src-str">&quot;         compiled from &quot;</span>.<a href="http://www.php.net/strtr">strtr</a><span class="src-sym">(</span><a href="http://www.php.net/urlencode">urlencode</a><span class="src-sym">(</span><span class="src-var">$resource_name</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'%2F'</span>=&gt;<span class="src-str">'/'</span><span class="src-sym">, </span><span class="src-str">'%3A'</span>=&gt;<span class="src-str">':'</span><span class="src-sym">))</span>.<span class="src-str">&quot; */ ?&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a401"></a>&nbsp;</li>
<li><a name="a402"></a>        <span class="src-comm">/* Emit code to load needed plugins. */</span></li>
<li><a name="a403"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins_code </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a404"></a>        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugin_info</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a405"></a>            <span class="src-var">$_plugins_params </span>= <span class="src-str">&quot;array('plugins' =&gt; array(&quot;</span><span class="src-sym">;</span></li>
<li><a name="a406"></a>            <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugin_info </span><span class="src-key">as </span><span class="src-var">$plugin_type </span>=&gt; <span class="src-var">$plugins</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a407"></a>                <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$plugins </span><span class="src-key">as </span><span class="src-var">$plugin_name </span>=&gt; <span class="src-var">$plugin_info</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a408"></a>                    <span class="src-var">$_plugins_params </span>.= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">array</span>('<span class="src-var">$plugin_type</span>', '<span class="src-var">$plugin_name</span>', '</span><span class="src-str">&quot; </span>. <a href="http://www.php.net/strtr">strtr</a><span class="src-sym">(</span><span class="src-var">$plugin_info</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;'&quot; </span>=&gt; <span class="src-str">&quot;\\'&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;\\&quot; </span>=&gt; <span class="src-str">&quot;\\\\&quot;</span><span class="src-sym">)) </span>. <span class="src-str">&quot;</span><span class="src-str">', <span class="src-var">$plugin_info</span><span class="src-sym">[</span>1<span class="src-sym">]</span>, </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a409"></a>                    <span class="src-var">$_plugins_params </span>.= <span class="src-var">$plugin_info</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">] </span>? <span class="src-str">'true),' </span>: <span class="src-str">'false),'</span><span class="src-sym">;</span></li>
<li><a name="a410"></a>                <span class="src-sym">}</span></li>
<li><a name="a411"></a>            <span class="src-sym">}</span></li>
<li><a name="a412"></a>            <span class="src-var">$_plugins_params </span>.= <span class="src-str">'))'</span><span class="src-sym">;</span></li>
<li><a name="a413"></a>            <span class="src-var">$plugins_code </span>= <span class="src-str">&quot;</span><span class="src-str">&lt;?<span class="src-id">php</span> <span class="src-id">require_once</span>(<span class="src-id">SMARTY_CORE_DIR</span> . '<span class="src-id">core</span>.<span class="src-id">load_plugins</span>.<span class="src-id">php</span>');\n<span class="src-id">smarty_core_load_plugins</span>(<span class="src-var">$_plugins_params</span>, \$<span class="src-id">this</span>); ?&gt;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a414"></a>            <span class="src-var">$template_header </span>.= <span class="src-var">$plugins_code</span><span class="src-sym">;</span></li>
<li><a name="a415"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugin_info </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a416"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins_code </span>= <span class="src-var">$plugins_code</span><span class="src-sym">;</span></li>
<li><a name="a417"></a>        <span class="src-sym">}</span></li>
<li><a name="a418"></a>&nbsp;</li>
<li><a name="a419"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_init_smarty_vars</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a420"></a>            <span class="src-var">$template_header </span>.= <span class="src-str">&quot;&lt;?php require_once(SMARTY_CORE_DIR . 'core.assign_smarty_interface.php');\nsmarty_core_assign_smarty_interface(null, \$this); ?&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a421"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_init_smarty_vars </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a422"></a>        <span class="src-sym">}</span></li>
<li><a name="a423"></a>&nbsp;</li>
<li><a name="a424"></a>        <span class="src-var">$compiled_content </span>= <span class="src-var">$template_header </span>. <span class="src-var">$compiled_content</span><span class="src-sym">;</span></li>
<li><a name="a425"></a>        <span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a426"></a>    <span class="src-sym">}</span></li>
<li><a name="a427"></a>&nbsp;</li>
<li><a name="a428"></a>    <span class="src-doc">/**</span></li>
<li><a name="a429"></a><span class="src-doc">     * Compile a template tag</span></li>
<li><a name="a430"></a><span class="src-doc">     *</span></li>
<li><a name="a431"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$template_tag </span></li>
<li><a name="a432"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a433"></a><span class="src-doc">     */</span></li>
<li><a name="a434"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_tag">_compile_tag</a><span class="src-sym">(</span><span class="src-var">$template_tag</span><span class="src-sym">)</span></li>
<li><a name="a435"></a>    <span class="src-sym">{</span></li>
<li><a name="a436"></a>        <span class="src-comm">/* Matched comment. */</span></li>
<li><a name="a437"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$template_tag</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">} </span>== <span class="src-str">'*' </span>&amp;&amp; <span class="src-var">$template_tag</span><span class="src-sym">{</span><a href="http://www.php.net/strlen">strlen</a><span class="src-sym">(</span><span class="src-var">$template_tag</span><span class="src-sym">) </span>- <span class="src-num">1</span><span class="src-sym">} </span>== <span class="src-str">'*'</span><span class="src-sym">)</span></li>
<li><a name="a438"></a>            <span class="src-key">return </span><span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a439"></a>        </li>
<li><a name="a440"></a>        <span class="src-comm">/* Split tag into two three parts: command, command modifiers and the arguments. */</span></li>
<li><a name="a441"></a>        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">! </span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^(?:(' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_call_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_regexp</span></li>
<li><a name="a442"></a>                . <span class="src-str">'|\/?' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_reg_obj_regexp </span>. <span class="src-str">'|\/?' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_func_regexp </span>. <span class="src-str">')(' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*))</span></li>
<li><a name="a443"></a><span class="src-str">                      (?:\s+(.*))?$</span></li>
<li><a name="a444"></a><span class="src-str">                    ~xs'</span><span class="src-sym">, </span><span class="src-var">$template_tag</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a445"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">unrecognized</span> <span class="src-id">tag</span>: <span class="src-var">$template_tag</span></span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a446"></a>        <span class="src-sym">}</span></li>
<li><a name="a447"></a>        </li>
<li><a name="a448"></a>        <span class="src-var">$tag_command </span>= <span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a449"></a>        <span class="src-var">$tag_modifier </span>= isset<span class="src-sym">(</span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">]</span><span class="src-sym">) </span>? <span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">] </span>: <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a450"></a>        <span class="src-var">$tag_args </span>= isset<span class="src-sym">(</span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">3</span><span class="src-sym">]</span><span class="src-sym">) </span>? <span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">3</span><span class="src-sym">] </span>: <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a451"></a>&nbsp;</li>
<li><a name="a452"></a>        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_call_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_regexp </span>. <span class="src-str">'$~'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a453"></a>            <span class="src-comm">/* tag name is a variable or object */</span></li>
<li><a name="a454"></a>            <span class="src-var">$_return </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var_props">_parse_var_props</a><span class="src-sym">(</span><span class="src-var">$tag_command </span>. <span class="src-var">$tag_modifier</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a455"></a>            <span class="src-key">return </span><span class="src-str">&quot;</span><span class="src-str">&lt;?<span class="src-id">php</span> <span class="src-id">echo</span> <span class="src-var">$_return</span>; ?&gt;</span><span class="src-str">&quot; </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_additional_newline</span><span class="src-sym">;</span></li>
<li><a name="a456"></a>        <span class="src-sym">}</span></li>
<li><a name="a457"></a>&nbsp;</li>
<li><a name="a458"></a>        <span class="src-comm">/* If the tag name is a registered object, we process it. */</span></li>
<li><a name="a459"></a>        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^\/?' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_reg_obj_regexp </span>. <span class="src-str">'$~'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a460"></a>            <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_registered_object_tag">_compile_registered_object_tag</a><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_attrs">_parse_attrs</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-var">$tag_modifier</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a461"></a>        <span class="src-sym">}</span></li>
<li><a name="a462"></a>&nbsp;</li>
<li><a name="a463"></a>        <span class="src-key">switch </span><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a464"></a>            <span class="src-key">case </span><span class="src-str">'include'</span>:</li>
<li><a name="a465"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_include_tag">_compile_include_tag</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a466"></a>&nbsp;</li>
<li><a name="a467"></a>            <span class="src-key">case </span><span class="src-str">'include_php'</span>:</li>
<li><a name="a468"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_include_php_tag">_compile_include_php_tag</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a469"></a>&nbsp;</li>
<li><a name="a470"></a>            <span class="src-key">case </span><span class="src-str">'if'</span>:</li>
<li><a name="a471"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_push_tag">_push_tag</a><span class="src-sym">(</span><span class="src-str">'if'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a472"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_if_tag">_compile_if_tag</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a473"></a>&nbsp;</li>
<li><a name="a474"></a>            <span class="src-key">case </span><span class="src-str">'else'</span>:</li>
<li><a name="a475"></a>                list<span class="src-sym">(</span><span class="src-var">$_open_tag</span><span class="src-sym">) </span>= <a href="http://www.php.net/end">end</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_tag_stack</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a476"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_open_tag </span>!= <span class="src-str">'if' </span>&amp;&amp; <span class="src-var">$_open_tag </span>!= <span class="src-str">'elseif'</span><span class="src-sym">)</span></li>
<li><a name="a477"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">'unexpected {else}'</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a478"></a>                <span class="src-key">else</span></li>
<li><a name="a479"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_push_tag">_push_tag</a><span class="src-sym">(</span><span class="src-str">'else'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a480"></a>                <span class="src-key">return </span><span class="src-str">'&lt;?php else: ?&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a481"></a>&nbsp;</li>
<li><a name="a482"></a>            <span class="src-key">case </span><span class="src-str">'elseif'</span>:</li>
<li><a name="a483"></a>                list<span class="src-sym">(</span><span class="src-var">$_open_tag</span><span class="src-sym">) </span>= <a href="http://www.php.net/end">end</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_tag_stack</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a484"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_open_tag </span>!= <span class="src-str">'if' </span>&amp;&amp; <span class="src-var">$_open_tag </span>!= <span class="src-str">'elseif'</span><span class="src-sym">)</span></li>
<li><a name="a485"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">'unexpected {elseif}'</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a486"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_open_tag </span>== <span class="src-str">'if'</span><span class="src-sym">)</span></li>
<li><a name="a487"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_push_tag">_push_tag</a><span class="src-sym">(</span><span class="src-str">'elseif'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a488"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_if_tag">_compile_if_tag</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">, </span><span class="src-id">true</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a489"></a>&nbsp;</li>
<li><a name="a490"></a>            <span class="src-key">case </span><span class="src-str">'/if'</span>:</li>
<li><a name="a491"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_pop_tag">_pop_tag</a><span class="src-sym">(</span><span class="src-str">'if'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a492"></a>                <span class="src-key">return </span><span class="src-str">'&lt;?php endif; ?&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a493"></a>&nbsp;</li>
<li><a name="a494"></a>            <span class="src-key">case </span><span class="src-str">'capture'</span>:</li>
<li><a name="a495"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_capture_tag">_compile_capture_tag</a><span class="src-sym">(</span><span class="src-id">true</span><span class="src-sym">, </span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a496"></a>&nbsp;</li>
<li><a name="a497"></a>            <span class="src-key">case </span><span class="src-str">'/capture'</span>:</li>
<li><a name="a498"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_capture_tag">_compile_capture_tag</a><span class="src-sym">(</span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a499"></a>&nbsp;</li>
<li><a name="a500"></a>            <span class="src-key">case </span><span class="src-str">'ldelim'</span>:</li>
<li><a name="a501"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">left_delimiter</span><span class="src-sym">;</span></li>
<li><a name="a502"></a>&nbsp;</li>
<li><a name="a503"></a>            <span class="src-key">case </span><span class="src-str">'rdelim'</span>:</li>
<li><a name="a504"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">right_delimiter</span><span class="src-sym">;</span></li>
<li><a name="a505"></a>&nbsp;</li>
<li><a name="a506"></a>            <span class="src-key">case </span><span class="src-str">'section'</span>:</li>
<li><a name="a507"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_push_tag">_push_tag</a><span class="src-sym">(</span><span class="src-str">'section'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a508"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_section_start">_compile_section_start</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a509"></a>&nbsp;</li>
<li><a name="a510"></a>            <span class="src-key">case </span><span class="src-str">'sectionelse'</span>:</li>
<li><a name="a511"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_push_tag">_push_tag</a><span class="src-sym">(</span><span class="src-str">'sectionelse'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a512"></a>                <span class="src-key">return </span><span class="src-str">&quot;&lt;?php endfor; else: ?&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a513"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a514"></a>&nbsp;</li>
<li><a name="a515"></a>            <span class="src-key">case </span><span class="src-str">'/section'</span>:</li>
<li><a name="a516"></a>                <span class="src-var">$_open_tag </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_pop_tag">_pop_tag</a><span class="src-sym">(</span><span class="src-str">'section'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a517"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_open_tag </span>== <span class="src-str">'sectionelse'</span><span class="src-sym">)</span></li>
<li><a name="a518"></a>                    <span class="src-key">return </span><span class="src-str">&quot;&lt;?php endif; ?&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a519"></a>                <span class="src-key">else</span></li>
<li><a name="a520"></a>                    <span class="src-key">return </span><span class="src-str">&quot;&lt;?php endfor; endif; ?&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a521"></a>&nbsp;</li>
<li><a name="a522"></a>            <span class="src-key">case </span><span class="src-str">'foreach'</span>:</li>
<li><a name="a523"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_push_tag">_push_tag</a><span class="src-sym">(</span><span class="src-str">'foreach'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a524"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_foreach_start">_compile_foreach_start</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a525"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a526"></a>&nbsp;</li>
<li><a name="a527"></a>            <span class="src-key">case </span><span class="src-str">'foreachelse'</span>:</li>
<li><a name="a528"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_push_tag">_push_tag</a><span class="src-sym">(</span><span class="src-str">'foreachelse'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a529"></a>                <span class="src-key">return </span><span class="src-str">&quot;&lt;?php endforeach; else: ?&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a530"></a>&nbsp;</li>
<li><a name="a531"></a>            <span class="src-key">case </span><span class="src-str">'/foreach'</span>:</li>
<li><a name="a532"></a>                <span class="src-var">$_open_tag </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_pop_tag">_pop_tag</a><span class="src-sym">(</span><span class="src-str">'foreach'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a533"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_open_tag </span>== <span class="src-str">'foreachelse'</span><span class="src-sym">)</span></li>
<li><a name="a534"></a>                    <span class="src-key">return </span><span class="src-str">&quot;&lt;?php endif; unset(\$_from); ?&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a535"></a>                <span class="src-key">else</span></li>
<li><a name="a536"></a>                    <span class="src-key">return </span><span class="src-str">&quot;&lt;?php endforeach; endif; unset(\$_from); ?&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a537"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a538"></a>&nbsp;</li>
<li><a name="a539"></a>            <span class="src-key">case </span><span class="src-str">'strip'</span>:</li>
<li><a name="a540"></a>            <span class="src-key">case </span><span class="src-str">'/strip'</span>:</li>
<li><a name="a541"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">}</span>==<span class="src-str">'/'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a542"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_pop_tag">_pop_tag</a><span class="src-sym">(</span><span class="src-str">'strip'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a543"></a>                    <span class="src-key">if </span><span class="src-sym">(</span>--<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_strip_depth</span>==<span class="src-num">0</span><span class="src-sym">) </span><span class="src-sym">{ </span><span class="src-comm">/* outermost closing {/strip} */</span></li>
<li><a name="a544"></a>                        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_additional_newline </span>= <span class="src-str">&quot;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a545"></a>                        <span class="src-key">return </span><span class="src-str">'{' </span>. <span class="src-var">$tag_command </span>. <span class="src-str">'}'</span><span class="src-sym">;</span></li>
<li><a name="a546"></a>                    <span class="src-sym">}</span></li>
<li><a name="a547"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a548"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_push_tag">_push_tag</a><span class="src-sym">(</span><span class="src-str">'strip'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a549"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_strip_depth</span>++==<span class="src-num">0</span><span class="src-sym">) </span><span class="src-sym">{ </span><span class="src-comm">/* outermost opening {strip} */</span></li>
<li><a name="a550"></a>                        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_additional_newline </span>= <span class="src-str">&quot;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a551"></a>                        <span class="src-key">return </span><span class="src-str">'{' </span>. <span class="src-var">$tag_command </span>. <span class="src-str">'}'</span><span class="src-sym">;</span></li>
<li><a name="a552"></a>                    <span class="src-sym">}</span></li>
<li><a name="a553"></a>                <span class="src-sym">}</span></li>
<li><a name="a554"></a>                <span class="src-key">return </span><span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a555"></a>&nbsp;</li>
<li><a name="a556"></a>            <span class="src-key">case </span><span class="src-str">'php'</span>:</li>
<li><a name="a557"></a>                <span class="src-comm">/* handle folded tags replaced by {php} */</span></li>
<li><a name="a558"></a>                list<span class="src-sym">(</span><span class="src-sym">, </span><span class="src-var">$block</span><span class="src-sym">) </span>= <a href="http://www.php.net/each">each</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_folded_blocks</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a559"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_line_no </span>+= <a href="http://www.php.net/substr_count">substr_count</a><span class="src-sym">(</span><span class="src-var">$block</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-str">&quot;\n&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a560"></a>                <span class="src-comm">/* the number of matched elements in the regexp in _compile_file()</span></li>
<li><a name="a561"></a><span class="src-comm">                   determins the type of folded tag that was found */</span></li>
<li><a name="a562"></a>                <span class="src-key">switch </span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$block</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a563"></a>                    <span class="src-key">case </span><span class="src-num">2</span>: <span class="src-comm">/* comment */</span></li>
<li><a name="a564"></a>                        <span class="src-key">return </span><span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a565"></a>&nbsp;</li>
<li><a name="a566"></a>                    <span class="src-key">case </span><span class="src-num">3</span>: <span class="src-comm">/* literal */</span></li>
<li><a name="a567"></a>                        <span class="src-key">return </span><span class="src-str">&quot;&lt;?php echo '&quot; </span>. <a href="http://www.php.net/strtr">strtr</a><span class="src-sym">(</span><span class="src-var">$block</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;'&quot;</span>=&gt;<span class="src-str">&quot;\'&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;\\&quot;</span>=&gt;<span class="src-str">&quot;\\\\&quot;</span><span class="src-sym">)) </span>. <span class="src-str">&quot;'; ?&gt;&quot; </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_additional_newline</span><span class="src-sym">;</span></li>
<li><a name="a568"></a>&nbsp;</li>
<li><a name="a569"></a>                    <span class="src-key">case </span><span class="src-num">4</span>: <span class="src-comm">/* php */</span></li>
<li><a name="a570"></a>                        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">security </span>&amp;&amp; <span class="src-sym">!</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">security_settings</span><span class="src-sym">[</span><span class="src-str">'PHP_TAGS'</span><span class="src-sym">]</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a571"></a>                            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;(secure mode) php tags not permitted&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_WARNING</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a572"></a>                            <span class="src-key">return</span><span class="src-sym">;</span></li>
<li><a name="a573"></a>                        <span class="src-sym">}</span></li>
<li><a name="a574"></a>                        <span class="src-key">return </span><span class="src-str">'&lt;?php ' </span>. <span class="src-var">$block</span><span class="src-sym">[</span><span class="src-num">3</span><span class="src-sym">] </span>.<span class="src-str">' ?&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a575"></a>                <span class="src-sym">}</span></li>
<li><a name="a576"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a577"></a>&nbsp;</li>
<li><a name="a578"></a>            <span class="src-key">case </span><span class="src-str">'insert'</span>:</li>
<li><a name="a579"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_insert_tag">_compile_insert_tag</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a580"></a>&nbsp;</li>
<li><a name="a581"></a>            <span class="src-key">default</span>:</li>
<li><a name="a582"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_compiler_tag">_compile_compiler_tag</a><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">, </span><span class="src-var">$tag_args</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a583"></a>                    <span class="src-key">return </span><span class="src-var">$output</span><span class="src-sym">;</span></li>
<li><a name="a584"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_block_tag">_compile_block_tag</a><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">, </span><span class="src-var">$tag_args</span><span class="src-sym">, </span><span class="src-var">$tag_modifier</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a585"></a>                    <span class="src-key">return </span><span class="src-var">$output</span><span class="src-sym">;</span></li>
<li><a name="a586"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_custom_tag">_compile_custom_tag</a><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">, </span><span class="src-var">$tag_args</span><span class="src-sym">, </span><span class="src-var">$tag_modifier</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a587"></a>                    <span class="src-key">return </span><span class="src-var">$output</span><span class="src-sym">;                    </span></li>
<li><a name="a588"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a589"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">unrecognized</span> <span class="src-id">tag</span> '<span class="src-var">$tag_command</span>'</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a590"></a>                <span class="src-sym">}</span></li>
<li><a name="a591"></a>&nbsp;</li>
<li><a name="a592"></a>        <span class="src-sym">}</span></li>
<li><a name="a593"></a>    <span class="src-sym">}</span></li>
<li><a name="a594"></a>&nbsp;</li>
<li><a name="a595"></a>&nbsp;</li>
<li><a name="a596"></a>    <span class="src-doc">/**</span></li>
<li><a name="a597"></a><span class="src-doc">     * compile the custom compiler tag</span></li>
<li><a name="a598"></a><span class="src-doc">     *</span></li>
<li><a name="a599"></a><span class="src-doc">     * sets $output to the compiled custom compiler tag</span></li>
<li><a name="a600"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_command </span></li>
<li><a name="a601"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_args </span></li>
<li><a name="a602"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$output </span></li>
<li><a name="a603"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">boolean </span></li>
<li><a name="a604"></a><span class="src-doc">     */</span></li>
<li><a name="a605"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_compiler_tag">_compile_compiler_tag</a><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">, </span><span class="src-var">$tag_args</span><span class="src-sym">, </span><span class="src-sym">&amp;</span><span class="src-var">$output</span><span class="src-sym">)</span></li>
<li><a name="a606"></a>    <span class="src-sym">{</span></li>
<li><a name="a607"></a>        <span class="src-var">$found </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a608"></a>        <span class="src-var">$have_function </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a609"></a>&nbsp;</li>
<li><a name="a610"></a>        <span class="src-comm">/*</span></li>
<li><a name="a611"></a><span class="src-comm">         * First we check if the compiler function has already been registered</span></li>
<li><a name="a612"></a><span class="src-comm">         * or loaded from a plugin file.</span></li>
<li><a name="a613"></a><span class="src-comm">         */</span></li>
<li><a name="a614"></a>        <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'compiler'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$tag_command</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a615"></a>            <span class="src-var">$found </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a616"></a>            <span class="src-var">$plugin_func </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'compiler'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$tag_command</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a617"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/is_callable">is_callable</a><span class="src-sym">(</span><span class="src-var">$plugin_func</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a618"></a>                <span class="src-var">$message </span>= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">compiler</span> <span class="src-id">function</span> '<span class="src-var">$tag_command</span>' <span class="src-id">is</span> <span class="src-id">not</span> <span class="src-id">implemented</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a619"></a>                <span class="src-var">$have_function </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a620"></a>            <span class="src-sym">}</span></li>
<li><a name="a621"></a>        <span class="src-sym">}</span></li>
<li><a name="a622"></a>        <span class="src-comm">/*</span></li>
<li><a name="a623"></a><span class="src-comm">         * Otherwise we need to load plugin file and look for the function</span></li>
<li><a name="a624"></a><span class="src-comm">         * inside it.</span></li>
<li><a name="a625"></a><span class="src-comm">         */</span></li>
<li><a name="a626"></a>        <span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$plugin_file </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_get_plugin_filepath</span><span class="src-sym">(</span><span class="src-str">'compiler'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a627"></a>            <span class="src-var">$found </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a628"></a>&nbsp;</li>
<li><a name="a629"></a>            <span class="src-inc">include_once </span><span class="src-var">$plugin_file</span><span class="src-sym">;</span></li>
<li><a name="a630"></a>&nbsp;</li>
<li><a name="a631"></a>            <span class="src-var">$plugin_func </span>= <span class="src-str">'smarty_compiler_' </span>. <span class="src-var">$tag_command</span><span class="src-sym">;</span></li>
<li><a name="a632"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/is_callable">is_callable</a><span class="src-sym">(</span><span class="src-var">$plugin_func</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a633"></a>                <span class="src-var">$message </span>= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">plugin</span> <span class="src-id">function</span> <span class="src-var">$plugin_func</span>() <span class="src-id">not</span> <span class="src-id">found</span> <span class="src-id">in</span> <span class="src-var">$plugin_file</span>\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a634"></a>                <span class="src-var">$have_function </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a635"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a636"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'compiler'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$tag_command</span><span class="src-sym">] </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-var">$plugin_func</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">true</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a637"></a>            <span class="src-sym">}</span></li>
<li><a name="a638"></a>        <span class="src-sym">}</span></li>
<li><a name="a639"></a>&nbsp;</li>
<li><a name="a640"></a>        <span class="src-comm">/*</span></li>
<li><a name="a641"></a><span class="src-comm">         * True return value means that we either found a plugin or a</span></li>
<li><a name="a642"></a><span class="src-comm">         * dynamically registered function. False means that we didn't and the</span></li>
<li><a name="a643"></a><span class="src-comm">         * compiler should now emit code to load custom function plugin for this</span></li>
<li><a name="a644"></a><span class="src-comm">         * tag.</span></li>
<li><a name="a645"></a><span class="src-comm">         */</span></li>
<li><a name="a646"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$found</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a647"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$have_function</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a648"></a>                <span class="src-var">$output </span>= <a href="http://www.php.net/call_user_func_array">call_user_func_array</a><span class="src-sym">(</span><span class="src-var">$plugin_func</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">, </span><span class="src-sym">&amp;</span><span class="src-var">$this</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a649"></a>                <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$output </span>!= <span class="src-str">''</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a650"></a>                <span class="src-var">$output </span>= <span class="src-str">'&lt;?php ' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_push_cacheable_state">_push_cacheable_state</a><span class="src-sym">(</span><span class="src-str">'compiler'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)</span></li>
<li><a name="a651"></a>                                   . <span class="src-var">$output</span></li>
<li><a name="a652"></a>                                   . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_pop_cacheable_state">_pop_cacheable_state</a><span class="src-sym">(</span><span class="src-str">'compiler'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">) </span>. <span class="src-str">' ?&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a653"></a>                <span class="src-sym">}</span></li>
<li><a name="a654"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a655"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-var">$message</span><span class="src-sym">, </span><span class="src-id">E_USER_WARNING</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a656"></a>            <span class="src-sym">}</span></li>
<li><a name="a657"></a>            <span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a658"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a659"></a>            <span class="src-key">return </span><span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a660"></a>        <span class="src-sym">}</span></li>
<li><a name="a661"></a>    <span class="src-sym">}</span></li>
<li><a name="a662"></a>&nbsp;</li>
<li><a name="a663"></a>&nbsp;</li>
<li><a name="a664"></a>    <span class="src-doc">/**</span></li>
<li><a name="a665"></a><span class="src-doc">     * compile block function tag</span></li>
<li><a name="a666"></a><span class="src-doc">     *</span></li>
<li><a name="a667"></a><span class="src-doc">     * sets $output to compiled block function tag</span></li>
<li><a name="a668"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_command </span></li>
<li><a name="a669"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_args </span></li>
<li><a name="a670"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_modifier </span></li>
<li><a name="a671"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$output </span></li>
<li><a name="a672"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">boolean </span></li>
<li><a name="a673"></a><span class="src-doc">     */</span></li>
<li><a name="a674"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_block_tag">_compile_block_tag</a><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">, </span><span class="src-var">$tag_args</span><span class="src-sym">, </span><span class="src-var">$tag_modifier</span><span class="src-sym">, </span><span class="src-sym">&amp;</span><span class="src-var">$output</span><span class="src-sym">)</span></li>
<li><a name="a675"></a>    <span class="src-sym">{</span></li>
<li><a name="a676"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">} </span>== <span class="src-str">'/'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a677"></a>            <span class="src-var">$start_tag </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a678"></a>            <span class="src-var">$tag_command </span>= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a679"></a>        <span class="src-sym">} </span><span class="src-key">else</span></li>
<li><a name="a680"></a>            <span class="src-var">$start_tag </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a681"></a>&nbsp;</li>
<li><a name="a682"></a>        <span class="src-var">$found </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a683"></a>        <span class="src-var">$have_function </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a684"></a>&nbsp;</li>
<li><a name="a685"></a>        <span class="src-comm">/*</span></li>
<li><a name="a686"></a><span class="src-comm">         * First we check if the block function has already been registered</span></li>
<li><a name="a687"></a><span class="src-comm">         * or loaded from a plugin file.</span></li>
<li><a name="a688"></a><span class="src-comm">         */</span></li>
<li><a name="a689"></a>        <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'block'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$tag_command</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a690"></a>            <span class="src-var">$found </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a691"></a>            <span class="src-var">$plugin_func </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'block'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$tag_command</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a692"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/is_callable">is_callable</a><span class="src-sym">(</span><span class="src-var">$plugin_func</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a693"></a>                <span class="src-var">$message </span>= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">block</span> <span class="src-id">function</span> '<span class="src-var">$tag_command</span>' <span class="src-id">is</span> <span class="src-id">not</span> <span class="src-id">implemented</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a694"></a>                <span class="src-var">$have_function </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a695"></a>            <span class="src-sym">}</span></li>
<li><a name="a696"></a>        <span class="src-sym">}</span></li>
<li><a name="a697"></a>        <span class="src-comm">/*</span></li>
<li><a name="a698"></a><span class="src-comm">         * Otherwise we need to load plugin file and look for the function</span></li>
<li><a name="a699"></a><span class="src-comm">         * inside it.</span></li>
<li><a name="a700"></a><span class="src-comm">         */</span></li>
<li><a name="a701"></a>        <span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$plugin_file </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_get_plugin_filepath</span><span class="src-sym">(</span><span class="src-str">'block'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a702"></a>            <span class="src-var">$found </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a703"></a>&nbsp;</li>
<li><a name="a704"></a>            <span class="src-inc">include_once </span><span class="src-var">$plugin_file</span><span class="src-sym">;</span></li>
<li><a name="a705"></a>&nbsp;</li>
<li><a name="a706"></a>            <span class="src-var">$plugin_func </span>= <span class="src-str">'smarty_block_' </span>. <span class="src-var">$tag_command</span><span class="src-sym">;</span></li>
<li><a name="a707"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/function_exists">function_exists</a><span class="src-sym">(</span><span class="src-var">$plugin_func</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a708"></a>                <span class="src-var">$message </span>= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">plugin</span> <span class="src-id">function</span> <span class="src-var">$plugin_func</span>() <span class="src-id">not</span> <span class="src-id">found</span> <span class="src-id">in</span> <span class="src-var">$plugin_file</span>\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a709"></a>                <span class="src-var">$have_function </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a710"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a711"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'block'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$tag_command</span><span class="src-sym">] </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-var">$plugin_func</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">true</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a712"></a>&nbsp;</li>
<li><a name="a713"></a>            <span class="src-sym">}</span></li>
<li><a name="a714"></a>        <span class="src-sym">}</span></li>
<li><a name="a715"></a>&nbsp;</li>
<li><a name="a716"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-var">$found</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a717"></a>            <span class="src-key">return </span><span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a718"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-var">$have_function</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a719"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-var">$message</span><span class="src-sym">, </span><span class="src-id">E_USER_WARNING</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a720"></a>            <span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a721"></a>        <span class="src-sym">}</span></li>
<li><a name="a722"></a>&nbsp;</li>
<li><a name="a723"></a>        <span class="src-comm">/*</span></li>
<li><a name="a724"></a><span class="src-comm">         * Even though we've located the plugin function, compilation</span></li>
<li><a name="a725"></a><span class="src-comm">         * happens only once, so the plugin will still need to be loaded</span></li>
<li><a name="a726"></a><span class="src-comm">         * at runtime for future requests.</span></li>
<li><a name="a727"></a><span class="src-comm">         */</span></li>
<li><a name="a728"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_add_plugin">_add_plugin</a><span class="src-sym">(</span><span class="src-str">'block'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a729"></a>&nbsp;</li>
<li><a name="a730"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$start_tag</span><span class="src-sym">)</span></li>
<li><a name="a731"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_push_tag">_push_tag</a><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a732"></a>        <span class="src-key">else</span></li>
<li><a name="a733"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_pop_tag">_pop_tag</a><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a734"></a>&nbsp;</li>
<li><a name="a735"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$start_tag</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a736"></a>            <span class="src-var">$output </span>= <span class="src-str">'&lt;?php ' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_push_cacheable_state">_push_cacheable_state</a><span class="src-sym">(</span><span class="src-str">'block'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a737"></a>            <span class="src-var">$attrs </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_attrs">_parse_attrs</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a738"></a>            <span class="src-var">$arg_list </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_arg_list">_compile_arg_list</a><span class="src-sym">(</span><span class="src-str">'block'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">, </span><span class="src-var">$attrs</span><span class="src-sym">, </span><span class="src-var">$_cache_attrs</span>=<span class="src-str">''</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a739"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str"><span class="src-var">$_cache_attrs</span>\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_tag_stack</span><span class="src-sym">[</span><span class="src-sym">]</span> = <span class="src-id">array</span>('<span class="src-var">$tag_command</span>', <span class="src-id">array</span>(</span><span class="src-str">&quot;</span>.<a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">','</span><span class="src-sym">, </span><span class="src-var">$arg_list</span><span class="src-sym">)</span>.<span class="src-str">')); '</span><span class="src-sym">;</span></li>
<li><a name="a740"></a>            <span class="src-var">$output </span>.= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_plugin_call">_compile_plugin_call</a><span class="src-sym">(</span><span class="src-str">'block'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)</span>.<span class="src-str">'($this-&gt;_tag_stack[count($this-&gt;_tag_stack)-1][1], null, $this, $_block_repeat=true);'</span><span class="src-sym">;</span></li>
<li><a name="a741"></a>            <span class="src-var">$output </span>.= <span class="src-str">'while ($_block_repeat) { ob_start(); ?&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a742"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a743"></a>            <span class="src-var">$output </span>= <span class="src-str">'&lt;?php $_block_content = ob_get_contents(); ob_end_clean(); '</span><span class="src-sym">;</span></li>
<li><a name="a744"></a>            <span class="src-var">$_out_tag_text </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_plugin_call">_compile_plugin_call</a><span class="src-sym">(</span><span class="src-str">'block'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)</span>.<span class="src-str">'($this-&gt;_tag_stack[count($this-&gt;_tag_stack)-1][1], $_block_content, $this, $_block_repeat=false)'</span><span class="src-sym">;</span></li>
<li><a name="a745"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$tag_modifier </span>!= <span class="src-str">''</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a746"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_modifiers">_parse_modifiers</a><span class="src-sym">(</span><span class="src-var">$_out_tag_text</span><span class="src-sym">, </span><span class="src-var">$tag_modifier</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a747"></a>            <span class="src-sym">}</span></li>
<li><a name="a748"></a>            <span class="src-var">$output </span>.= <span class="src-str">'echo '</span>.<span class="src-var">$_out_tag_text</span>.<span class="src-str">'; } '</span><span class="src-sym">;</span></li>
<li><a name="a749"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot; array_pop(\$this-&gt;_tag_stack); &quot; </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_pop_cacheable_state">_pop_cacheable_state</a><span class="src-sym">(</span><span class="src-str">'block'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">) </span>. <span class="src-str">'?&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a750"></a>        <span class="src-sym">}</span></li>
<li><a name="a751"></a>&nbsp;</li>
<li><a name="a752"></a>        <span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a753"></a>    <span class="src-sym">}</span></li>
<li><a name="a754"></a>&nbsp;</li>
<li><a name="a755"></a>&nbsp;</li>
<li><a name="a756"></a>    <span class="src-doc">/**</span></li>
<li><a name="a757"></a><span class="src-doc">     * compile custom function tag</span></li>
<li><a name="a758"></a><span class="src-doc">     *</span></li>
<li><a name="a759"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_command </span></li>
<li><a name="a760"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_args </span></li>
<li><a name="a761"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_modifier </span></li>
<li><a name="a762"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a763"></a><span class="src-doc">     */</span></li>
<li><a name="a764"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_custom_tag">_compile_custom_tag</a><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">, </span><span class="src-var">$tag_args</span><span class="src-sym">, </span><span class="src-var">$tag_modifier</span><span class="src-sym">, </span><span class="src-sym">&amp;</span><span class="src-var">$output</span><span class="src-sym">)</span></li>
<li><a name="a765"></a>    <span class="src-sym">{</span></li>
<li><a name="a766"></a>        <span class="src-var">$found </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a767"></a>        <span class="src-var">$have_function </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a768"></a>&nbsp;</li>
<li><a name="a769"></a>        <span class="src-comm">/*</span></li>
<li><a name="a770"></a><span class="src-comm">         * First we check if the custom function has already been registered</span></li>
<li><a name="a771"></a><span class="src-comm">         * or loaded from a plugin file.</span></li>
<li><a name="a772"></a><span class="src-comm">         */</span></li>
<li><a name="a773"></a>        <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'function'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$tag_command</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a774"></a>            <span class="src-var">$found </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a775"></a>            <span class="src-var">$plugin_func </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'function'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$tag_command</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a776"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/is_callable">is_callable</a><span class="src-sym">(</span><span class="src-var">$plugin_func</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a777"></a>                <span class="src-var">$message </span>= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">custom</span> <span class="src-id">function</span> '<span class="src-var">$tag_command</span>' <span class="src-id">is</span> <span class="src-id">not</span> <span class="src-id">implemented</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a778"></a>                <span class="src-var">$have_function </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a779"></a>            <span class="src-sym">}</span></li>
<li><a name="a780"></a>        <span class="src-sym">}</span></li>
<li><a name="a781"></a>        <span class="src-comm">/*</span></li>
<li><a name="a782"></a><span class="src-comm">         * Otherwise we need to load plugin file and look for the function</span></li>
<li><a name="a783"></a><span class="src-comm">         * inside it.</span></li>
<li><a name="a784"></a><span class="src-comm">         */</span></li>
<li><a name="a785"></a>        <span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$plugin_file </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_get_plugin_filepath</span><span class="src-sym">(</span><span class="src-str">'function'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a786"></a>            <span class="src-var">$found </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a787"></a>&nbsp;</li>
<li><a name="a788"></a>            <span class="src-inc">include_once </span><span class="src-var">$plugin_file</span><span class="src-sym">;</span></li>
<li><a name="a789"></a>&nbsp;</li>
<li><a name="a790"></a>            <span class="src-var">$plugin_func </span>= <span class="src-str">'smarty_function_' </span>. <span class="src-var">$tag_command</span><span class="src-sym">;</span></li>
<li><a name="a791"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/function_exists">function_exists</a><span class="src-sym">(</span><span class="src-var">$plugin_func</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a792"></a>                <span class="src-var">$message </span>= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">plugin</span> <span class="src-id">function</span> <span class="src-var">$plugin_func</span>() <span class="src-id">not</span> <span class="src-id">found</span> <span class="src-id">in</span> <span class="src-var">$plugin_file</span>\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a793"></a>                <span class="src-var">$have_function </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a794"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a795"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'function'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$tag_command</span><span class="src-sym">] </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-var">$plugin_func</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">true</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a796"></a>&nbsp;</li>
<li><a name="a797"></a>            <span class="src-sym">}</span></li>
<li><a name="a798"></a>        <span class="src-sym">}</span></li>
<li><a name="a799"></a>&nbsp;</li>
<li><a name="a800"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-var">$found</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a801"></a>            <span class="src-key">return </span><span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a802"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-var">$have_function</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a803"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-var">$message</span><span class="src-sym">, </span><span class="src-id">E_USER_WARNING</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a804"></a>            <span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a805"></a>        <span class="src-sym">}</span></li>
<li><a name="a806"></a>&nbsp;</li>
<li><a name="a807"></a>        <span class="src-comm">/* declare plugin to be loaded on display of the template that</span></li>
<li><a name="a808"></a><span class="src-comm">           we compile right now */</span></li>
<li><a name="a809"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_add_plugin">_add_plugin</a><span class="src-sym">(</span><span class="src-str">'function'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a810"></a>&nbsp;</li>
<li><a name="a811"></a>        <span class="src-var">$_cacheable_state </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_push_cacheable_state">_push_cacheable_state</a><span class="src-sym">(</span><span class="src-str">'function'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a812"></a>        <span class="src-var">$attrs </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_attrs">_parse_attrs</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a813"></a>        <span class="src-var">$arg_list </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_arg_list">_compile_arg_list</a><span class="src-sym">(</span><span class="src-str">'function'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">, </span><span class="src-var">$attrs</span><span class="src-sym">, </span><span class="src-var">$_cache_attrs</span>=<span class="src-str">''</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a814"></a>&nbsp;</li>
<li><a name="a815"></a>        <span class="src-var">$output </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_plugin_call">_compile_plugin_call</a><span class="src-sym">(</span><span class="src-str">'function'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)</span>.<span class="src-str">'(array('</span>.<a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">','</span><span class="src-sym">, </span><span class="src-var">$arg_list</span><span class="src-sym">)</span>.<span class="src-str">&quot;), \$this)&quot;</span><span class="src-sym">;</span></li>
<li><a name="a816"></a>        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$tag_modifier </span>!= <span class="src-str">''</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a817"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_modifiers">_parse_modifiers</a><span class="src-sym">(</span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$tag_modifier</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a818"></a>        <span class="src-sym">}</span></li>
<li><a name="a819"></a>&nbsp;</li>
<li><a name="a820"></a>        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$output </span>!= <span class="src-str">''</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a821"></a>            <span class="src-var">$output </span>=  <span class="src-str">'&lt;?php ' </span>. <span class="src-var">$_cacheable_state </span>. <span class="src-var">$_cache_attrs </span>. <span class="src-str">'echo ' </span>. <span class="src-var">$output </span>. <span class="src-str">';'</span></li>
<li><a name="a822"></a>                . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_pop_cacheable_state">_pop_cacheable_state</a><span class="src-sym">(</span><span class="src-str">'function'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">) </span>. <span class="src-str">&quot;?&gt;&quot; </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_additional_newline</span><span class="src-sym">;</span></li>
<li><a name="a823"></a>        <span class="src-sym">}</span></li>
<li><a name="a824"></a>&nbsp;</li>
<li><a name="a825"></a>        <span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a826"></a>    <span class="src-sym">}</span></li>
<li><a name="a827"></a>&nbsp;</li>
<li><a name="a828"></a>    <span class="src-doc">/**</span></li>
<li><a name="a829"></a><span class="src-doc">     * compile a registered object tag</span></li>
<li><a name="a830"></a><span class="src-doc">     *</span></li>
<li><a name="a831"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_command </span></li>
<li><a name="a832"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">array </span><span class="src-doc-var">$attrs </span></li>
<li><a name="a833"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_modifier </span></li>
<li><a name="a834"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a835"></a><span class="src-doc">     */</span></li>
<li><a name="a836"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_registered_object_tag">_compile_registered_object_tag</a><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">, </span><span class="src-var">$attrs</span><span class="src-sym">, </span><span class="src-var">$tag_modifier</span><span class="src-sym">)</span></li>
<li><a name="a837"></a>    <span class="src-sym">{</span></li>
<li><a name="a838"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">} </span>== <span class="src-str">'/'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a839"></a>            <span class="src-var">$start_tag </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a840"></a>            <span class="src-var">$tag_command </span>= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$tag_command</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a841"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a842"></a>            <span class="src-var">$start_tag </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a843"></a>        <span class="src-sym">}</span></li>
<li><a name="a844"></a>&nbsp;</li>
<li><a name="a845"></a>        list<span class="src-sym">(</span><span class="src-var">$object</span><span class="src-sym">, </span><span class="src-var">$obj_comp</span><span class="src-sym">) </span>= <a href="http://www.php.net/explode">explode</a><span class="src-sym">(</span><span class="src-str">'-&gt;'</span><span class="src-sym">, </span><span class="src-var">$tag_command</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a846"></a>&nbsp;</li>
<li><a name="a847"></a>        <span class="src-var">$arg_list </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a848"></a>        <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a849"></a>            <span class="src-var">$_assign_var </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a850"></a>            <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$attrs </span><span class="src-key">as </span><span class="src-var">$arg_name </span>=&gt; <span class="src-var">$arg_value</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a851"></a>                <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$arg_name </span>== <span class="src-str">'assign'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a852"></a>                    <span class="src-var">$_assign_var </span>= <span class="src-var">$arg_value</span><span class="src-sym">;</span></li>
<li><a name="a853"></a>                    unset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'assign'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a854"></a>                    <span class="src-key">continue</span><span class="src-sym">;</span></li>
<li><a name="a855"></a>                <span class="src-sym">}</span></li>
<li><a name="a856"></a>                <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/is_bool">is_bool</a><span class="src-sym">(</span><span class="src-var">$arg_value</span><span class="src-sym">))</span></li>
<li><a name="a857"></a>                    <span class="src-var">$arg_value </span>= <span class="src-var">$arg_value </span>? <span class="src-str">'true' </span>: <span class="src-str">'false'</span><span class="src-sym">;</span></li>
<li><a name="a858"></a>                <span class="src-var">$arg_list</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-str">&quot;</span><span class="src-str">'<span class="src-var">$arg_name</span>' =&gt; <span class="src-var">$arg_value</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a859"></a>            <span class="src-sym">}</span></li>
<li><a name="a860"></a>        <span class="src-sym">}</span></li>
<li><a name="a861"></a>&nbsp;</li>
<li><a name="a862"></a>        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_reg_objects</span><span class="src-sym">[</span><span class="src-var">$object</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">]</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a863"></a>            <span class="src-comm">// smarty object argument format</span></li>
<li><a name="a864"></a>            <span class="src-var">$args </span>= <span class="src-str">&quot;array(&quot;</span>.<a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">','</span><span class="src-sym">, </span>(array)<span class="src-var">$arg_list</span><span class="src-sym">)</span>.<span class="src-str">&quot;), \$this&quot;</span><span class="src-sym">;</span></li>
<li><a name="a865"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a866"></a>            <span class="src-comm">// traditional argument format</span></li>
<li><a name="a867"></a>            <span class="src-var">$args </span>= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">','</span><span class="src-sym">, </span><a href="http://www.php.net/array_values">array_values</a><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a868"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$args</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a869"></a>                <span class="src-var">$args </span>= <span class="src-str">'null'</span><span class="src-sym">;</span></li>
<li><a name="a870"></a>            <span class="src-sym">}</span></li>
<li><a name="a871"></a>        <span class="src-sym">}</span></li>
<li><a name="a872"></a>&nbsp;</li>
<li><a name="a873"></a>        <span class="src-var">$prefix </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a874"></a>        <span class="src-var">$postfix </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a875"></a>        <span class="src-var">$newline </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a876"></a>        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/is_object">is_object</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_reg_objects</span><span class="src-sym">[</span><span class="src-var">$object</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a877"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_trigger_fatal_error</span><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">registered</span> '<span class="src-var">$object</span>' <span class="src-id">is</span> <span class="src-id">not</span> <span class="src-id">an</span> <span class="src-id">object</span></span><span class="src-str">&quot; </span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_file</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_line_no</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a878"></a>        <span class="src-sym">} </span><span class="src-key">elseif</span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_reg_objects</span><span class="src-sym">[</span><span class="src-var">$object</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">) </span>&amp;&amp; <span class="src-sym">!</span><a href="http://www.php.net/in_array">in_array</a><span class="src-sym">(</span><span class="src-var">$obj_comp</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_reg_objects</span><span class="src-sym">[</span><span class="src-var">$object</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a879"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_trigger_fatal_error</span><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str">'<span class="src-var">$obj_comp</span>' <span class="src-id">is</span> <span class="src-id">not</span> <span class="src-id">a</span> <span class="src-id">registered</span> <span class="src-id">component</span> <span class="src-id">of</span> <span class="src-id">object</span> '<span class="src-var">$object</span>'</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_file</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_line_no</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a880"></a>        <span class="src-sym">} </span><span class="src-key">elseif</span><span class="src-sym">(</span><a href="http://www.php.net/method_exists">method_exists</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_reg_objects</span><span class="src-sym">[</span><span class="src-var">$object</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-var">$obj_comp</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a881"></a>            <span class="src-comm">// method</span></li>
<li><a name="a882"></a>            <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/in_array">in_array</a><span class="src-sym">(</span><span class="src-var">$obj_comp</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_reg_objects</span><span class="src-sym">[</span><span class="src-var">$object</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">3</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a883"></a>                <span class="src-comm">// block method</span></li>
<li><a name="a884"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$start_tag</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a885"></a>                    <span class="src-var">$prefix </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_tag_stack</span><span class="src-sym">[</span><span class="src-sym">]</span> = <span class="src-id">array</span>('<span class="src-var">$obj_comp</span>', <span class="src-var">$args</span>); </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a886"></a>                    <span class="src-var">$prefix </span>.= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_reg_objects</span><span class="src-sym">[</span>'<span class="src-var">$object</span>'<span class="src-sym">]</span><span class="src-sym">[</span>0<span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-var">$obj_comp</span>(\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_tag_stack</span><span class="src-sym">[</span><span class="src-id">count</span>(\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_tag_stack</span>)-1<span class="src-sym">]</span><span class="src-sym">[</span>1<span class="src-sym">]</span>, <span class="src-id">null</span>, \$<span class="src-id">this</span>, \$<span class="src-id">_block_repeat</span>=<span class="src-id">true</span>); </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a887"></a>                    <span class="src-var">$prefix </span>.= <span class="src-str">&quot;while (\$_block_repeat) { ob_start();&quot;</span><span class="src-sym">;</span></li>
<li><a name="a888"></a>                    <span class="src-var">$return </span>= <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a889"></a>                    <span class="src-var">$postfix </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a890"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a891"></a>                    <span class="src-var">$prefix </span>= <span class="src-str">&quot;\$_obj_block_content = ob_get_contents(); ob_end_clean(); &quot;</span><span class="src-sym">;</span></li>
<li><a name="a892"></a>                    <span class="src-var">$return </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_reg_objects</span><span class="src-sym">[</span>'<span class="src-var">$object</span>'<span class="src-sym">]</span><span class="src-sym">[</span>0<span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-var">$obj_comp</span>(\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_tag_stack</span><span class="src-sym">[</span><span class="src-id">count</span>(\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_tag_stack</span>)-1<span class="src-sym">]</span><span class="src-sym">[</span>1<span class="src-sym">]</span>, \$<span class="src-id">_obj_block_content</span>, \$<span class="src-id">this</span>, \$<span class="src-id">_block_repeat</span>=<span class="src-id">false</span>)</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a893"></a>                    <span class="src-var">$postfix </span>= <span class="src-str">&quot;} array_pop(\$this-&gt;_tag_stack);&quot;</span><span class="src-sym">;</span></li>
<li><a name="a894"></a>                <span class="src-sym">}</span></li>
<li><a name="a895"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a896"></a>                <span class="src-comm">// non-block method</span></li>
<li><a name="a897"></a>                <span class="src-var">$return </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_reg_objects</span><span class="src-sym">[</span>'<span class="src-var">$object</span>'<span class="src-sym">]</span><span class="src-sym">[</span>0<span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-var">$obj_comp</span>(<span class="src-var">$args</span>)</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a898"></a>            <span class="src-sym">}</span></li>
<li><a name="a899"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a900"></a>            <span class="src-comm">// property</span></li>
<li><a name="a901"></a>            <span class="src-var">$return </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_reg_objects</span><span class="src-sym">[</span>'<span class="src-var">$object</span>'<span class="src-sym">]</span><span class="src-sym">[</span>0<span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-var">$obj_comp</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a902"></a>        <span class="src-sym">}</span></li>
<li><a name="a903"></a>&nbsp;</li>
<li><a name="a904"></a>        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$return </span>!= <span class="src-id">null</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a905"></a>            <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$tag_modifier </span>!= <span class="src-str">''</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a906"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_modifiers">_parse_modifiers</a><span class="src-sym">(</span><span class="src-var">$return</span><span class="src-sym">, </span><span class="src-var">$tag_modifier</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a907"></a>            <span class="src-sym">}</span></li>
<li><a name="a908"></a>&nbsp;</li>
<li><a name="a909"></a>            <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_assign_var</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a910"></a>                <span class="src-var">$output </span>= <span class="src-str">&quot;\$this-&gt;assign('&quot; </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_dequote</span><span class="src-sym">(</span><span class="src-var">$_assign_var</span><span class="src-sym">) </span>.<span class="src-str">&quot;</span><span class="src-str">',  <span class="src-var">$return</span>);</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a911"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a912"></a>                <span class="src-var">$output </span>= <span class="src-str">'echo ' </span>. <span class="src-var">$return </span>. <span class="src-str">';'</span><span class="src-sym">;</span></li>
<li><a name="a913"></a>                <span class="src-var">$newline </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_additional_newline</span><span class="src-sym">;</span></li>
<li><a name="a914"></a>            <span class="src-sym">}</span></li>
<li><a name="a915"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a916"></a>            <span class="src-var">$output </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a917"></a>        <span class="src-sym">}</span></li>
<li><a name="a918"></a>&nbsp;</li>
<li><a name="a919"></a>        <span class="src-key">return </span><span class="src-str">'&lt;?php ' </span>. <span class="src-var">$prefix </span>. <span class="src-var">$output </span>. <span class="src-var">$postfix </span>. <span class="src-str">&quot;?&gt;&quot; </span>. <span class="src-var">$newline</span><span class="src-sym">;</span></li>
<li><a name="a920"></a>    <span class="src-sym">}</span></li>
<li><a name="a921"></a>&nbsp;</li>
<li><a name="a922"></a>    <span class="src-doc">/**</span></li>
<li><a name="a923"></a><span class="src-doc">     * Compile {insert ...} tag</span></li>
<li><a name="a924"></a><span class="src-doc">     *</span></li>
<li><a name="a925"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_args </span></li>
<li><a name="a926"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a927"></a><span class="src-doc">     */</span></li>
<li><a name="a928"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_insert_tag">_compile_insert_tag</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span></li>
<li><a name="a929"></a>    <span class="src-sym">{</span></li>
<li><a name="a930"></a>        <span class="src-var">$attrs </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_attrs">_parse_attrs</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a931"></a>        <span class="src-var">$name </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_dequote</span><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'name'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a932"></a>&nbsp;</li>
<li><a name="a933"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a934"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;missing insert name&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a935"></a>        <span class="src-sym">}</span></li>
<li><a name="a936"></a>&nbsp;</li>
<li><a name="a937"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'script'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a938"></a>            <span class="src-var">$delayed_loading </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a939"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a940"></a>            <span class="src-var">$delayed_loading </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a941"></a>        <span class="src-sym">}</span></li>
<li><a name="a942"></a>&nbsp;</li>
<li><a name="a943"></a>        <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$attrs </span><span class="src-key">as </span><span class="src-var">$arg_name </span>=&gt; <span class="src-var">$arg_value</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a944"></a>            <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/is_bool">is_bool</a><span class="src-sym">(</span><span class="src-var">$arg_value</span><span class="src-sym">))</span></li>
<li><a name="a945"></a>                <span class="src-var">$arg_value </span>= <span class="src-var">$arg_value </span>? <span class="src-str">'true' </span>: <span class="src-str">'false'</span><span class="src-sym">;</span></li>
<li><a name="a946"></a>            <span class="src-var">$arg_list</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-str">&quot;</span><span class="src-str">'<span class="src-var">$arg_name</span>' =&gt; <span class="src-var">$arg_value</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a947"></a>        <span class="src-sym">}</span></li>
<li><a name="a948"></a>&nbsp;</li>
<li><a name="a949"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_add_plugin">_add_plugin</a><span class="src-sym">(</span><span class="src-str">'insert'</span><span class="src-sym">, </span><span class="src-var">$name</span><span class="src-sym">, </span><span class="src-var">$delayed_loading</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a950"></a>&nbsp;</li>
<li><a name="a951"></a>        <span class="src-var">$_params </span>= <span class="src-str">&quot;array('args' =&gt; array(&quot;</span>.<a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">', '</span><span class="src-sym">, </span>(array)<span class="src-var">$arg_list</span><span class="src-sym">)</span>.<span class="src-str">&quot;))&quot;</span><span class="src-sym">;</span></li>
<li><a name="a952"></a>&nbsp;</li>
<li><a name="a953"></a>        <span class="src-key">return </span><span class="src-str">&quot;</span><span class="src-str">&lt;?<span class="src-id">php</span> <span class="src-id">require_once</span>(<span class="src-id">SMARTY_CORE_DIR</span> . '<span class="src-id">core</span>.<span class="src-id">run_insert_handler</span>.<span class="src-id">php</span>');\n<span class="src-id">echo</span> <span class="src-id">smarty_core_run_insert_handler</span>(<span class="src-var">$_params</span>, \$<span class="src-id">this</span>); ?&gt;</span><span class="src-str">&quot; </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_additional_newline</span><span class="src-sym">;</span></li>
<li><a name="a954"></a>    <span class="src-sym">}</span></li>
<li><a name="a955"></a>&nbsp;</li>
<li><a name="a956"></a>    <span class="src-doc">/**</span></li>
<li><a name="a957"></a><span class="src-doc">     * Compile {include ...} tag</span></li>
<li><a name="a958"></a><span class="src-doc">     *</span></li>
<li><a name="a959"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_args </span></li>
<li><a name="a960"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a961"></a><span class="src-doc">     */</span></li>
<li><a name="a962"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_include_tag">_compile_include_tag</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span></li>
<li><a name="a963"></a>    <span class="src-sym">{</span></li>
<li><a name="a964"></a>        <span class="src-var">$attrs </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_attrs">_parse_attrs</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a965"></a>        <span class="src-var">$arg_list </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a966"></a>&nbsp;</li>
<li><a name="a967"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'file'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a968"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;missing 'file' attribute in include tag&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a969"></a>        <span class="src-sym">}</span></li>
<li><a name="a970"></a>&nbsp;</li>
<li><a name="a971"></a>        <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$attrs </span><span class="src-key">as </span><span class="src-var">$arg_name </span>=&gt; <span class="src-var">$arg_value</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a972"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$arg_name </span>== <span class="src-str">'file'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a973"></a>                <span class="src-var">$include_file </span>= <span class="src-var">$arg_value</span><span class="src-sym">;</span></li>
<li><a name="a974"></a>                <span class="src-key">continue</span><span class="src-sym">;</span></li>
<li><a name="a975"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$arg_name </span>== <span class="src-str">'assign'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a976"></a>                <span class="src-var">$assign_var </span>= <span class="src-var">$arg_value</span><span class="src-sym">;</span></li>
<li><a name="a977"></a>                <span class="src-key">continue</span><span class="src-sym">;</span></li>
<li><a name="a978"></a>            <span class="src-sym">}</span></li>
<li><a name="a979"></a>            <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/is_bool">is_bool</a><span class="src-sym">(</span><span class="src-var">$arg_value</span><span class="src-sym">))</span></li>
<li><a name="a980"></a>                <span class="src-var">$arg_value </span>= <span class="src-var">$arg_value </span>? <span class="src-str">'true' </span>: <span class="src-str">'false'</span><span class="src-sym">;</span></li>
<li><a name="a981"></a>            <span class="src-var">$arg_list</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-str">&quot;</span><span class="src-str">'<span class="src-var">$arg_name</span>' =&gt; <span class="src-var">$arg_value</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a982"></a>        <span class="src-sym">}</span></li>
<li><a name="a983"></a>&nbsp;</li>
<li><a name="a984"></a>        <span class="src-var">$output </span>= <span class="src-str">'&lt;?php '</span><span class="src-sym">;</span></li>
<li><a name="a985"></a>&nbsp;</li>
<li><a name="a986"></a>        <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$assign_var</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a987"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;ob_start();\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a988"></a>        <span class="src-sym">}</span></li>
<li><a name="a989"></a>&nbsp;</li>
<li><a name="a990"></a>        <span class="src-var">$output </span>.=</li>
<li><a name="a991"></a>            <span class="src-str">&quot;\$_smarty_tpl_vars = \$this-&gt;_tpl_vars;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a992"></a>&nbsp;</li>
<li><a name="a993"></a>&nbsp;</li>
<li><a name="a994"></a>        <span class="src-var">$_params </span>= <span class="src-str">&quot;array('smarty_include_tpl_file' =&gt; &quot; </span>. <span class="src-var">$include_file </span>. <span class="src-str">&quot;, 'smarty_include_vars' =&gt; array(&quot;</span>.<a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">','</span><span class="src-sym">, </span>(array)<span class="src-var">$arg_list</span><span class="src-sym">)</span>.<span class="src-str">&quot;))&quot;</span><span class="src-sym">;</span></li>
<li><a name="a995"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_smarty_include</span>(<span class="src-var">$_params</span>);\n</span><span class="src-str">&quot; </span>.</li>
<li><a name="a996"></a>        <span class="src-str">&quot;\$this-&gt;_tpl_vars = \$_smarty_tpl_vars;\n&quot; </span>.</li>
<li><a name="a997"></a>        <span class="src-str">&quot;unset(\$_smarty_tpl_vars);\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a998"></a>&nbsp;</li>
<li><a name="a999"></a>        <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$assign_var</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1000"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;\$this-&gt;assign(&quot; </span>. <span class="src-var">$assign_var </span>. <span class="src-str">&quot;, ob_get_contents()); ob_end_clean();\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1001"></a>        <span class="src-sym">}</span></li>
<li><a name="a1002"></a>&nbsp;</li>
<li><a name="a1003"></a>        <span class="src-var">$output </span>.= <span class="src-str">' ?&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a1004"></a>&nbsp;</li>
<li><a name="a1005"></a>        <span class="src-key">return </span><span class="src-var">$output</span><span class="src-sym">;</span></li>
<li><a name="a1006"></a>&nbsp;</li>
<li><a name="a1007"></a>    <span class="src-sym">}</span></li>
<li><a name="a1008"></a>&nbsp;</li>
<li><a name="a1009"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1010"></a><span class="src-doc">     * Compile {include ...} tag</span></li>
<li><a name="a1011"></a><span class="src-doc">     *</span></li>
<li><a name="a1012"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_args </span></li>
<li><a name="a1013"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a1014"></a><span class="src-doc">     */</span></li>
<li><a name="a1015"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_include_php_tag">_compile_include_php_tag</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span></li>
<li><a name="a1016"></a>    <span class="src-sym">{</span></li>
<li><a name="a1017"></a>        <span class="src-var">$attrs </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_attrs">_parse_attrs</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1018"></a>&nbsp;</li>
<li><a name="a1019"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'file'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1020"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;missing 'file' attribute in include_php tag&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1021"></a>        <span class="src-sym">}</span></li>
<li><a name="a1022"></a>&nbsp;</li>
<li><a name="a1023"></a>        <span class="src-var">$assign_var </span>= <span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'assign'</span><span class="src-sym">]</span><span class="src-sym">)) </span>? <span class="src-str">'' </span>: <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_dequote</span><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'assign'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1024"></a>        <span class="src-var">$once_var </span>= <span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'once'</span><span class="src-sym">]</span><span class="src-sym">) </span>|| <span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'once'</span><span class="src-sym">]</span>==<span class="src-str">'false'</span><span class="src-sym">) </span>? <span class="src-str">'false' </span>: <span class="src-str">'true'</span><span class="src-sym">;</span></li>
<li><a name="a1025"></a>&nbsp;</li>
<li><a name="a1026"></a>        <span class="src-var">$arg_list </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1027"></a>        <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$attrs </span><span class="src-key">as </span><span class="src-var">$arg_name </span>=&gt; <span class="src-var">$arg_value</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1028"></a>            <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$arg_name </span>!= <span class="src-str">'file' </span><span class="src-key">AND </span><span class="src-var">$arg_name </span>!= <span class="src-str">'once' </span><span class="src-key">AND </span><span class="src-var">$arg_name </span>!= <span class="src-str">'assign'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1029"></a>                <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/is_bool">is_bool</a><span class="src-sym">(</span><span class="src-var">$arg_value</span><span class="src-sym">))</span></li>
<li><a name="a1030"></a>                    <span class="src-var">$arg_value </span>= <span class="src-var">$arg_value </span>? <span class="src-str">'true' </span>: <span class="src-str">'false'</span><span class="src-sym">;</span></li>
<li><a name="a1031"></a>                <span class="src-var">$arg_list</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-str">&quot;</span><span class="src-str">'<span class="src-var">$arg_name</span>' =&gt; <span class="src-var">$arg_value</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1032"></a>            <span class="src-sym">}</span></li>
<li><a name="a1033"></a>        <span class="src-sym">}</span></li>
<li><a name="a1034"></a>&nbsp;</li>
<li><a name="a1035"></a>        <span class="src-var">$_params </span>= <span class="src-str">&quot;array('smarty_file' =&gt; &quot; </span>. <span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'file'</span><span class="src-sym">] </span>. <span class="src-str">&quot;</span><span class="src-str">, '<span class="src-id">smarty_assign</span>' =&gt; '<span class="src-var">$assign_var</span>', '<span class="src-id">smarty_once</span>' =&gt; <span class="src-var">$once_var</span>, '<span class="src-id">smarty_include_vars</span>' =&gt; <span class="src-id">array</span>(</span><span class="src-str">&quot;</span>.<a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">','</span><span class="src-sym">, </span><span class="src-var">$arg_list</span><span class="src-sym">)</span>.<span class="src-str">&quot;))&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1036"></a>&nbsp;</li>
<li><a name="a1037"></a>        <span class="src-key">return </span><span class="src-str">&quot;</span><span class="src-str">&lt;?<span class="src-id">php</span> <span class="src-id">require_once</span>(<span class="src-id">SMARTY_CORE_DIR</span> . '<span class="src-id">core</span>.<span class="src-id">smarty_include_php</span>.<span class="src-id">php</span>');\n<span class="src-id">smarty_core_smarty_include_php</span>(<span class="src-var">$_params</span>, \$<span class="src-id">this</span>); ?&gt;</span><span class="src-str">&quot; </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_additional_newline</span><span class="src-sym">;</span></li>
<li><a name="a1038"></a>    <span class="src-sym">}</span></li>
<li><a name="a1039"></a>&nbsp;</li>
<li><a name="a1040"></a>&nbsp;</li>
<li><a name="a1041"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1042"></a><span class="src-doc">     * Compile {section ...} tag</span></li>
<li><a name="a1043"></a><span class="src-doc">     *</span></li>
<li><a name="a1044"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_args </span></li>
<li><a name="a1045"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a1046"></a><span class="src-doc">     */</span></li>
<li><a name="a1047"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_section_start">_compile_section_start</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span></li>
<li><a name="a1048"></a>    <span class="src-sym">{</span></li>
<li><a name="a1049"></a>        <span class="src-var">$attrs </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_attrs">_parse_attrs</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1050"></a>        <span class="src-var">$arg_list </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1051"></a>&nbsp;</li>
<li><a name="a1052"></a>        <span class="src-var">$output </span>= <span class="src-str">'&lt;?php '</span><span class="src-sym">;</span></li>
<li><a name="a1053"></a>        <span class="src-var">$section_name </span>= <span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'name'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1054"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$section_name</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1055"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;missing section name&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1056"></a>        <span class="src-sym">}</span></li>
<li><a name="a1057"></a>&nbsp;</li>
<li><a name="a1058"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">unset</span>(\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_sections</span><span class="src-sym">[</span><span class="src-var">$section_name</span><span class="src-sym">]</span>);\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1059"></a>        <span class="src-var">$section_props </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_sections</span><span class="src-sym">[</span><span class="src-var">$section_name</span><span class="src-sym">]</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1060"></a>&nbsp;</li>
<li><a name="a1061"></a>        <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$attrs </span><span class="src-key">as </span><span class="src-var">$attr_name </span>=&gt; <span class="src-var">$attr_value</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1062"></a>            <span class="src-key">switch </span><span class="src-sym">(</span><span class="src-var">$attr_name</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1063"></a>                <span class="src-key">case </span><span class="src-str">'loop'</span>:</li>
<li><a name="a1064"></a>                    <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props</span><span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">loop</span>'<span class="src-sym">]</span> = <span class="src-id">is_array</span>(\$<span class="src-id">_loop</span>=<span class="src-var">$attr_value</span>) ? <span class="src-id">count</span>(\$<span class="src-id">_loop</span>) : <span class="src-id">max</span>(0, (<span class="src-id">int</span>)\$<span class="src-id">_loop</span>); <span class="src-id">unset</span>(\$<span class="src-id">_loop</span>);\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1065"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1066"></a>&nbsp;</li>
<li><a name="a1067"></a>                <span class="src-key">case </span><span class="src-str">'show'</span>:</li>
<li><a name="a1068"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/is_bool">is_bool</a><span class="src-sym">(</span><span class="src-var">$attr_value</span><span class="src-sym">))</span></li>
<li><a name="a1069"></a>                        <span class="src-var">$show_attr_value </span>= <span class="src-var">$attr_value </span>? <span class="src-str">'true' </span>: <span class="src-str">'false'</span><span class="src-sym">;</span></li>
<li><a name="a1070"></a>                    <span class="src-key">else</span></li>
<li><a name="a1071"></a>                        <span class="src-var">$show_attr_value </span>= <span class="src-str">&quot;</span><span class="src-str">(<span class="src-id">bool</span>)<span class="src-var">$attr_value</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1072"></a>                    <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props</span><span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">show</span>'<span class="src-sym">]</span> = <span class="src-var">$show_attr_value</span>;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1073"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1074"></a>&nbsp;</li>
<li><a name="a1075"></a>                <span class="src-key">case </span><span class="src-str">'name'</span>:</li>
<li><a name="a1076"></a>                    <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props</span><span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-var">$attr_name</span>'<span class="src-sym">]</span> = <span class="src-var">$attr_value</span>;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1077"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1078"></a>&nbsp;</li>
<li><a name="a1079"></a>                <span class="src-key">case </span><span class="src-str">'max'</span>:</li>
<li><a name="a1080"></a>                <span class="src-key">case </span><span class="src-str">'start'</span>:</li>
<li><a name="a1081"></a>                    <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props</span><span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-var">$attr_name</span>'<span class="src-sym">]</span> = (<span class="src-id">int</span>)<span class="src-var">$attr_value</span>;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1082"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1083"></a>&nbsp;</li>
<li><a name="a1084"></a>                <span class="src-key">case </span><span class="src-str">'step'</span>:</li>
<li><a name="a1085"></a>                    <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props</span><span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-var">$attr_name</span>'<span class="src-sym">]</span> = ((<span class="src-id">int</span>)<span class="src-var">$attr_value</span>) == 0 ? 1 : (<span class="src-id">int</span>)<span class="src-var">$attr_value</span>;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1086"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1087"></a>&nbsp;</li>
<li><a name="a1088"></a>                <span class="src-key">default</span>:</li>
<li><a name="a1089"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">unknown</span> <span class="src-id">section</span> <span class="src-id">attribute</span> - '<span class="src-var">$attr_name</span>'</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1090"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1091"></a>            <span class="src-sym">}</span></li>
<li><a name="a1092"></a>        <span class="src-sym">}</span></li>
<li><a name="a1093"></a>&nbsp;</li>
<li><a name="a1094"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'show'</span><span class="src-sym">]</span><span class="src-sym">))</span></li>
<li><a name="a1095"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props</span><span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">show</span>'<span class="src-sym">]</span> = <span class="src-id">true</span>;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1096"></a>&nbsp;</li>
<li><a name="a1097"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'loop'</span><span class="src-sym">]</span><span class="src-sym">))</span></li>
<li><a name="a1098"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props</span><span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">loop</span>'<span class="src-sym">]</span> = 1;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1099"></a>&nbsp;</li>
<li><a name="a1100"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'max'</span><span class="src-sym">]</span><span class="src-sym">))</span></li>
<li><a name="a1101"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props</span><span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">max</span>'<span class="src-sym">]</span> = {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">loop</span>'<span class="src-sym">]</span>;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1102"></a>        <span class="src-key">else</span></li>
<li><a name="a1103"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">if</span> ({<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">max</span>'<span class="src-sym">]</span> &lt; 0)\n</span><span class="src-str">&quot; </span>.</li>
<li><a name="a1104"></a>                       <span class="src-str">&quot;</span><span class="src-str">    {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">max</span>'<span class="src-sym">]</span> = {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">loop</span>'<span class="src-sym">]</span>;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1105"></a>&nbsp;</li>
<li><a name="a1106"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'step'</span><span class="src-sym">]</span><span class="src-sym">))</span></li>
<li><a name="a1107"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props</span><span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">step</span>'<span class="src-sym">]</span> = 1;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1108"></a>&nbsp;</li>
<li><a name="a1109"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'start'</span><span class="src-sym">]</span><span class="src-sym">))</span></li>
<li><a name="a1110"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props</span><span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">start</span>'<span class="src-sym">]</span> = {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">step</span>'<span class="src-sym">]</span> &gt; 0 ? 0 : {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">loop</span>'<span class="src-sym">]</span>-1;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1111"></a>        <span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1112"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">if</span> ({<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">start</span>'<span class="src-sym">]</span> &lt; 0)\n</span><span class="src-str">&quot; </span>.</li>
<li><a name="a1113"></a>                       <span class="src-str">&quot;</span><span class="src-str">    {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">start</span>'<span class="src-sym">]</span> = <span class="src-id">max</span>({<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">step</span>'<span class="src-sym">]</span> &gt; 0 ? 0 : -1, {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">loop</span>'<span class="src-sym">]</span> + {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">start</span>'<span class="src-sym">]</span>);\n</span><span class="src-str">&quot; </span>.</li>
<li><a name="a1114"></a>                       <span class="src-str">&quot;else\n&quot; </span>.</li>
<li><a name="a1115"></a>                       <span class="src-str">&quot;</span><span class="src-str">    {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">start</span>'<span class="src-sym">]</span> = <span class="src-id">min</span>({<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">start</span>'<span class="src-sym">]</span>, {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">step</span>'<span class="src-sym">]</span> &gt; 0 ? {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">loop</span>'<span class="src-sym">]</span> : {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">loop</span>'<span class="src-sym">]</span>-1);\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1116"></a>        <span class="src-sym">}</span></li>
<li><a name="a1117"></a>&nbsp;</li>
<li><a name="a1118"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">if</span> ({<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">show</span>'<span class="src-sym">]</span>) <span class="src-sym">{</span>\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1119"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'start'</span><span class="src-sym">]</span><span class="src-sym">) </span>&amp;&amp; <span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'step'</span><span class="src-sym">]</span><span class="src-sym">) </span>&amp;&amp; <span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'max'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1120"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str">    {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">total</span>'<span class="src-sym">]</span> = {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">loop</span>'<span class="src-sym">]</span>;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1121"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1122"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str">    {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">total</span>'<span class="src-sym">]</span> = <span class="src-id">min</span>(<span class="src-id">ceil</span>(({<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">step</span>'<span class="src-sym">]</span> &gt; 0 ? {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">loop</span>'<span class="src-sym">]</span> - {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">start</span>'<span class="src-sym">]</span> : {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">start</span>'<span class="src-sym">]</span>+1)/<span class="src-id">abs</span>({<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">step</span>'<span class="src-sym">]</span>)), {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">max</span>'<span class="src-sym">]</span>);\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1123"></a>        <span class="src-sym">}</span></li>
<li><a name="a1124"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str">    <span class="src-id">if</span> ({<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">total</span>'<span class="src-sym">]</span> == 0)\n</span><span class="src-str">&quot; </span>.</li>
<li><a name="a1125"></a>                   <span class="src-str">&quot;</span><span class="src-str">        {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">show</span>'<span class="src-sym">]</span> = <span class="src-id">false</span>;\n</span><span class="src-str">&quot; </span>.</li>
<li><a name="a1126"></a>                   <span class="src-str">&quot;} else\n&quot; </span>.</li>
<li><a name="a1127"></a>                   <span class="src-str">&quot;</span><span class="src-str">    {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">total</span>'<span class="src-sym">]</span> = 0;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1128"></a>&nbsp;</li>
<li><a name="a1129"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">if</span> ({<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">show</span>'<span class="src-sym">]</span>):\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1130"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;</span></li>
<li><a name="a1131"></a><span class="src-str">            <span class="src-id">for</span> ({<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">index</span>'<span class="src-sym">]</span> = {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">start</span>'<span class="src-sym">]</span>, {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">iteration</span>'<span class="src-sym">]</span> = 1;</span></li>
<li><a name="a1132"></a><span class="src-str">                 {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">iteration</span>'<span class="src-sym">]</span> &lt;= {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">total</span>'<span class="src-sym">]</span>;</span></li>
<li><a name="a1133"></a><span class="src-str">                 {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">index</span>'<span class="src-sym">]</span> += {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">step</span>'<span class="src-sym">]</span>, {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">iteration</span>'<span class="src-sym">]</span>++):\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1134"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props<span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">rownum</span>'<span class="src-sym">]</span> = {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">iteration</span>'<span class="src-sym">]</span>;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1135"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props<span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">index_prev</span>'<span class="src-sym">]</span> = {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">index</span>'<span class="src-sym">]</span> - {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">step</span>'<span class="src-sym">]</span>;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1136"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props<span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">index_next</span>'<span class="src-sym">]</span> = {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">index</span>'<span class="src-sym">]</span> + {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">step</span>'<span class="src-sym">]</span>;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1137"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props<span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">first</span>'<span class="src-sym">]</span>      = ({<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">iteration</span>'<span class="src-sym">]</span> == 1);\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1138"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$section_props<span class="src-str"></span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">last</span>'<span class="src-sym">]</span>       = ({<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">iteration</span>'<span class="src-sym">]</span> == {<span class="src-var">$section_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">total</span>'<span class="src-sym">]</span>);\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1139"></a>&nbsp;</li>
<li><a name="a1140"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;?&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1141"></a>&nbsp;</li>
<li><a name="a1142"></a>        <span class="src-key">return </span><span class="src-var">$output</span><span class="src-sym">;</span></li>
<li><a name="a1143"></a>    <span class="src-sym">}</span></li>
<li><a name="a1144"></a>&nbsp;</li>
<li><a name="a1145"></a>&nbsp;</li>
<li><a name="a1146"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1147"></a><span class="src-doc">     * Compile {foreach ...} tag.</span></li>
<li><a name="a1148"></a><span class="src-doc">     *</span></li>
<li><a name="a1149"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_args </span></li>
<li><a name="a1150"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a1151"></a><span class="src-doc">     */</span></li>
<li><a name="a1152"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_foreach_start">_compile_foreach_start</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span></li>
<li><a name="a1153"></a>    <span class="src-sym">{</span></li>
<li><a name="a1154"></a>        <span class="src-var">$attrs </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_attrs">_parse_attrs</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1155"></a>        <span class="src-var">$arg_list </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1156"></a>&nbsp;</li>
<li><a name="a1157"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'from'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1158"></a>            <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;foreach: missing 'from' attribute&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1159"></a>        <span class="src-sym">}</span></li>
<li><a name="a1160"></a>        <span class="src-var">$from </span>= <span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'from'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1161"></a>&nbsp;</li>
<li><a name="a1162"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'item'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1163"></a>            <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;foreach: missing 'item' attribute&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1164"></a>        <span class="src-sym">}</span></li>
<li><a name="a1165"></a>        <span class="src-var">$item </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_dequote</span><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'item'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1166"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^\w+$~'</span><span class="src-sym">, </span><span class="src-var">$item</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1167"></a>            <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;'foreach: item' must be a variable name (literal string)&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1168"></a>        <span class="src-sym">}</span></li>
<li><a name="a1169"></a>&nbsp;</li>
<li><a name="a1170"></a>        <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'key'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1171"></a>            <span class="src-var">$key  </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_dequote</span><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'key'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1172"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^\w+$~'</span><span class="src-sym">, </span><span class="src-var">$key</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1173"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;foreach: 'key' must to be a variable name (literal string)&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1174"></a>            <span class="src-sym">}</span></li>
<li><a name="a1175"></a>            <span class="src-var">$key_part </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_tpl_vars</span><span class="src-sym">[</span>'<span class="src-var">$key</span>'<span class="src-sym">]</span> =&gt; </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1176"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1177"></a>            <span class="src-var">$key </span>= <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a1178"></a>            <span class="src-var">$key_part </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a1179"></a>        <span class="src-sym">}</span></li>
<li><a name="a1180"></a>&nbsp;</li>
<li><a name="a1181"></a>        <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'name'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1182"></a>            <span class="src-var">$name </span>= <span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'name'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1183"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1184"></a>            <span class="src-var">$name </span>= <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a1185"></a>        <span class="src-sym">}</span></li>
<li><a name="a1186"></a>&nbsp;</li>
<li><a name="a1187"></a>        <span class="src-var">$output </span>= <span class="src-str">'&lt;?php '</span><span class="src-sym">;</span></li>
<li><a name="a1188"></a>        <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">_from</span> = <span class="src-var">$from</span>; <span class="src-id">if</span> (!<span class="src-id">is_array</span>(\$<span class="src-id">_from</span>) &amp;&amp; !<span class="src-id">is_object</span>(\$<span class="src-id">_from</span>)) <span class="src-sym">{</span> <span class="src-id">settype</span>(\$<span class="src-id">_from</span>, '<span class="src-id">array</span>'); <span class="src-sym">}</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1189"></a>        <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1190"></a>            <span class="src-var">$foreach_props </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_foreach</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1191"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span>{<span class="src-var">$foreach_props</span><span class="src-str"></span><span class="src-sym">}</span> = <span class="src-id">array</span>('<span class="src-id">total</span>' =&gt; <span class="src-id">count</span>(\$<span class="src-id">_from</span>), '<span class="src-id">iteration</span>' =&gt; 0);\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1192"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">if</span> ({<span class="src-var">$foreach_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">total</span>'<span class="src-sym">]</span> &gt; 0):\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1193"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str">    <span class="src-id">foreach</span> (\$<span class="src-id">_from</span> <span class="src-id">as</span> <span class="src-var">$key_part</span>\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_tpl_vars</span><span class="src-sym">[</span>'<span class="src-var">$item</span>'<span class="src-sym">]</span>):\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1194"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str">        {<span class="src-var">$foreach_props</span><span class="src-sym">}</span><span class="src-sym">[</span>'<span class="src-id">iteration</span>'<span class="src-sym">]</span>++;\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1195"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1196"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;if (count(\$_from)):\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1197"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str">    <span class="src-id">foreach</span> (\$<span class="src-id">_from</span> <span class="src-id">as</span> <span class="src-var">$key_part</span>\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_tpl_vars</span><span class="src-sym">[</span>'<span class="src-var">$item</span>'<span class="src-sym">]</span>):\n</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1198"></a>        <span class="src-sym">}</span></li>
<li><a name="a1199"></a>        <span class="src-var">$output </span>.= <span class="src-str">'?&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a1200"></a>&nbsp;</li>
<li><a name="a1201"></a>        <span class="src-key">return </span><span class="src-var">$output</span><span class="src-sym">;</span></li>
<li><a name="a1202"></a>    <span class="src-sym">}</span></li>
<li><a name="a1203"></a>&nbsp;</li>
<li><a name="a1204"></a>&nbsp;</li>
<li><a name="a1205"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1206"></a><span class="src-doc">     * Compile {capture} .. {/capture} tags</span></li>
<li><a name="a1207"></a><span class="src-doc">     *</span></li>
<li><a name="a1208"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">boolean </span><span class="src-doc-var">$start </span><span class="src-doc">true if this is the {capture} tag</span></li>
<li><a name="a1209"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_args </span></li>
<li><a name="a1210"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a1211"></a><span class="src-doc">     */</span></li>
<li><a name="a1212"></a>&nbsp;</li>
<li><a name="a1213"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_capture_tag">_compile_capture_tag</a><span class="src-sym">(</span><span class="src-var">$start</span><span class="src-sym">, </span><span class="src-var">$tag_args </span>= <span class="src-str">''</span><span class="src-sym">)</span></li>
<li><a name="a1214"></a>    <span class="src-sym">{</span></li>
<li><a name="a1215"></a>        <span class="src-var">$attrs </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_attrs">_parse_attrs</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1216"></a>&nbsp;</li>
<li><a name="a1217"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$start</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1218"></a>            <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'name'</span><span class="src-sym">]</span><span class="src-sym">))</span></li>
<li><a name="a1219"></a>                <span class="src-var">$buffer </span>= <span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'name'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1220"></a>            <span class="src-key">else</span></li>
<li><a name="a1221"></a>                <span class="src-var">$buffer </span>= <span class="src-str">&quot;'default'&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1222"></a>&nbsp;</li>
<li><a name="a1223"></a>            <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'assign'</span><span class="src-sym">]</span><span class="src-sym">))</span></li>
<li><a name="a1224"></a>                <span class="src-var">$assign </span>= <span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-str">'assign'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1225"></a>            <span class="src-key">else</span></li>
<li><a name="a1226"></a>                <span class="src-var">$assign </span>= <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a1227"></a>            <span class="src-var">$output </span>= <span class="src-str">&quot;&lt;?php ob_start(); ?&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1228"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_capture_stack</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-var">$buffer</span><span class="src-sym">, </span><span class="src-var">$assign</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1229"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1230"></a>            list<span class="src-sym">(</span><span class="src-var">$buffer</span><span class="src-sym">, </span><span class="src-var">$assign</span><span class="src-sym">) </span>= <a href="http://www.php.net/array_pop">array_pop</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_capture_stack</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1231"></a>            <span class="src-var">$output </span>= <span class="src-str">&quot;</span><span class="src-str">&lt;?<span class="src-id">php</span> \$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_smarty_vars</span><span class="src-sym">[</span>'<span class="src-id">capture</span>'<span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$buffer</span><span class="src-sym">]</span> = <span class="src-id">ob_get_contents</span>(); </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1232"></a>            <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$assign</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1233"></a>                <span class="src-var">$output </span>.= <span class="src-str">&quot;</span><span class="src-str"> \$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">assign</span>(<span class="src-var">$assign</span>, <span class="src-id">ob_get_contents</span>());</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1234"></a>            <span class="src-sym">}</span></li>
<li><a name="a1235"></a>            <span class="src-var">$output </span>.= <span class="src-str">&quot;ob_end_clean(); ?&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1236"></a>        <span class="src-sym">}</span></li>
<li><a name="a1237"></a>&nbsp;</li>
<li><a name="a1238"></a>        <span class="src-key">return </span><span class="src-var">$output</span><span class="src-sym">;</span></li>
<li><a name="a1239"></a>    <span class="src-sym">}</span></li>
<li><a name="a1240"></a>&nbsp;</li>
<li><a name="a1241"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1242"></a><span class="src-doc">     * Compile {if ...} tag</span></li>
<li><a name="a1243"></a><span class="src-doc">     *</span></li>
<li><a name="a1244"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_args </span></li>
<li><a name="a1245"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">boolean </span><span class="src-doc-var">$elseif </span><span class="src-doc">if true, uses elseif instead of if</span></li>
<li><a name="a1246"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a1247"></a><span class="src-doc">     */</span></li>
<li><a name="a1248"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_if_tag">_compile_if_tag</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">, </span><span class="src-var">$elseif </span>= <span class="src-id">false</span><span class="src-sym">)</span></li>
<li><a name="a1249"></a>    <span class="src-sym">{</span></li>
<li><a name="a1250"></a>&nbsp;</li>
<li><a name="a1251"></a>        <span class="src-comm">/* Tokenize args for 'if' tag. */</span></li>
<li><a name="a1252"></a>        <a href="http://www.php.net/preg_match_all">preg_match_all</a><span class="src-sym">(</span><span class="src-str">'~(?&gt;</span></li>
<li><a name="a1253"></a><span class="src-str">                ' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_call_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)? | # valid object call</span></li>
<li><a name="a1254"></a><span class="src-str">                ' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)?    | # var or quoted string</span></li>
<li><a name="a1255"></a><span class="src-str">                \-?0[xX][0-9a-fA-F]+|\-?\d+(?:\.\d+)?|\.\d+|!==|===|==|!=|&lt;&gt;|&lt;&lt;|&gt;&gt;|&lt;=|&gt;=|\&amp;\&amp;|\|\||\(|\)|,|\!|\^|=|\&amp;|\~|&lt;|&gt;|\||\%|\+|\-|\/|\*|\@    | # valid non-word token</span></li>
<li><a name="a1256"></a><span class="src-str">                \b\w+\b                                                        | # valid word token</span></li>
<li><a name="a1257"></a><span class="src-str">                \S+                                                           # anything else</span></li>
<li><a name="a1258"></a><span class="src-str">                )~x'</span><span class="src-sym">, </span><span class="src-var">$tag_args</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1259"></a>&nbsp;</li>
<li><a name="a1260"></a>        <span class="src-var">$tokens </span>= <span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1261"></a>&nbsp;</li>
<li><a name="a1262"></a>        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1263"></a>            <span class="src-var">$_error_msg </span>.= <span class="src-var">$elseif </span>? <span class="src-str">&quot;'elseif'&quot; </span>: <span class="src-str">&quot;'if'&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1264"></a>            <span class="src-var">$_error_msg </span>.= <span class="src-str">' statement requires arguments'</span><span class="src-sym">; </span></li>
<li><a name="a1265"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-var">$_error_msg</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1266"></a>        <span class="src-sym">}</span></li>
<li><a name="a1267"></a>            </li>
<li><a name="a1268"></a>                </li>
<li><a name="a1269"></a>        <span class="src-comm">// make sure we have balanced parenthesis</span></li>
<li><a name="a1270"></a>        <span class="src-var">$token_count </span>= <a href="http://www.php.net/array_count_values">array_count_values</a><span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1271"></a>        <span class="src-key">if</span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$token_count</span><span class="src-sym">[</span><span class="src-str">'('</span><span class="src-sym">]</span><span class="src-sym">) </span>&amp;&amp; <span class="src-var">$token_count</span><span class="src-sym">[</span><span class="src-str">'('</span><span class="src-sym">] </span>!= <span class="src-var">$token_count</span><span class="src-sym">[</span><span class="src-str">')'</span><span class="src-sym">]</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1272"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;unbalanced parenthesis in if statement&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1273"></a>        <span class="src-sym">}</span></li>
<li><a name="a1274"></a>&nbsp;</li>
<li><a name="a1275"></a>        <span class="src-var">$is_arg_stack </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1276"></a>&nbsp;</li>
<li><a name="a1277"></a>        <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$i </span>= <span class="src-num">0</span><span class="src-sym">; </span><span class="src-var">$i </span>&lt; <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-var">$i</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1278"></a>&nbsp;</li>
<li><a name="a1279"></a>            <span class="src-var">$token </span>= <span class="src-sym">&amp;</span><span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1280"></a>&nbsp;</li>
<li><a name="a1281"></a>            <span class="src-key">switch </span><span class="src-sym">(</span><a href="http://www.php.net/strtolower">strtolower</a><span class="src-sym">(</span><span class="src-var">$token</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1282"></a>                <span class="src-key">case </span><span class="src-str">'!'</span>:</li>
<li><a name="a1283"></a>                <span class="src-key">case </span><span class="src-str">'%'</span>:</li>
<li><a name="a1284"></a>                <span class="src-key">case </span><span class="src-str">'!=='</span>:</li>
<li><a name="a1285"></a>                <span class="src-key">case </span><span class="src-str">'=='</span>:</li>
<li><a name="a1286"></a>                <span class="src-key">case </span><span class="src-str">'==='</span>:</li>
<li><a name="a1287"></a>                <span class="src-key">case </span><span class="src-str">'&gt;'</span>:</li>
<li><a name="a1288"></a>                <span class="src-key">case </span><span class="src-str">'&lt;'</span>:</li>
<li><a name="a1289"></a>                <span class="src-key">case </span><span class="src-str">'!='</span>:</li>
<li><a name="a1290"></a>                <span class="src-key">case </span><span class="src-str">'&lt;&gt;'</span>:</li>
<li><a name="a1291"></a>                <span class="src-key">case </span><span class="src-str">'&lt;&lt;'</span>:</li>
<li><a name="a1292"></a>                <span class="src-key">case </span><span class="src-str">'&gt;&gt;'</span>:</li>
<li><a name="a1293"></a>                <span class="src-key">case </span><span class="src-str">'&lt;='</span>:</li>
<li><a name="a1294"></a>                <span class="src-key">case </span><span class="src-str">'&gt;='</span>:</li>
<li><a name="a1295"></a>                <span class="src-key">case </span><span class="src-str">'&amp;&amp;'</span>:</li>
<li><a name="a1296"></a>                <span class="src-key">case </span><span class="src-str">'||'</span>:</li>
<li><a name="a1297"></a>                <span class="src-key">case </span><span class="src-str">'|'</span>:</li>
<li><a name="a1298"></a>                <span class="src-key">case </span><span class="src-str">'^'</span>:</li>
<li><a name="a1299"></a>                <span class="src-key">case </span><span class="src-str">'&amp;'</span>:</li>
<li><a name="a1300"></a>                <span class="src-key">case </span><span class="src-str">'~'</span>:</li>
<li><a name="a1301"></a>                <span class="src-key">case </span><span class="src-str">')'</span>:</li>
<li><a name="a1302"></a>                <span class="src-key">case </span><span class="src-str">','</span>:</li>
<li><a name="a1303"></a>                <span class="src-key">case </span><span class="src-str">'+'</span>:</li>
<li><a name="a1304"></a>                <span class="src-key">case </span><span class="src-str">'-'</span>:</li>
<li><a name="a1305"></a>                <span class="src-key">case </span><span class="src-str">'*'</span>:</li>
<li><a name="a1306"></a>                <span class="src-key">case </span><span class="src-str">'/'</span>:</li>
<li><a name="a1307"></a>                <span class="src-key">case </span><span class="src-str">'@'</span>:</li>
<li><a name="a1308"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1309"></a>&nbsp;</li>
<li><a name="a1310"></a>                <span class="src-key">case </span><span class="src-str">'eq'</span>:</li>
<li><a name="a1311"></a>                    <span class="src-var">$token </span>= <span class="src-str">'=='</span><span class="src-sym">;</span></li>
<li><a name="a1312"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1313"></a>&nbsp;</li>
<li><a name="a1314"></a>                <span class="src-key">case </span><span class="src-str">'ne'</span>:</li>
<li><a name="a1315"></a>                <span class="src-key">case </span><span class="src-str">'neq'</span>:</li>
<li><a name="a1316"></a>                    <span class="src-var">$token </span>= <span class="src-str">'!='</span><span class="src-sym">;</span></li>
<li><a name="a1317"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1318"></a>&nbsp;</li>
<li><a name="a1319"></a>                <span class="src-key">case </span><span class="src-str">'lt'</span>:</li>
<li><a name="a1320"></a>                    <span class="src-var">$token </span>= <span class="src-str">'&lt;'</span><span class="src-sym">;</span></li>
<li><a name="a1321"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1322"></a>&nbsp;</li>
<li><a name="a1323"></a>                <span class="src-key">case </span><span class="src-str">'le'</span>:</li>
<li><a name="a1324"></a>                <span class="src-key">case </span><span class="src-str">'lte'</span>:</li>
<li><a name="a1325"></a>                    <span class="src-var">$token </span>= <span class="src-str">'&lt;='</span><span class="src-sym">;</span></li>
<li><a name="a1326"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1327"></a>&nbsp;</li>
<li><a name="a1328"></a>                <span class="src-key">case </span><span class="src-str">'gt'</span>:</li>
<li><a name="a1329"></a>                    <span class="src-var">$token </span>= <span class="src-str">'&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a1330"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1331"></a>&nbsp;</li>
<li><a name="a1332"></a>                <span class="src-key">case </span><span class="src-str">'ge'</span>:</li>
<li><a name="a1333"></a>                <span class="src-key">case </span><span class="src-str">'gte'</span>:</li>
<li><a name="a1334"></a>                    <span class="src-var">$token </span>= <span class="src-str">'&gt;='</span><span class="src-sym">;</span></li>
<li><a name="a1335"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1336"></a>&nbsp;</li>
<li><a name="a1337"></a>                <span class="src-key">case </span><span class="src-str">'and'</span>:</li>
<li><a name="a1338"></a>                    <span class="src-var">$token </span>= <span class="src-str">'&amp;&amp;'</span><span class="src-sym">;</span></li>
<li><a name="a1339"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1340"></a>&nbsp;</li>
<li><a name="a1341"></a>                <span class="src-key">case </span><span class="src-str">'or'</span>:</li>
<li><a name="a1342"></a>                    <span class="src-var">$token </span>= <span class="src-str">'||'</span><span class="src-sym">;</span></li>
<li><a name="a1343"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1344"></a>&nbsp;</li>
<li><a name="a1345"></a>                <span class="src-key">case </span><span class="src-str">'not'</span>:</li>
<li><a name="a1346"></a>                    <span class="src-var">$token </span>= <span class="src-str">'!'</span><span class="src-sym">;</span></li>
<li><a name="a1347"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1348"></a>&nbsp;</li>
<li><a name="a1349"></a>                <span class="src-key">case </span><span class="src-str">'mod'</span>:</li>
<li><a name="a1350"></a>                    <span class="src-var">$token </span>= <span class="src-str">'%'</span><span class="src-sym">;</span></li>
<li><a name="a1351"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1352"></a>&nbsp;</li>
<li><a name="a1353"></a>                <span class="src-key">case </span><span class="src-str">'('</span>:</li>
<li><a name="a1354"></a>                    <a href="http://www.php.net/array_push">array_push</a><span class="src-sym">(</span><span class="src-var">$is_arg_stack</span><span class="src-sym">, </span><span class="src-var">$i</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1355"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1356"></a>&nbsp;</li>
<li><a name="a1357"></a>                <span class="src-key">case </span><span class="src-str">'is'</span>:</li>
<li><a name="a1358"></a>                    <span class="src-comm">/* If last token was a ')', we operate on the parenthesized</span></li>
<li><a name="a1359"></a><span class="src-comm">                       expression. The start of the expression is on the stack.</span></li>
<li><a name="a1360"></a><span class="src-comm">                       Otherwise, we operate on the last encountered token. */</span></li>
<li><a name="a1361"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$i</span>-<span class="src-num">1</span><span class="src-sym">] </span>== <span class="src-str">')'</span><span class="src-sym">)</span></li>
<li><a name="a1362"></a>                        <span class="src-var">$is_arg_start </span>= <a href="http://www.php.net/array_pop">array_pop</a><span class="src-sym">(</span><span class="src-var">$is_arg_stack</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1363"></a>                    <span class="src-key">else</span></li>
<li><a name="a1364"></a>                        <span class="src-var">$is_arg_start </span>= <span class="src-var">$i</span>-<span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a1365"></a>                    <span class="src-comm">/* Construct the argument for 'is' expression, so it knows</span></li>
<li><a name="a1366"></a><span class="src-comm">                       what to operate on. */</span></li>
<li><a name="a1367"></a>                    <span class="src-var">$is_arg </span>= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">' '</span><span class="src-sym">, </span><a href="http://www.php.net/array_slice">array_slice</a><span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">, </span><span class="src-var">$is_arg_start</span><span class="src-sym">, </span><span class="src-var">$i </span>- <span class="src-var">$is_arg_start</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a1368"></a>&nbsp;</li>
<li><a name="a1369"></a>                    <span class="src-comm">/* Pass all tokens from next one until the end to the</span></li>
<li><a name="a1370"></a><span class="src-comm">                       'is' expression parsing function. The function will</span></li>
<li><a name="a1371"></a><span class="src-comm">                       return modified tokens, where the first one is the result</span></li>
<li><a name="a1372"></a><span class="src-comm">                       of the 'is' expression and the rest are the tokens it</span></li>
<li><a name="a1373"></a><span class="src-comm">                       didn't touch. */</span></li>
<li><a name="a1374"></a>                    <span class="src-var">$new_tokens </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_is_expr">_parse_is_expr</a><span class="src-sym">(</span><span class="src-var">$is_arg</span><span class="src-sym">, </span><a href="http://www.php.net/array_slice">array_slice</a><span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">, </span><span class="src-var">$i</span>+<span class="src-num">1</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a1375"></a>&nbsp;</li>
<li><a name="a1376"></a>                    <span class="src-comm">/* Replace the old tokens with the new ones. */</span></li>
<li><a name="a1377"></a>                    <a href="http://www.php.net/array_splice">array_splice</a><span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">, </span><span class="src-var">$is_arg_start</span><span class="src-sym">, </span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-var">$new_tokens</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1378"></a>&nbsp;</li>
<li><a name="a1379"></a>                    <span class="src-comm">/* Adjust argument start so that it won't change from the</span></li>
<li><a name="a1380"></a><span class="src-comm">                       current position for the next iteration. */</span></li>
<li><a name="a1381"></a>                    <span class="src-var">$i </span>= <span class="src-var">$is_arg_start</span><span class="src-sym">;</span></li>
<li><a name="a1382"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1383"></a>&nbsp;</li>
<li><a name="a1384"></a>                <span class="src-key">default</span>:</li>
<li><a name="a1385"></a>                    <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_func_regexp </span>. <span class="src-str">'$~'</span><span class="src-sym">, </span><span class="src-var">$token</span><span class="src-sym">) ) </span><span class="src-sym">{</span></li>
<li><a name="a1386"></a>                            <span class="src-comm">// function call</span></li>
<li><a name="a1387"></a>                            <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">security </span>&amp;&amp;</li>
<li><a name="a1388"></a>                               <span class="src-sym">!</span><a href="http://www.php.net/in_array">in_array</a><span class="src-sym">(</span><span class="src-var">$token</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">security_settings</span><span class="src-sym">[</span><span class="src-str">'IF_FUNCS'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1389"></a>                                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str">(<span class="src-id">secure</span> <span class="src-id">mode</span>) '<span class="src-var">$token</span>' <span class="src-id">not</span> <span class="src-id">allowed</span> <span class="src-id">in</span> <span class="src-id">if</span> <span class="src-id">statement</span></span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1390"></a>                            <span class="src-sym">}</span></li>
<li><a name="a1391"></a>                    <span class="src-sym">} </span><span class="src-key">elseif</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_regexp </span>. <span class="src-str">'$~'</span><span class="src-sym">, </span><span class="src-var">$token</span><span class="src-sym">) </span>&amp;&amp; isset<span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$i</span>+<span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">) </span>&amp;&amp; <span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$i</span>+<span class="src-num">1</span><span class="src-sym">] </span>== <span class="src-str">'('</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1392"></a>                        <span class="src-comm">// variable function call</span></li>
<li><a name="a1393"></a>                        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">variable</span> <span class="src-id">function</span> <span class="src-id">call</span> '<span class="src-var">$token</span>' <span class="src-id">not</span> <span class="src-id">allowed</span> <span class="src-id">in</span> <span class="src-id">if</span> <span class="src-id">statement</span></span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;                      </span></li>
<li><a name="a1394"></a>                    <span class="src-sym">} </span><span class="src-key">elseif</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_call_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)$~'</span><span class="src-sym">, </span><span class="src-var">$token</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1395"></a>                        <span class="src-comm">// object or variable</span></li>
<li><a name="a1396"></a>                        <span class="src-var">$token </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var_props">_parse_var_props</a><span class="src-sym">(</span><span class="src-var">$token</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1397"></a>                    <span class="src-sym">} </span><span class="src-key">elseif</span><span class="src-sym">(</span><a href="http://www.php.net/is_numeric">is_numeric</a><span class="src-sym">(</span><span class="src-var">$token</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1398"></a>                        <span class="src-comm">// number, skip it</span></li>
<li><a name="a1399"></a>                    <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1400"></a>                        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">unidentified</span> <span class="src-id">token</span> '<span class="src-var">$token</span>'</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1401"></a>                    <span class="src-sym">}</span></li>
<li><a name="a1402"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1403"></a>            <span class="src-sym">}</span></li>
<li><a name="a1404"></a>        <span class="src-sym">}</span></li>
<li><a name="a1405"></a>&nbsp;</li>
<li><a name="a1406"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$elseif</span><span class="src-sym">)</span></li>
<li><a name="a1407"></a>            <span class="src-key">return </span><span class="src-str">'&lt;?php elseif ('</span>.<a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">' '</span><span class="src-sym">, </span><span class="src-var">$tokens</span><span class="src-sym">)</span>.<span class="src-str">'): ?&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a1408"></a>        <span class="src-key">else</span></li>
<li><a name="a1409"></a>            <span class="src-key">return </span><span class="src-str">'&lt;?php if ('</span>.<a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">' '</span><span class="src-sym">, </span><span class="src-var">$tokens</span><span class="src-sym">)</span>.<span class="src-str">'): ?&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a1410"></a>    <span class="src-sym">}</span></li>
<li><a name="a1411"></a>&nbsp;</li>
<li><a name="a1412"></a>&nbsp;</li>
<li><a name="a1413"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_arg_list">_compile_arg_list</a><span class="src-sym">(</span><span class="src-var">$type</span><span class="src-sym">, </span><span class="src-var">$name</span><span class="src-sym">, </span><span class="src-var">$attrs</span><span class="src-sym">, </span><span class="src-sym">&amp;</span><span class="src-var">$cache_code</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1414"></a>        <span class="src-var">$arg_list </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1415"></a>&nbsp;</li>
<li><a name="a1416"></a>        <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$type</span><span class="src-sym">) </span>&amp;&amp; isset<span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">)</span></li>
<li><a name="a1417"></a>            &amp;&amp; isset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">)</span></li>
<li><a name="a1418"></a>            &amp;&amp; isset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">)</span></li>
<li><a name="a1419"></a>            &amp;&amp; <span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">4</span><span class="src-sym">]</span><span class="src-sym">)</span></li>
<li><a name="a1420"></a>            &amp;&amp; <a href="http://www.php.net/is_array">is_array</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">5</span><span class="src-sym">]</span><span class="src-sym">)</span></li>
<li><a name="a1421"></a>            <span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1422"></a>            <span class="src-comm">/* we have a list of parameters that should be cached */</span></li>
<li><a name="a1423"></a>            <span class="src-var">$_cache_attrs </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">5</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1424"></a>            <span class="src-var">$_count </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cache_attrs_count</span>++<span class="src-sym">;</span></li>
<li><a name="a1425"></a>            <span class="src-var">$cache_code </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">_cache_attrs</span> =&amp; \$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_smarty_cache_attrs</span>('<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cache_serial</span>','<span class="src-var">$_count</span>');</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1426"></a>&nbsp;</li>
<li><a name="a1427"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1428"></a>            <span class="src-comm">/* no parameters are cached */</span></li>
<li><a name="a1429"></a>            <span class="src-var">$_cache_attrs </span>= <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a1430"></a>        <span class="src-sym">}</span></li>
<li><a name="a1431"></a>&nbsp;</li>
<li><a name="a1432"></a>        <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$attrs </span><span class="src-key">as </span><span class="src-var">$arg_name </span>=&gt; <span class="src-var">$arg_value</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1433"></a>            <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/is_bool">is_bool</a><span class="src-sym">(</span><span class="src-var">$arg_value</span><span class="src-sym">))</span></li>
<li><a name="a1434"></a>                <span class="src-var">$arg_value </span>= <span class="src-var">$arg_value </span>? <span class="src-str">'true' </span>: <span class="src-str">'false'</span><span class="src-sym">;</span></li>
<li><a name="a1435"></a>            <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/is_null">is_null</a><span class="src-sym">(</span><span class="src-var">$arg_value</span><span class="src-sym">))</span></li>
<li><a name="a1436"></a>                <span class="src-var">$arg_value </span>= <span class="src-str">'null'</span><span class="src-sym">;</span></li>
<li><a name="a1437"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_cache_attrs </span>&amp;&amp; <a href="http://www.php.net/in_array">in_array</a><span class="src-sym">(</span><span class="src-var">$arg_name</span><span class="src-sym">, </span><span class="src-var">$_cache_attrs</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1438"></a>                <span class="src-var">$arg_list</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-str">&quot;</span><span class="src-str">'<span class="src-var">$arg_name</span>' =&gt; (\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_cache_including</span>) ? \$<span class="src-id">_cache_attrs</span><span class="src-sym">[</span>'<span class="src-var">$arg_name</span>'<span class="src-sym">]</span> : (\$<span class="src-id">_cache_attrs</span><span class="src-sym">[</span>'<span class="src-var">$arg_name</span>'<span class="src-sym">]</span>=<span class="src-var">$arg_value</span>)</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1439"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1440"></a>                <span class="src-var">$arg_list</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-str">&quot;</span><span class="src-str">'<span class="src-var">$arg_name</span>' =&gt; <span class="src-var">$arg_value</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1441"></a>            <span class="src-sym">}</span></li>
<li><a name="a1442"></a>        <span class="src-sym">}</span></li>
<li><a name="a1443"></a>        <span class="src-key">return </span><span class="src-var">$arg_list</span><span class="src-sym">;</span></li>
<li><a name="a1444"></a>    <span class="src-sym">}</span></li>
<li><a name="a1445"></a>&nbsp;</li>
<li><a name="a1446"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1447"></a><span class="src-doc">     * Parse is expression</span></li>
<li><a name="a1448"></a><span class="src-doc">     *</span></li>
<li><a name="a1449"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$is_arg </span></li>
<li><a name="a1450"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">array </span><span class="src-doc-var">$tokens </span></li>
<li><a name="a1451"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span></li>
<li><a name="a1452"></a><span class="src-doc">     */</span></li>
<li><a name="a1453"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_parse_is_expr">_parse_is_expr</a><span class="src-sym">(</span><span class="src-var">$is_arg</span><span class="src-sym">, </span><span class="src-var">$tokens</span><span class="src-sym">)</span></li>
<li><a name="a1454"></a>    <span class="src-sym">{</span></li>
<li><a name="a1455"></a>        <span class="src-var">$expr_end </span>= <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a1456"></a>        <span class="src-var">$negate_expr </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a1457"></a>&nbsp;</li>
<li><a name="a1458"></a>        <span class="src-key">if </span><span class="src-sym">((</span><span class="src-var">$first_token </span>= <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">)) </span>== <span class="src-str">'not'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1459"></a>            <span class="src-var">$negate_expr </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a1460"></a>            <span class="src-var">$expr_type </span>= <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1461"></a>        <span class="src-sym">} </span><span class="src-key">else</span></li>
<li><a name="a1462"></a>            <span class="src-var">$expr_type </span>= <span class="src-var">$first_token</span><span class="src-sym">;</span></li>
<li><a name="a1463"></a>&nbsp;</li>
<li><a name="a1464"></a>        <span class="src-key">switch </span><span class="src-sym">(</span><span class="src-var">$expr_type</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1465"></a>            <span class="src-key">case </span><span class="src-str">'even'</span>:</li>
<li><a name="a1466"></a>                <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$expr_end</span><span class="src-sym">]</span><span class="src-sym">) </span>&amp;&amp; <span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$expr_end</span><span class="src-sym">] </span>== <span class="src-str">'by'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1467"></a>                    <span class="src-var">$expr_end</span>++<span class="src-sym">;</span></li>
<li><a name="a1468"></a>                    <span class="src-var">$expr_arg </span>= <span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$expr_end</span>++<span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1469"></a>                    <span class="src-var">$expr </span>= <span class="src-str">&quot;</span><span class="src-str">!(1 &amp; (<span class="src-var">$is_arg</span> / </span><span class="src-str">&quot; </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var_props">_parse_var_props</a><span class="src-sym">(</span><span class="src-var">$expr_arg</span><span class="src-sym">) </span>. <span class="src-str">&quot;))&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1470"></a>                <span class="src-sym">} </span><span class="src-key">else</span></li>
<li><a name="a1471"></a>                    <span class="src-var">$expr </span>= <span class="src-str">&quot;</span><span class="src-str">!(1 &amp; <span class="src-var">$is_arg</span>)</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1472"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1473"></a>&nbsp;</li>
<li><a name="a1474"></a>            <span class="src-key">case </span><span class="src-str">'odd'</span>:</li>
<li><a name="a1475"></a>                <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$expr_end</span><span class="src-sym">]</span><span class="src-sym">) </span>&amp;&amp; <span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$expr_end</span><span class="src-sym">] </span>== <span class="src-str">'by'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1476"></a>                    <span class="src-var">$expr_end</span>++<span class="src-sym">;</span></li>
<li><a name="a1477"></a>                    <span class="src-var">$expr_arg </span>= <span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$expr_end</span>++<span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1478"></a>                    <span class="src-var">$expr </span>= <span class="src-str">&quot;</span><span class="src-str">(1 &amp; (<span class="src-var">$is_arg</span> / </span><span class="src-str">&quot; </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var_props">_parse_var_props</a><span class="src-sym">(</span><span class="src-var">$expr_arg</span><span class="src-sym">) </span>. <span class="src-str">&quot;))&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1479"></a>                <span class="src-sym">} </span><span class="src-key">else</span></li>
<li><a name="a1480"></a>                    <span class="src-var">$expr </span>= <span class="src-str">&quot;</span><span class="src-str">(1 &amp; <span class="src-var">$is_arg</span>)</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1481"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1482"></a>&nbsp;</li>
<li><a name="a1483"></a>            <span class="src-key">case </span><span class="src-str">'div'</span>:</li>
<li><a name="a1484"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">@</span><span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$expr_end</span><span class="src-sym">] </span>== <span class="src-str">'by'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1485"></a>                    <span class="src-var">$expr_end</span>++<span class="src-sym">;</span></li>
<li><a name="a1486"></a>                    <span class="src-var">$expr_arg </span>= <span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$expr_end</span>++<span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1487"></a>                    <span class="src-var">$expr </span>= <span class="src-str">&quot;</span><span class="src-str">!(<span class="src-var">$is_arg</span> % </span><span class="src-str">&quot; </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var_props">_parse_var_props</a><span class="src-sym">(</span><span class="src-var">$expr_arg</span><span class="src-sym">) </span>. <span class="src-str">&quot;)&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1488"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1489"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;expecting 'by' after 'div'&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1490"></a>                <span class="src-sym">}</span></li>
<li><a name="a1491"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1492"></a>&nbsp;</li>
<li><a name="a1493"></a>            <span class="src-key">default</span>:</li>
<li><a name="a1494"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">unknown</span> '<span class="src-id">is</span>' <span class="src-id">expression</span> - '<span class="src-var">$expr_type</span>'</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1495"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1496"></a>        <span class="src-sym">}</span></li>
<li><a name="a1497"></a>&nbsp;</li>
<li><a name="a1498"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$negate_expr</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1499"></a>            <span class="src-var">$expr </span>= <span class="src-str">&quot;</span><span class="src-str">!(<span class="src-var">$expr</span>)</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1500"></a>        <span class="src-sym">}</span></li>
<li><a name="a1501"></a>&nbsp;</li>
<li><a name="a1502"></a>        <a href="http://www.php.net/array_splice">array_splice</a><span class="src-sym">(</span><span class="src-var">$tokens</span><span class="src-sym">, </span><span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$expr_end</span><span class="src-sym">, </span><span class="src-var">$expr</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1503"></a>&nbsp;</li>
<li><a name="a1504"></a>        <span class="src-key">return </span><span class="src-var">$tokens</span><span class="src-sym">;</span></li>
<li><a name="a1505"></a>    <span class="src-sym">}</span></li>
<li><a name="a1506"></a>&nbsp;</li>
<li><a name="a1507"></a>&nbsp;</li>
<li><a name="a1508"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1509"></a><span class="src-doc">     * Parse attribute string</span></li>
<li><a name="a1510"></a><span class="src-doc">     *</span></li>
<li><a name="a1511"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_args </span></li>
<li><a name="a1512"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span></li>
<li><a name="a1513"></a><span class="src-doc">     */</span></li>
<li><a name="a1514"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_parse_attrs">_parse_attrs</a><span class="src-sym">(</span><span class="src-var">$tag_args</span><span class="src-sym">)</span></li>
<li><a name="a1515"></a>    <span class="src-sym">{</span></li>
<li><a name="a1516"></a>&nbsp;</li>
<li><a name="a1517"></a>        <span class="src-comm">/* Tokenize tag attributes. */</span></li>
<li><a name="a1518"></a>        <a href="http://www.php.net/preg_match_all">preg_match_all</a><span class="src-sym">(</span><span class="src-str">'~(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_call_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_qstr_regexp </span>. <span class="src-str">' | (?&gt;[^&quot;\'=\s]+)</span></li>
<li><a name="a1519"></a><span class="src-str">                         )+ |</span></li>
<li><a name="a1520"></a><span class="src-str">                         [=]</span></li>
<li><a name="a1521"></a><span class="src-str">                        ~x'</span><span class="src-sym">, </span><span class="src-var">$tag_args</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1522"></a>        <span class="src-var">$tokens       </span>= <span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1523"></a>&nbsp;</li>
<li><a name="a1524"></a>        <span class="src-var">$attrs </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1525"></a>        <span class="src-comm">/* Parse state:</span></li>
<li><a name="a1526"></a><span class="src-comm">            0 - expecting attribute name</span></li>
<li><a name="a1527"></a><span class="src-comm">            1 - expecting '='</span></li>
<li><a name="a1528"></a><span class="src-comm">            2 - expecting attribute value (not '=') */</span></li>
<li><a name="a1529"></a>        <span class="src-var">$state </span>= <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a1530"></a>&nbsp;</li>
<li><a name="a1531"></a>        <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$tokens </span><span class="src-key">as </span><span class="src-var">$token</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1532"></a>            <span class="src-key">switch </span><span class="src-sym">(</span><span class="src-var">$state</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1533"></a>                <span class="src-key">case </span><span class="src-num">0</span>:</li>
<li><a name="a1534"></a>                    <span class="src-comm">/* If the token is a valid identifier, we set attribute name</span></li>
<li><a name="a1535"></a><span class="src-comm">                       and go to state 1. */</span></li>
<li><a name="a1536"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^\w+$~'</span><span class="src-sym">, </span><span class="src-var">$token</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1537"></a>                        <span class="src-var">$attr_name </span>= <span class="src-var">$token</span><span class="src-sym">;</span></li>
<li><a name="a1538"></a>                        <span class="src-var">$state </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a1539"></a>                    <span class="src-sym">} </span><span class="src-key">else</span></li>
<li><a name="a1540"></a>                        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">invalid</span> <span class="src-id">attribute</span> <span class="src-id">name</span>: '<span class="src-var">$token</span>'</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1541"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1542"></a>&nbsp;</li>
<li><a name="a1543"></a>                <span class="src-key">case </span><span class="src-num">1</span>:</li>
<li><a name="a1544"></a>                    <span class="src-comm">/* If the token is '=', then we go to state 2. */</span></li>
<li><a name="a1545"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$token </span>== <span class="src-str">'='</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1546"></a>                        <span class="src-var">$state </span>= <span class="src-num">2</span><span class="src-sym">;</span></li>
<li><a name="a1547"></a>                    <span class="src-sym">} </span><span class="src-key">else</span></li>
<li><a name="a1548"></a>                        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">expecting</span> '=' <span class="src-id">after</span> <span class="src-id">attribute</span> <span class="src-id">name</span> '<span class="src-var">$last_token</span>'</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1549"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1550"></a>&nbsp;</li>
<li><a name="a1551"></a>                <span class="src-key">case </span><span class="src-num">2</span>:</li>
<li><a name="a1552"></a>                    <span class="src-comm">/* If token is not '=', we set the attribute value and go to</span></li>
<li><a name="a1553"></a><span class="src-comm">                       state 0. */</span></li>
<li><a name="a1554"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$token </span>!= <span class="src-str">'='</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1555"></a>                        <span class="src-comm">/* We booleanize the token if it's a non-quoted possible</span></li>
<li><a name="a1556"></a><span class="src-comm">                           boolean value. */</span></li>
<li><a name="a1557"></a>                        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^(on|yes|true)$~'</span><span class="src-sym">, </span><span class="src-var">$token</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1558"></a>                            <span class="src-var">$token </span>= <span class="src-str">'true'</span><span class="src-sym">;</span></li>
<li><a name="a1559"></a>                        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^(off|no|false)$~'</span><span class="src-sym">, </span><span class="src-var">$token</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1560"></a>                            <span class="src-var">$token </span>= <span class="src-str">'false'</span><span class="src-sym">;</span></li>
<li><a name="a1561"></a>                        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$token </span>== <span class="src-str">'null'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1562"></a>                            <span class="src-var">$token </span>= <span class="src-str">'null'</span><span class="src-sym">;</span></li>
<li><a name="a1563"></a>                        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp </span>. <span class="src-str">'|0[xX][0-9a-fA-F]+$~'</span><span class="src-sym">, </span><span class="src-var">$token</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1564"></a>                            <span class="src-comm">/* treat integer literally */</span></li>
<li><a name="a1565"></a>                        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_call_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">')*$~'</span><span class="src-sym">, </span><span class="src-var">$token</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1566"></a>                            <span class="src-comm">/* treat as a string, double-quote it escaping quotes */</span></li>
<li><a name="a1567"></a>                            <span class="src-var">$token </span>= <span class="src-str">'&quot;'</span>.<a href="http://www.php.net/addslashes">addslashes</a><span class="src-sym">(</span><span class="src-var">$token</span><span class="src-sym">)</span>.<span class="src-str">'&quot;'</span><span class="src-sym">;</span></li>
<li><a name="a1568"></a>                        <span class="src-sym">}</span></li>
<li><a name="a1569"></a>&nbsp;</li>
<li><a name="a1570"></a>                        <span class="src-var">$attrs</span><span class="src-sym">[</span><span class="src-var">$attr_name</span><span class="src-sym">] </span>= <span class="src-var">$token</span><span class="src-sym">;</span></li>
<li><a name="a1571"></a>                        <span class="src-var">$state </span>= <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a1572"></a>                    <span class="src-sym">} </span><span class="src-key">else</span></li>
<li><a name="a1573"></a>                        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;'=' cannot be an attribute value&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1574"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1575"></a>            <span class="src-sym">}</span></li>
<li><a name="a1576"></a>            <span class="src-var">$last_token </span>= <span class="src-var">$token</span><span class="src-sym">;</span></li>
<li><a name="a1577"></a>        <span class="src-sym">}</span></li>
<li><a name="a1578"></a>&nbsp;</li>
<li><a name="a1579"></a>        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$state </span>!= <span class="src-num">0</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1580"></a>            <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$state </span>== <span class="src-num">1</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1581"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">expecting</span> '=' <span class="src-id">after</span> <span class="src-id">attribute</span> <span class="src-id">name</span> '<span class="src-var">$last_token</span>'</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1582"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1583"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;missing attribute value&quot;</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1584"></a>            <span class="src-sym">}</span></li>
<li><a name="a1585"></a>        <span class="src-sym">}</span></li>
<li><a name="a1586"></a>&nbsp;</li>
<li><a name="a1587"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_vars_props">_parse_vars_props</a><span class="src-sym">(</span><span class="src-var">$attrs</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1588"></a>&nbsp;</li>
<li><a name="a1589"></a>        <span class="src-key">return </span><span class="src-var">$attrs</span><span class="src-sym">;</span></li>
<li><a name="a1590"></a>    <span class="src-sym">}</span></li>
<li><a name="a1591"></a>&nbsp;</li>
<li><a name="a1592"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1593"></a><span class="src-doc">     * compile multiple variables and section properties tokens into</span></li>
<li><a name="a1594"></a><span class="src-doc">     * PHP code</span></li>
<li><a name="a1595"></a><span class="src-doc">     *</span></li>
<li><a name="a1596"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">array </span><span class="src-doc-var">$tokens </span></li>
<li><a name="a1597"></a><span class="src-doc">     */</span></li>
<li><a name="a1598"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_parse_vars_props">_parse_vars_props</a><span class="src-sym">(</span><span class="src-sym">&amp;</span><span class="src-var">$tokens</span><span class="src-sym">)</span></li>
<li><a name="a1599"></a>    <span class="src-sym">{</span></li>
<li><a name="a1600"></a>        <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$tokens </span><span class="src-key">as </span><span class="src-var">$key </span>=&gt; <span class="src-var">$val</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1601"></a>            <span class="src-var">$tokens</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">] </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var_props">_parse_var_props</a><span class="src-sym">(</span><span class="src-var">$val</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1602"></a>        <span class="src-sym">}</span></li>
<li><a name="a1603"></a>    <span class="src-sym">}</span></li>
<li><a name="a1604"></a>&nbsp;</li>
<li><a name="a1605"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1606"></a><span class="src-doc">     * compile single variable and section properties token into</span></li>
<li><a name="a1607"></a><span class="src-doc">     * PHP code</span></li>
<li><a name="a1608"></a><span class="src-doc">     *</span></li>
<li><a name="a1609"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$val </span></li>
<li><a name="a1610"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$tag_attrs </span></li>
<li><a name="a1611"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a1612"></a><span class="src-doc">     */</span></li>
<li><a name="a1613"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_parse_var_props">_parse_var_props</a><span class="src-sym">(</span><span class="src-var">$val</span><span class="src-sym">)</span></li>
<li><a name="a1614"></a>    <span class="src-sym">{</span></li>
<li><a name="a1615"></a>        <span class="src-var">$val </span>= <a href="http://www.php.net/trim">trim</a><span class="src-sym">(</span><span class="src-var">$val</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1616"></a>&nbsp;</li>
<li><a name="a1617"></a>        <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^(' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_call_regexp </span>. <span class="src-str">'|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_regexp </span>. <span class="src-str">')(' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)$~'</span><span class="src-sym">, </span><span class="src-var">$val</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1618"></a>            <span class="src-comm">// $ variable or object</span></li>
<li><a name="a1619"></a>            <span class="src-var">$return </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var">_parse_var</a><span class="src-sym">(</span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1620"></a>            <span class="src-var">$modifiers </span>= <span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1621"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">default_modifiers</span><span class="src-sym">) </span>&amp;&amp; <span class="src-sym">!</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~(^|\|)smarty:nodefaults($|\|)~'</span><span class="src-sym">,</span><span class="src-var">$modifiers</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1622"></a>                <span class="src-var">$_default_mod_string </span>= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">'|'</span><span class="src-sym">,</span>(array)<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">default_modifiers</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1623"></a>                <span class="src-var">$modifiers </span>= <span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$modifiers</span><span class="src-sym">) </span>? <span class="src-var">$_default_mod_string </span>: <span class="src-var">$_default_mod_string </span>. <span class="src-str">'|' </span>. <span class="src-var">$modifiers</span><span class="src-sym">;</span></li>
<li><a name="a1624"></a>            <span class="src-sym">}</span></li>
<li><a name="a1625"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_modifiers">_parse_modifiers</a><span class="src-sym">(</span><span class="src-var">$return</span><span class="src-sym">, </span><span class="src-var">$modifiers</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1626"></a>            <span class="src-key">return </span><span class="src-var">$return</span><span class="src-sym">;</span></li>
<li><a name="a1627"></a>        <span class="src-sym">} </span><span class="src-key">elseif </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_db_qstr_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)$~'</span><span class="src-sym">, </span><span class="src-var">$val</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1628"></a>                <span class="src-comm">// double quoted text</span></li>
<li><a name="a1629"></a>                <a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^(' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_db_qstr_regexp </span>. <span class="src-str">')('</span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)$~'</span><span class="src-sym">, </span><span class="src-var">$val</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1630"></a>                <span class="src-var">$return </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_expand_quoted_text">_expand_quoted_text</a><span class="src-sym">(</span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1631"></a>                <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">] </span>!= <span class="src-str">''</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1632"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_modifiers">_parse_modifiers</a><span class="src-sym">(</span><span class="src-var">$return</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1633"></a>                <span class="src-sym">}</span></li>
<li><a name="a1634"></a>                <span class="src-key">return </span><span class="src-var">$return</span><span class="src-sym">;</span></li>
<li><a name="a1635"></a>            <span class="src-sym">}</span></li>
<li><a name="a1636"></a>        <span class="src-key">elseif</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)$~'</span><span class="src-sym">, </span><span class="src-var">$val</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1637"></a>                <span class="src-comm">// numerical constant</span></li>
<li><a name="a1638"></a>                <a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^(' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_num_const_regexp </span>. <span class="src-str">')('</span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)$~'</span><span class="src-sym">, </span><span class="src-var">$val</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1639"></a>                <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">] </span>!= <span class="src-str">''</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1640"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_modifiers">_parse_modifiers</a><span class="src-sym">(</span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1641"></a>                    <span class="src-key">return </span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1642"></a>                <span class="src-sym">}</span></li>
<li><a name="a1643"></a>            <span class="src-sym">}</span></li>
<li><a name="a1644"></a>        <span class="src-key">elseif</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_si_qstr_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)$~'</span><span class="src-sym">, </span><span class="src-var">$val</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1645"></a>                <span class="src-comm">// single quoted text</span></li>
<li><a name="a1646"></a>                <a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^(' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_si_qstr_regexp </span>. <span class="src-str">')('</span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)$~'</span><span class="src-sym">, </span><span class="src-var">$val</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1647"></a>                <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">] </span>!= <span class="src-str">''</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1648"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_modifiers">_parse_modifiers</a><span class="src-sym">(</span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1649"></a>                    <span class="src-key">return </span><span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1650"></a>                <span class="src-sym">}</span></li>
<li><a name="a1651"></a>            <span class="src-sym">}</span></li>
<li><a name="a1652"></a>        <span class="src-key">elseif</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cvar_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)$~'</span><span class="src-sym">, </span><span class="src-var">$val</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1653"></a>                <span class="src-comm">// config var</span></li>
<li><a name="a1654"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_conf_var">_parse_conf_var</a><span class="src-sym">(</span><span class="src-var">$val</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1655"></a>            <span class="src-sym">}</span></li>
<li><a name="a1656"></a>        <span class="src-key">elseif</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_svar_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_mod_regexp </span>. <span class="src-str">'*)$~'</span><span class="src-sym">, </span><span class="src-var">$val</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1657"></a>                <span class="src-comm">// section var</span></li>
<li><a name="a1658"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_section_prop">_parse_section_prop</a><span class="src-sym">(</span><span class="src-var">$val</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1659"></a>            <span class="src-sym">}</span></li>
<li><a name="a1660"></a>        <span class="src-key">elseif</span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/in_array">in_array</a><span class="src-sym">(</span><span class="src-var">$val</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_permitted_tokens</span><span class="src-sym">) </span>&amp;&amp; <span class="src-sym">!</span><a href="http://www.php.net/is_numeric">is_numeric</a><span class="src-sym">(</span><span class="src-var">$val</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1661"></a>            <span class="src-comm">// literal string</span></li>
<li><a name="a1662"></a>            <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_expand_quoted_text">_expand_quoted_text</a><span class="src-sym">(</span><span class="src-str">'&quot;' </span>. <a href="http://www.php.net/strtr">strtr</a><span class="src-sym">(</span><span class="src-var">$val</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'\\' </span>=&gt; <span class="src-str">'\\\\'</span><span class="src-sym">, </span><span class="src-str">'&quot;' </span>=&gt; <span class="src-str">'\\&quot;'</span><span class="src-sym">)) </span>.<span class="src-str">'&quot;'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1663"></a>        <span class="src-sym">}</span></li>
<li><a name="a1664"></a>        <span class="src-key">return </span><span class="src-var">$val</span><span class="src-sym">;</span></li>
<li><a name="a1665"></a>    <span class="src-sym">}</span></li>
<li><a name="a1666"></a>&nbsp;</li>
<li><a name="a1667"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1668"></a><span class="src-doc">     * expand quoted text with embedded variables</span></li>
<li><a name="a1669"></a><span class="src-doc">     *</span></li>
<li><a name="a1670"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$var_expr </span></li>
<li><a name="a1671"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a1672"></a><span class="src-doc">     */</span></li>
<li><a name="a1673"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_expand_quoted_text">_expand_quoted_text</a><span class="src-sym">(</span><span class="src-var">$var_expr</span><span class="src-sym">)</span></li>
<li><a name="a1674"></a>    <span class="src-sym">{</span></li>
<li><a name="a1675"></a>        <span class="src-comm">// if contains unescaped $, expand it</span></li>
<li><a name="a1676"></a>        <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match_all">preg_match_all</a><span class="src-sym">(</span><span class="src-str">'~(?:\`(?&lt;!\\\\)\$' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_guts_regexp </span>. <span class="src-str">'(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_ext_regexp </span>. <span class="src-str">')*\`)|(?:(?&lt;!\\\\)\$\w+(\[[a-zA-Z0-9]+\])*)~'</span><span class="src-sym">, </span><span class="src-var">$var_expr</span><span class="src-sym">, </span><span class="src-var">$_match</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1677"></a>            <span class="src-var">$_match </span>= <span class="src-var">$_match</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1678"></a>            <a href="http://www.php.net/rsort">rsort</a><span class="src-sym">(</span><span class="src-var">$_match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1679"></a>            <a href="http://www.php.net/reset">reset</a><span class="src-sym">(</span><span class="src-var">$_match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1680"></a>            <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$_match </span><span class="src-key">as </span><span class="src-var">$_var</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1681"></a>                <span class="src-var">$var_expr </span>= <a href="http://www.php.net/str_replace">str_replace</a> <span class="src-sym">(</span><span class="src-var">$_var</span><span class="src-sym">, </span><span class="src-str">'&quot;.(' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var">_parse_var</a><span class="src-sym">(</span><a href="http://www.php.net/str_replace">str_replace</a><span class="src-sym">(</span><span class="src-str">'`'</span><span class="src-sym">,</span><span class="src-str">''</span><span class="src-sym">,</span><span class="src-var">$_var</span><span class="src-sym">)) </span>. <span class="src-str">').&quot;'</span><span class="src-sym">, </span><span class="src-var">$var_expr</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1682"></a>            <span class="src-sym">}</span></li>
<li><a name="a1683"></a>            <span class="src-var">$_return </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">'~\.&quot;&quot;|(?&lt;!\\\\)&quot;&quot;\.~'</span><span class="src-sym">, </span><span class="src-str">''</span><span class="src-sym">, </span><span class="src-var">$var_expr</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1684"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1685"></a>            <span class="src-var">$_return </span>= <span class="src-var">$var_expr</span><span class="src-sym">;</span></li>
<li><a name="a1686"></a>        <span class="src-sym">}</span></li>
<li><a name="a1687"></a>        <span class="src-comm">// replace double quoted literal string with single quotes</span></li>
<li><a name="a1688"></a>        <span class="src-var">$_return </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">'~^&quot;([\s\w]+)&quot;$~'</span><span class="src-sym">,</span><span class="src-str">&quot;'\\1'&quot;</span><span class="src-sym">,</span><span class="src-var">$_return</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1689"></a>        <span class="src-key">return </span><span class="src-var">$_return</span><span class="src-sym">;</span></li>
<li><a name="a1690"></a>    <span class="src-sym">}</span></li>
<li><a name="a1691"></a>&nbsp;</li>
<li><a name="a1692"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1693"></a><span class="src-doc">     * parse variable expression into PHP code</span></li>
<li><a name="a1694"></a><span class="src-doc">     *</span></li>
<li><a name="a1695"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$var_expr </span></li>
<li><a name="a1696"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$output </span></li>
<li><a name="a1697"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a1698"></a><span class="src-doc">     */</span></li>
<li><a name="a1699"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_parse_var">_parse_var</a><span class="src-sym">(</span><span class="src-var">$var_expr</span><span class="src-sym">)</span></li>
<li><a name="a1700"></a>    <span class="src-sym">{</span></li>
<li><a name="a1701"></a>        <span class="src-var">$_has_math </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a1702"></a>        <span class="src-var">$_math_vars </span>= <a href="http://www.php.net/preg_split">preg_split</a><span class="src-sym">(</span><span class="src-str">'~('</span>.<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_math_regexp</span>.<span class="src-str">'|'</span>.<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_qstr_regexp</span>.<span class="src-str">')~'</span><span class="src-sym">, </span><span class="src-var">$var_expr</span><span class="src-sym">, </span>-<span class="src-num">1</span><span class="src-sym">, </span><span class="src-id">PREG_SPLIT_DELIM_CAPTURE</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1703"></a>&nbsp;</li>
<li><a name="a1704"></a>        <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$_math_vars</span><span class="src-sym">) </span>&gt; <span class="src-num">1</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1705"></a>            <span class="src-var">$_first_var </span>= <span class="src-str">&quot;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1706"></a>            <span class="src-var">$_complete_var </span>= <span class="src-str">&quot;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1707"></a>            <span class="src-var">$_output </span>= <span class="src-str">&quot;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1708"></a>            <span class="src-comm">// simple check if there is any math, to stop recursion (due to modifiers with &quot;xx % yy&quot; as parameter)</span></li>
<li><a name="a1709"></a>            <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$_math_vars </span><span class="src-key">as </span><span class="src-var">$_k </span>=&gt; <span class="src-var">$_math_var</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1710"></a>                <span class="src-var">$_math_var </span>= <span class="src-var">$_math_vars</span><span class="src-sym">[</span><span class="src-var">$_k</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1711"></a>&nbsp;</li>
<li><a name="a1712"></a>                <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_math_var</span><span class="src-sym">) </span>|| <a href="http://www.php.net/is_numeric">is_numeric</a><span class="src-sym">(</span><span class="src-var">$_math_var</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1713"></a>                    <span class="src-comm">// hit a math operator, so process the stuff which came before it</span></li>
<li><a name="a1714"></a>                    <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_dvar_math_regexp </span>. <span class="src-str">'$~'</span><span class="src-sym">, </span><span class="src-var">$_math_var</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1715"></a>                        <span class="src-var">$_has_math </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a1716"></a>                        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_complete_var</span><span class="src-sym">) </span>|| <a href="http://www.php.net/is_numeric">is_numeric</a><span class="src-sym">(</span><span class="src-var">$_complete_var</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1717"></a>                            <span class="src-var">$_output </span>.= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var">_parse_var</a><span class="src-sym">(</span><span class="src-var">$_complete_var</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1718"></a>                        <span class="src-sym">}</span></li>
<li><a name="a1719"></a>&nbsp;</li>
<li><a name="a1720"></a>                        <span class="src-comm">// just output the math operator to php</span></li>
<li><a name="a1721"></a>                        <span class="src-var">$_output </span>.= <span class="src-var">$_math_var</span><span class="src-sym">;</span></li>
<li><a name="a1722"></a>&nbsp;</li>
<li><a name="a1723"></a>                        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_first_var</span><span class="src-sym">))</span></li>
<li><a name="a1724"></a>                            <span class="src-var">$_first_var </span>= <span class="src-var">$_complete_var</span><span class="src-sym">;</span></li>
<li><a name="a1725"></a>&nbsp;</li>
<li><a name="a1726"></a>                        <span class="src-var">$_complete_var </span>= <span class="src-str">&quot;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1727"></a>                    <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1728"></a>                        <span class="src-var">$_complete_var </span>.= <span class="src-var">$_math_var</span><span class="src-sym">;</span></li>
<li><a name="a1729"></a>                    <span class="src-sym">}</span></li>
<li><a name="a1730"></a>                <span class="src-sym">}</span></li>
<li><a name="a1731"></a>            <span class="src-sym">}</span></li>
<li><a name="a1732"></a>            <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$_has_math</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1733"></a>                <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_complete_var</span><span class="src-sym">) </span>|| <a href="http://www.php.net/is_numeric">is_numeric</a><span class="src-sym">(</span><span class="src-var">$_complete_var</span><span class="src-sym">))</span></li>
<li><a name="a1734"></a>                    <span class="src-var">$_output </span>.= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var">_parse_var</a><span class="src-sym">(</span><span class="src-var">$_complete_var</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1735"></a>&nbsp;</li>
<li><a name="a1736"></a>                <span class="src-comm">// get the modifiers working (only the last var from math + modifier is left)</span></li>
<li><a name="a1737"></a>                <span class="src-var">$var_expr </span>= <span class="src-var">$_complete_var</span><span class="src-sym">;</span></li>
<li><a name="a1738"></a>            <span class="src-sym">}</span></li>
<li><a name="a1739"></a>        <span class="src-sym">}</span></li>
<li><a name="a1740"></a>&nbsp;</li>
<li><a name="a1741"></a>        <span class="src-comm">// prevent cutting of first digit in the number (we _definitly_ got a number if the first char is a digit)</span></li>
<li><a name="a1742"></a>        <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/is_numeric">is_numeric</a><span class="src-sym">(</span><span class="src-var">$var_expr</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">}</span><span class="src-sym">))</span></li>
<li><a name="a1743"></a>            <span class="src-var">$_var_ref </span>= <span class="src-var">$var_expr</span><span class="src-sym">;</span></li>
<li><a name="a1744"></a>        <span class="src-key">else</span></li>
<li><a name="a1745"></a>            <span class="src-var">$_var_ref </span>= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$var_expr</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1746"></a>        </li>
<li><a name="a1747"></a>        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-var">$_has_math</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1748"></a>            </li>
<li><a name="a1749"></a>            <span class="src-comm">// get [foo] and .foo and -&gt;foo and (...) pieces</span></li>
<li><a name="a1750"></a>            <a href="http://www.php.net/preg_match_all">preg_match_all</a><span class="src-sym">(</span><span class="src-str">'~(?:^\w+)|' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_obj_params_regexp </span>. <span class="src-str">'|(?:' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_var_bracket_regexp </span>. <span class="src-str">')|-&gt;\$?\w+|\.\$?\w+|\S+~'</span><span class="src-sym">, </span><span class="src-var">$_var_ref</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1751"></a>                        </li>
<li><a name="a1752"></a>            <span class="src-var">$_indexes </span>= <span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1753"></a>            <span class="src-var">$_var_name </span>= <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$_indexes</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1754"></a>&nbsp;</li>
<li><a name="a1755"></a>            <span class="src-comm">/* Handle $smarty.* variable references as a special case. */</span></li>
<li><a name="a1756"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_var_name </span>== <span class="src-str">'smarty'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1757"></a>                <span class="src-comm">/*</span></li>
<li><a name="a1758"></a><span class="src-comm">                 * If the reference could be compiled, use the compiled output;</span></li>
<li><a name="a1759"></a><span class="src-comm">                 * otherwise, fall back on the $smarty variable generated at</span></li>
<li><a name="a1760"></a><span class="src-comm">                 * run-time.</span></li>
<li><a name="a1761"></a><span class="src-comm">                 */</span></li>
<li><a name="a1762"></a>                <span class="src-key">if </span><span class="src-sym">((</span><span class="src-var">$smarty_ref </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_smarty_ref">_compile_smarty_ref</a><span class="src-sym">(</span><span class="src-var">$_indexes</span><span class="src-sym">)) </span>!== <span class="src-id">null</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1763"></a>                    <span class="src-var">$_output </span>= <span class="src-var">$smarty_ref</span><span class="src-sym">;</span></li>
<li><a name="a1764"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1765"></a>                    <span class="src-var">$_var_name </span>= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$_indexes</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1766"></a>                    <span class="src-var">$_output </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_smarty_vars</span><span class="src-sym">[</span>'<span class="src-var">$_var_name</span>'<span class="src-sym">]</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1767"></a>                <span class="src-sym">}</span></li>
<li><a name="a1768"></a>            <span class="src-sym">} </span><span class="src-key">elseif</span><span class="src-sym">(</span><a href="http://www.php.net/is_numeric">is_numeric</a><span class="src-sym">(</span><span class="src-var">$_var_name</span><span class="src-sym">) </span>&amp;&amp; <a href="http://www.php.net/is_numeric">is_numeric</a><span class="src-sym">(</span><span class="src-var">$var_expr</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">}</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1769"></a>                <span class="src-comm">// because . is the operator for accessing arrays thru inidizes we need to put it together again for floating point numbers</span></li>
<li><a name="a1770"></a>                <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$_indexes</span><span class="src-sym">) </span>&gt; <span class="src-num">0</span><span class="src-sym">)</span></li>
<li><a name="a1771"></a>                <span class="src-sym">{</span></li>
<li><a name="a1772"></a>                    <span class="src-var">$_var_name </span>.= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">&quot;&quot;</span><span class="src-sym">, </span><span class="src-var">$_indexes</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1773"></a>                    <span class="src-var">$_indexes </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1774"></a>                <span class="src-sym">}</span></li>
<li><a name="a1775"></a>                <span class="src-var">$_output </span>= <span class="src-var">$_var_name</span><span class="src-sym">;</span></li>
<li><a name="a1776"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1777"></a>                <span class="src-var">$_output </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_tpl_vars</span><span class="src-sym">[</span>'<span class="src-var">$_var_name</span>'<span class="src-sym">]</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1778"></a>            <span class="src-sym">}</span></li>
<li><a name="a1779"></a>&nbsp;</li>
<li><a name="a1780"></a>            <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$_indexes </span><span class="src-key">as </span><span class="src-var">$_index</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1781"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">} </span>== <span class="src-str">'['</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1782"></a>                    <span class="src-var">$_index </span>= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">, </span>-<span class="src-num">1</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1783"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/is_numeric">is_numeric</a><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1784"></a>                        <span class="src-var">$_output </span>.= <span class="src-str">&quot;</span><span class="src-str"><span class="src-sym">[</span><span class="src-var">$_index</span><span class="src-sym">]</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1785"></a>                    <span class="src-sym">} </span><span class="src-key">elseif </span><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">} </span>== <span class="src-str">'$'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1786"></a>                        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/strpos">strpos</a><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">, </span><span class="src-str">'.'</span><span class="src-sym">) </span>!== <span class="src-id">false</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1787"></a>                            <span class="src-var">$_output </span>.= <span class="src-str">'[' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var">_parse_var</a><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">) </span>. <span class="src-str">']'</span><span class="src-sym">;</span></li>
<li><a name="a1788"></a>                        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1789"></a>                            <span class="src-var">$_output </span>.= <span class="src-str">&quot;[\$this-&gt;_tpl_vars['&quot; </span>. <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">) </span>. <span class="src-str">&quot;']]&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1790"></a>                        <span class="src-sym">}</span></li>
<li><a name="a1791"></a>                    <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1792"></a>                        <span class="src-var">$_var_parts </span>= <a href="http://www.php.net/explode">explode</a><span class="src-sym">(</span><span class="src-str">'.'</span><span class="src-sym">, </span><span class="src-var">$_index</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1793"></a>                        <span class="src-var">$_var_section </span>= <span class="src-var">$_var_parts</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1794"></a>                        <span class="src-var">$_var_section_prop </span>= isset<span class="src-sym">(</span><span class="src-var">$_var_parts</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">) </span>? <span class="src-var">$_var_parts</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">] </span>: <span class="src-str">'index'</span><span class="src-sym">;</span></li>
<li><a name="a1795"></a>                        <span class="src-var">$_output </span>.= <span class="src-str">&quot;</span><span class="src-str"><span class="src-sym">[</span>\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_sections</span><span class="src-sym">[</span>'<span class="src-var">$_var_section</span>'<span class="src-sym">]</span><span class="src-sym">[</span>'<span class="src-var">$_var_section_prop</span>'<span class="src-sym">]]</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1796"></a>                    <span class="src-sym">}</span></li>
<li><a name="a1797"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">} </span>== <span class="src-str">'.'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1798"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">{</span><span class="src-num">1</span><span class="src-sym">} </span>== <span class="src-str">'$'</span><span class="src-sym">)</span></li>
<li><a name="a1799"></a>                        <span class="src-var">$_output </span>.= <span class="src-str">&quot;[\$this-&gt;_tpl_vars['&quot; </span>. <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">, </span><span class="src-num">2</span><span class="src-sym">) </span>. <span class="src-str">&quot;']]&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1800"></a>                    <span class="src-key">else</span></li>
<li><a name="a1801"></a>                        <span class="src-var">$_output </span>.= <span class="src-str">&quot;['&quot; </span>. <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">) </span>. <span class="src-str">&quot;']&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1802"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">,</span><span class="src-num">0</span><span class="src-sym">,</span><span class="src-num">2</span><span class="src-sym">) </span>== <span class="src-str">'-&gt;'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1803"></a>                    <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">,</span><span class="src-num">2</span><span class="src-sym">,</span><span class="src-num">2</span><span class="src-sym">) </span>== <span class="src-str">'__'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1804"></a>                        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">'call to internal object members is not allowed'</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1805"></a>                    <span class="src-sym">} </span><span class="src-key">elseif</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">security </span>&amp;&amp; <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">, </span><span class="src-num">2</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">) </span>== <span class="src-str">'_'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1806"></a>                        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">'(secure) call to private object member is not allowed'</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1807"></a>                    <span class="src-sym">} </span><span class="src-key">elseif </span><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">{</span><span class="src-num">2</span><span class="src-sym">} </span>== <span class="src-str">'$'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1808"></a>                        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">security</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1809"></a>                            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">'(secure) call to dynamic object member is not allowed'</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1810"></a>                        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1811"></a>                            <span class="src-var">$_output </span>.= <span class="src-str">'-&gt;{(($_var=$this-&gt;_tpl_vars[\''</span>.<a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">,</span><span class="src-num">3</span><span class="src-sym">)</span>.<span class="src-str">'\']) &amp;&amp; substr($_var,0,2)!=\'__\') ? $_var : $this-&gt;trigger_error(&quot;cannot access property \\&quot;$_var\\&quot;&quot;)}'</span><span class="src-sym">;</span></li>
<li><a name="a1812"></a>                        <span class="src-sym">}</span></li>
<li><a name="a1813"></a>                    <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1814"></a>                        <span class="src-var">$_output </span>.= <span class="src-var">$_index</span><span class="src-sym">;</span></li>
<li><a name="a1815"></a>                    <span class="src-sym">}</span></li>
<li><a name="a1816"></a>                <span class="src-sym">} </span><span class="src-key">elseif </span><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">} </span>== <span class="src-str">'('</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1817"></a>                    <span class="src-var">$_index </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_parenth_args">_parse_parenth_args</a><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1818"></a>                    <span class="src-var">$_output </span>.= <span class="src-var">$_index</span><span class="src-sym">;</span></li>
<li><a name="a1819"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1820"></a>                    <span class="src-var">$_output </span>.= <span class="src-var">$_index</span><span class="src-sym">;</span></li>
<li><a name="a1821"></a>                <span class="src-sym">}</span></li>
<li><a name="a1822"></a>            <span class="src-sym">}</span></li>
<li><a name="a1823"></a>        <span class="src-sym">}</span></li>
<li><a name="a1824"></a>&nbsp;</li>
<li><a name="a1825"></a>        <span class="src-key">return </span><span class="src-var">$_output</span><span class="src-sym">;</span></li>
<li><a name="a1826"></a>    <span class="src-sym">}</span></li>
<li><a name="a1827"></a>&nbsp;</li>
<li><a name="a1828"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1829"></a><span class="src-doc">     * parse arguments in function call parenthesis</span></li>
<li><a name="a1830"></a><span class="src-doc">     *</span></li>
<li><a name="a1831"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$parenth_args </span></li>
<li><a name="a1832"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a1833"></a><span class="src-doc">     */</span></li>
<li><a name="a1834"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_parse_parenth_args">_parse_parenth_args</a><span class="src-sym">(</span><span class="src-var">$parenth_args</span><span class="src-sym">)</span></li>
<li><a name="a1835"></a>    <span class="src-sym">{</span></li>
<li><a name="a1836"></a>        <a href="http://www.php.net/preg_match_all">preg_match_all</a><span class="src-sym">(</span><span class="src-str">'~' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_param_regexp </span>. <span class="src-str">'~'</span><span class="src-sym">,</span><span class="src-var">$parenth_args</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1837"></a>        <span class="src-var">$orig_vals </span>= <span class="src-var">$match </span>= <span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1838"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_vars_props">_parse_vars_props</a><span class="src-sym">(</span><span class="src-var">$match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1839"></a>        <span class="src-var">$replace </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1840"></a>        <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$i </span>= <span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$count </span>= <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$match</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-var">$i </span>&lt; <span class="src-var">$count</span><span class="src-sym">; </span><span class="src-var">$i</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1841"></a>            <span class="src-var">$replace</span><span class="src-sym">[</span><span class="src-var">$orig_vals</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]] </span>= <span class="src-var">$match</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1842"></a>        <span class="src-sym">}</span></li>
<li><a name="a1843"></a>        <span class="src-key">return </span><a href="http://www.php.net/strtr">strtr</a><span class="src-sym">(</span><span class="src-var">$parenth_args</span><span class="src-sym">, </span><span class="src-var">$replace</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1844"></a>    <span class="src-sym">}</span></li>
<li><a name="a1845"></a>&nbsp;</li>
<li><a name="a1846"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1847"></a><span class="src-doc">     * parse configuration variable expression into PHP code</span></li>
<li><a name="a1848"></a><span class="src-doc">     *</span></li>
<li><a name="a1849"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$conf_var_expr </span></li>
<li><a name="a1850"></a><span class="src-doc">     */</span></li>
<li><a name="a1851"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_parse_conf_var">_parse_conf_var</a><span class="src-sym">(</span><span class="src-var">$conf_var_expr</span><span class="src-sym">)</span></li>
<li><a name="a1852"></a>    <span class="src-sym">{</span></li>
<li><a name="a1853"></a>        <span class="src-var">$parts </span>= <a href="http://www.php.net/explode">explode</a><span class="src-sym">(</span><span class="src-str">'|'</span><span class="src-sym">, </span><span class="src-var">$conf_var_expr</span><span class="src-sym">, </span><span class="src-num">2</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1854"></a>        <span class="src-var">$var_ref </span>= <span class="src-var">$parts</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1855"></a>        <span class="src-var">$modifiers </span>= isset<span class="src-sym">(</span><span class="src-var">$parts</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">) </span>? <span class="src-var">$parts</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">] </span>: <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a1856"></a>&nbsp;</li>
<li><a name="a1857"></a>        <span class="src-var">$var_name </span>= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$var_ref</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">, </span>-<span class="src-num">1</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1858"></a>&nbsp;</li>
<li><a name="a1859"></a>        <span class="src-var">$output </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_config</span><span class="src-sym">[</span>0<span class="src-sym">]</span><span class="src-sym">[</span>'<span class="src-id">vars</span>'<span class="src-sym">]</span><span class="src-sym">[</span>'<span class="src-var">$var_name</span>'<span class="src-sym">]</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1860"></a>&nbsp;</li>
<li><a name="a1861"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_modifiers">_parse_modifiers</a><span class="src-sym">(</span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$modifiers</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1862"></a>&nbsp;</li>
<li><a name="a1863"></a>        <span class="src-key">return </span><span class="src-var">$output</span><span class="src-sym">;</span></li>
<li><a name="a1864"></a>    <span class="src-sym">}</span></li>
<li><a name="a1865"></a>&nbsp;</li>
<li><a name="a1866"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1867"></a><span class="src-doc">     * parse section property expression into PHP code</span></li>
<li><a name="a1868"></a><span class="src-doc">     *</span></li>
<li><a name="a1869"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$section_prop_expr </span></li>
<li><a name="a1870"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a1871"></a><span class="src-doc">     */</span></li>
<li><a name="a1872"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_parse_section_prop">_parse_section_prop</a><span class="src-sym">(</span><span class="src-var">$section_prop_expr</span><span class="src-sym">)</span></li>
<li><a name="a1873"></a>    <span class="src-sym">{</span></li>
<li><a name="a1874"></a>        <span class="src-var">$parts </span>= <a href="http://www.php.net/explode">explode</a><span class="src-sym">(</span><span class="src-str">'|'</span><span class="src-sym">, </span><span class="src-var">$section_prop_expr</span><span class="src-sym">, </span><span class="src-num">2</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1875"></a>        <span class="src-var">$var_ref </span>= <span class="src-var">$parts</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1876"></a>        <span class="src-var">$modifiers </span>= isset<span class="src-sym">(</span><span class="src-var">$parts</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">) </span>? <span class="src-var">$parts</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">] </span>: <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a1877"></a>&nbsp;</li>
<li><a name="a1878"></a>        <a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'!%(\w+)\.(\w+)%!'</span><span class="src-sym">, </span><span class="src-var">$var_ref</span><span class="src-sym">, </span><span class="src-var">$match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1879"></a>        <span class="src-var">$section_name </span>= <span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1880"></a>        <span class="src-var">$prop_name </span>= <span class="src-var">$match</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1881"></a>&nbsp;</li>
<li><a name="a1882"></a>        <span class="src-var">$output </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_sections</span><span class="src-sym">[</span>'<span class="src-var">$section_name</span>'<span class="src-sym">]</span><span class="src-sym">[</span>'<span class="src-var">$prop_name</span>'<span class="src-sym">]</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1883"></a>&nbsp;</li>
<li><a name="a1884"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_modifiers">_parse_modifiers</a><span class="src-sym">(</span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$modifiers</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1885"></a>&nbsp;</li>
<li><a name="a1886"></a>        <span class="src-key">return </span><span class="src-var">$output</span><span class="src-sym">;</span></li>
<li><a name="a1887"></a>    <span class="src-sym">}</span></li>
<li><a name="a1888"></a>&nbsp;</li>
<li><a name="a1889"></a>&nbsp;</li>
<li><a name="a1890"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1891"></a><span class="src-doc">     * parse modifier chain into PHP code</span></li>
<li><a name="a1892"></a><span class="src-doc">     *</span></li>
<li><a name="a1893"></a><span class="src-doc">     * sets $output to parsed modified chain</span></li>
<li><a name="a1894"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$output </span></li>
<li><a name="a1895"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$modifier_string </span></li>
<li><a name="a1896"></a><span class="src-doc">     */</span></li>
<li><a name="a1897"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_parse_modifiers">_parse_modifiers</a><span class="src-sym">(</span><span class="src-sym">&amp;</span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$modifier_string</span><span class="src-sym">)</span></li>
<li><a name="a1898"></a>    <span class="src-sym">{</span></li>
<li><a name="a1899"></a>        <a href="http://www.php.net/preg_match_all">preg_match_all</a><span class="src-sym">(</span><span class="src-str">'~\|(@?\w+)((?&gt;:(?:'</span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_qstr_regexp </span>. <span class="src-str">'|[^|]+))*)~'</span><span class="src-sym">, </span><span class="src-str">'|' </span>. <span class="src-var">$modifier_string</span><span class="src-sym">, </span><span class="src-var">$_match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1900"></a>        list<span class="src-sym">(</span><span class="src-sym">, </span><span class="src-var">$_modifiers</span><span class="src-sym">, </span><span class="src-var">$modifier_arg_strings</span><span class="src-sym">) </span>= <span class="src-var">$_match</span><span class="src-sym">;</span></li>
<li><a name="a1901"></a>&nbsp;</li>
<li><a name="a1902"></a>        <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$_i </span>= <span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$_for_max </span>= <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$_modifiers</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-var">$_i </span>&lt; <span class="src-var">$_for_max</span><span class="src-sym">; </span><span class="src-var">$_i</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1903"></a>            <span class="src-var">$_modifier_name </span>= <span class="src-var">$_modifiers</span><span class="src-sym">[</span><span class="src-var">$_i</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1904"></a>&nbsp;</li>
<li><a name="a1905"></a>            <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$_modifier_name </span>== <span class="src-str">'smarty'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1906"></a>                <span class="src-comm">// skip smarty modifier</span></li>
<li><a name="a1907"></a>                <span class="src-key">continue</span><span class="src-sym">;</span></li>
<li><a name="a1908"></a>            <span class="src-sym">}</span></li>
<li><a name="a1909"></a>&nbsp;</li>
<li><a name="a1910"></a>            <a href="http://www.php.net/preg_match_all">preg_match_all</a><span class="src-sym">(</span><span class="src-str">'~:(' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_qstr_regexp </span>. <span class="src-str">'|[^:]+)~'</span><span class="src-sym">, </span><span class="src-var">$modifier_arg_strings</span><span class="src-sym">[</span><span class="src-var">$_i</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-var">$_match</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1911"></a>            <span class="src-var">$_modifier_args </span>= <span class="src-var">$_match</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1912"></a>&nbsp;</li>
<li><a name="a1913"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_modifier_name</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">} </span>== <span class="src-str">'@'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1914"></a>                <span class="src-var">$_map_array </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a1915"></a>                <span class="src-var">$_modifier_name </span>= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$_modifier_name</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1916"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1917"></a>                <span class="src-var">$_map_array </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a1918"></a>            <span class="src-sym">}</span></li>
<li><a name="a1919"></a>&nbsp;</li>
<li><a name="a1920"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'modifier'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$_modifier_name</span><span class="src-sym">]</span><span class="src-sym">)</span></li>
<li><a name="a1921"></a>                &amp;&amp; <span class="src-sym">!</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_get_plugin_filepath</span><span class="src-sym">(</span><span class="src-str">'modifier'</span><span class="src-sym">, </span><span class="src-var">$_modifier_name</span><span class="src-sym">)</span></li>
<li><a name="a1922"></a>                &amp;&amp; <a href="http://www.php.net/function_exists">function_exists</a><span class="src-sym">(</span><span class="src-var">$_modifier_name</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1923"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">security </span>&amp;&amp; <span class="src-sym">!</span><a href="http://www.php.net/in_array">in_array</a><span class="src-sym">(</span><span class="src-var">$_modifier_name</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">security_settings</span><span class="src-sym">[</span><span class="src-str">'MODIFIER_FUNCS'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1924"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_trigger_fatal_error</span><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-sym">[</span><span class="src-id">plugin</span><span class="src-sym">]</span> (<span class="src-id">secure</span> <span class="src-id">mode</span>) <span class="src-id">modifier</span> '<span class="src-var">$_modifier_name</span>' <span class="src-id">is</span> <span class="src-id">not</span> <span class="src-id">allowed</span></span><span class="src-str">&quot; </span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_file</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_line_no</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1925"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1926"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'modifier'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$_modifier_name</span><span class="src-sym">] </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-var">$_modifier_name</span><span class="src-sym">,  </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1927"></a>                <span class="src-sym">}</span></li>
<li><a name="a1928"></a>            <span class="src-sym">}</span></li>
<li><a name="a1929"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_add_plugin">_add_plugin</a><span class="src-sym">(</span><span class="src-str">'modifier'</span><span class="src-sym">, </span><span class="src-var">$_modifier_name</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1930"></a>&nbsp;</li>
<li><a name="a1931"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_vars_props">_parse_vars_props</a><span class="src-sym">(</span><span class="src-var">$_modifier_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1932"></a>&nbsp;</li>
<li><a name="a1933"></a>            <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$_modifier_name </span>== <span class="src-str">'default'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1934"></a>                <span class="src-comm">// supress notifications of default modifier vars and args</span></li>
<li><a name="a1935"></a>                <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$output</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">} </span>== <span class="src-str">'$'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1936"></a>                    <span class="src-var">$output </span>= <span class="src-str">'@' </span>. <span class="src-var">$output</span><span class="src-sym">;</span></li>
<li><a name="a1937"></a>                <span class="src-sym">}</span></li>
<li><a name="a1938"></a>                <span class="src-key">if</span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$_modifier_args</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">) </span>&amp;&amp; <span class="src-var">$_modifier_args</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">} </span>== <span class="src-str">'$'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1939"></a>                    <span class="src-var">$_modifier_args</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">] </span>= <span class="src-str">'@' </span>. <span class="src-var">$_modifier_args</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1940"></a>                <span class="src-sym">}</span></li>
<li><a name="a1941"></a>            <span class="src-sym">}</span></li>
<li><a name="a1942"></a>            <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$_modifier_args</span><span class="src-sym">) </span>&gt; <span class="src-num">0</span><span class="src-sym">)</span></li>
<li><a name="a1943"></a>                <span class="src-var">$_modifier_args </span>= <span class="src-str">', '</span>.<a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">', '</span><span class="src-sym">, </span><span class="src-var">$_modifier_args</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1944"></a>            <span class="src-key">else</span></li>
<li><a name="a1945"></a>                <span class="src-var">$_modifier_args </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a1946"></a>&nbsp;</li>
<li><a name="a1947"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_map_array</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1948"></a>                <span class="src-var">$output </span>= <span class="src-str">&quot;</span><span class="src-str">((<span class="src-id">is_array</span>(\$<span class="src-id">_tmp</span>=<span class="src-var">$output</span>)) ? \$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_run_mod_handler</span>('<span class="src-var">$_modifier_name</span>', <span class="src-id">true</span>, \$<span class="src-id">_tmp</span><span class="src-var">$_modifier_args</span>) : </span><span class="src-str">&quot; </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_plugin_call">_compile_plugin_call</a><span class="src-sym">(</span><span class="src-str">'modifier'</span><span class="src-sym">, </span><span class="src-var">$_modifier_name</span><span class="src-sym">) </span>. <span class="src-str">&quot;</span><span class="src-str">(\$<span class="src-id">_tmp</span><span class="src-var">$_modifier_args</span>))</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1949"></a>&nbsp;</li>
<li><a name="a1950"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1951"></a>&nbsp;</li>
<li><a name="a1952"></a>                <span class="src-var">$output </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_compile_plugin_call">_compile_plugin_call</a><span class="src-sym">(</span><span class="src-str">'modifier'</span><span class="src-sym">, </span><span class="src-var">$_modifier_name</span><span class="src-sym">)</span>.<span class="src-str">&quot;</span><span class="src-str">(<span class="src-var">$output$_modifier_args</span>)</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1953"></a>&nbsp;</li>
<li><a name="a1954"></a>            <span class="src-sym">}</span></li>
<li><a name="a1955"></a>        <span class="src-sym">}</span></li>
<li><a name="a1956"></a>    <span class="src-sym">}</span></li>
<li><a name="a1957"></a>&nbsp;</li>
<li><a name="a1958"></a>&nbsp;</li>
<li><a name="a1959"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1960"></a><span class="src-doc">     * add plugin</span></li>
<li><a name="a1961"></a><span class="src-doc">     *</span></li>
<li><a name="a1962"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$type </span></li>
<li><a name="a1963"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$name </span></li>
<li><a name="a1964"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">boolean? </span><span class="src-doc-var">$delayed_loading </span></li>
<li><a name="a1965"></a><span class="src-doc">     */</span></li>
<li><a name="a1966"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_add_plugin">_add_plugin</a><span class="src-sym">(</span><span class="src-var">$type</span><span class="src-sym">, </span><span class="src-var">$name</span><span class="src-sym">, </span><span class="src-var">$delayed_loading </span>= <span class="src-id">null</span><span class="src-sym">)</span></li>
<li><a name="a1967"></a>    <span class="src-sym">{</span></li>
<li><a name="a1968"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugin_info</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1969"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugin_info</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">] </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1970"></a>        <span class="src-sym">}</span></li>
<li><a name="a1971"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugin_info</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1972"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugin_info</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">] </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_file</span><span class="src-sym">,</span></li>
<li><a name="a1973"></a>                                                      <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_line_no</span><span class="src-sym">,</span></li>
<li><a name="a1974"></a>                                                      <span class="src-var">$delayed_loading</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1975"></a>        <span class="src-sym">}</span></li>
<li><a name="a1976"></a>    <span class="src-sym">}</span></li>
<li><a name="a1977"></a>&nbsp;</li>
<li><a name="a1978"></a>&nbsp;</li>
<li><a name="a1979"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1980"></a><span class="src-doc">     * Compiles references of type $smarty.foo</span></li>
<li><a name="a1981"></a><span class="src-doc">     *</span></li>
<li><a name="a1982"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$indexes </span></li>
<li><a name="a1983"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a1984"></a><span class="src-doc">     */</span></li>
<li><a name="a1985"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_smarty_ref">_compile_smarty_ref</a><span class="src-sym">(</span><span class="src-sym">&amp;</span><span class="src-var">$indexes</span><span class="src-sym">)</span></li>
<li><a name="a1986"></a>    <span class="src-sym">{</span></li>
<li><a name="a1987"></a>        <span class="src-comm">/* Extract the reference name. */</span></li>
<li><a name="a1988"></a>        <span class="src-var">$_ref </span>= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1989"></a>        <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$indexes </span><span class="src-key">as </span><span class="src-var">$_index_no</span>=&gt;<span class="src-var">$_index</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1990"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_index</span><span class="src-sym">{</span><span class="src-num">0</span><span class="src-sym">} </span>!= <span class="src-str">'.' </span>&amp;&amp; <span class="src-var">$_index_no</span>&lt;<span class="src-num">2 </span>|| <span class="src-sym">!</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'~^(\.|\[|-&gt;)~'</span><span class="src-sym">, </span><span class="src-var">$_index</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1991"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">'$smarty' </span>. <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">''</span><span class="src-sym">, </span><a href="http://www.php.net/array_slice">array_slice</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">, </span><span class="src-num">0</span><span class="src-sym">, </span><span class="src-num">2</span><span class="src-sym">)) </span>. <span class="src-str">' is an invalid reference'</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1992"></a>            <span class="src-sym">}</span></li>
<li><a name="a1993"></a>        <span class="src-sym">}</span></li>
<li><a name="a1994"></a>&nbsp;</li>
<li><a name="a1995"></a>        <span class="src-key">switch </span><span class="src-sym">(</span><span class="src-var">$_ref</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1996"></a>            <span class="src-key">case </span><span class="src-str">'now'</span>:</li>
<li><a name="a1997"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-str">'time()'</span><span class="src-sym">;</span></li>
<li><a name="a1998"></a>                <span class="src-var">$_max_index </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a1999"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2000"></a>&nbsp;</li>
<li><a name="a2001"></a>            <span class="src-key">case </span><span class="src-str">'foreach'</span>:</li>
<li><a name="a2002"></a>                <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2003"></a>                <span class="src-var">$_var </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var_props">_parse_var_props</a><span class="src-sym">(</span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a2004"></a>                <span class="src-var">$_propname </span>= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2005"></a>                <span class="src-var">$_max_index </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a2006"></a>                <span class="src-key">switch </span><span class="src-sym">(</span><span class="src-var">$_propname</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2007"></a>                    <span class="src-key">case </span><span class="src-str">'index'</span>:</li>
<li><a name="a2008"></a>                        <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2009"></a>                        <span class="src-var">$compiled_ref </span>= <span class="src-str">&quot;</span><span class="src-str">(\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_foreach</span><span class="src-sym">[</span><span class="src-var">$_var</span><span class="src-sym">]</span><span class="src-sym">[</span>'<span class="src-id">iteration</span>'<span class="src-sym">]</span>-1)</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2010"></a>                        <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2011"></a>                        </li>
<li><a name="a2012"></a>                    <span class="src-key">case </span><span class="src-str">'first'</span>:</li>
<li><a name="a2013"></a>                        <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2014"></a>                        <span class="src-var">$compiled_ref </span>= <span class="src-str">&quot;</span><span class="src-str">(\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_foreach</span><span class="src-sym">[</span><span class="src-var">$_var</span><span class="src-sym">]</span><span class="src-sym">[</span>'<span class="src-id">iteration</span>'<span class="src-sym">]</span> &lt;= 1)</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2015"></a>                        <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2016"></a>&nbsp;</li>
<li><a name="a2017"></a>                    <span class="src-key">case </span><span class="src-str">'last'</span>:</li>
<li><a name="a2018"></a>                        <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2019"></a>                        <span class="src-var">$compiled_ref </span>= <span class="src-str">&quot;</span><span class="src-str">(\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_foreach</span><span class="src-sym">[</span><span class="src-var">$_var</span><span class="src-sym">]</span><span class="src-sym">[</span>'<span class="src-id">iteration</span>'<span class="src-sym">]</span> == \$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_foreach</span><span class="src-sym">[</span><span class="src-var">$_var</span><span class="src-sym">]</span><span class="src-sym">[</span>'<span class="src-id">total</span>'<span class="src-sym">]</span>)</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2020"></a>                        <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2021"></a>                        </li>
<li><a name="a2022"></a>                    <span class="src-key">case </span><span class="src-str">'show'</span>:</li>
<li><a name="a2023"></a>                        <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2024"></a>                        <span class="src-var">$compiled_ref </span>= <span class="src-str">&quot;</span><span class="src-str">(\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_foreach</span><span class="src-sym">[</span><span class="src-var">$_var</span><span class="src-sym">]</span><span class="src-sym">[</span>'<span class="src-id">total</span>'<span class="src-sym">]</span> &gt; 0)</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2025"></a>                        <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2026"></a>                        </li>
<li><a name="a2027"></a>                    <span class="src-key">default</span>:</li>
<li><a name="a2028"></a>                        unset<span class="src-sym">(</span><span class="src-var">$_max_index</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2029"></a>                        <span class="src-var">$compiled_ref </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_foreach</span><span class="src-sym">[</span><span class="src-var">$_var</span><span class="src-sym">]</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2030"></a>                <span class="src-sym">}</span></li>
<li><a name="a2031"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2032"></a>&nbsp;</li>
<li><a name="a2033"></a>            <span class="src-key">case </span><span class="src-str">'section'</span>:</li>
<li><a name="a2034"></a>                <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2035"></a>                <span class="src-var">$_var </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var_props">_parse_var_props</a><span class="src-sym">(</span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a2036"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_sections</span><span class="src-sym">[</span><span class="src-var">$_var</span><span class="src-sym">]</span></span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2037"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2038"></a>&nbsp;</li>
<li><a name="a2039"></a>            <span class="src-key">case </span><span class="src-str">'get'</span>:</li>
<li><a name="a2040"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">request_use_auto_globals</span><span class="src-sym">) </span>? <span class="src-str">'$_GET' </span>: <span class="src-str">&quot;\$GLOBALS['HTTP_GET_VARS']&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2041"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2042"></a>&nbsp;</li>
<li><a name="a2043"></a>            <span class="src-key">case </span><span class="src-str">'post'</span>:</li>
<li><a name="a2044"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">request_use_auto_globals</span><span class="src-sym">) </span>? <span class="src-str">'$_POST' </span>: <span class="src-str">&quot;\$GLOBALS['HTTP_POST_VARS']&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2045"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2046"></a>&nbsp;</li>
<li><a name="a2047"></a>            <span class="src-key">case </span><span class="src-str">'cookies'</span>:</li>
<li><a name="a2048"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">request_use_auto_globals</span><span class="src-sym">) </span>? <span class="src-str">'$_COOKIE' </span>: <span class="src-str">&quot;\$GLOBALS['HTTP_COOKIE_VARS']&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2049"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2050"></a>&nbsp;</li>
<li><a name="a2051"></a>            <span class="src-key">case </span><span class="src-str">'env'</span>:</li>
<li><a name="a2052"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">request_use_auto_globals</span><span class="src-sym">) </span>? <span class="src-str">'$_ENV' </span>: <span class="src-str">&quot;\$GLOBALS['HTTP_ENV_VARS']&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2053"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2054"></a>&nbsp;</li>
<li><a name="a2055"></a>            <span class="src-key">case </span><span class="src-str">'server'</span>:</li>
<li><a name="a2056"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">request_use_auto_globals</span><span class="src-sym">) </span>? <span class="src-str">'$_SERVER' </span>: <span class="src-str">&quot;\$GLOBALS['HTTP_SERVER_VARS']&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2057"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2058"></a>&nbsp;</li>
<li><a name="a2059"></a>            <span class="src-key">case </span><span class="src-str">'session'</span>:</li>
<li><a name="a2060"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">request_use_auto_globals</span><span class="src-sym">) </span>? <span class="src-str">'$_SESSION' </span>: <span class="src-str">&quot;\$GLOBALS['HTTP_SESSION_VARS']&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2061"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2062"></a>&nbsp;</li>
<li><a name="a2063"></a>            <span class="src-comm">/*</span></li>
<li><a name="a2064"></a><span class="src-comm">             * These cases are handled either at run-time or elsewhere in the</span></li>
<li><a name="a2065"></a><span class="src-comm">             * compiler.</span></li>
<li><a name="a2066"></a><span class="src-comm">             */</span></li>
<li><a name="a2067"></a>            <span class="src-key">case </span><span class="src-str">'request'</span>:</li>
<li><a name="a2068"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">request_use_auto_globals</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2069"></a>                    <span class="src-var">$compiled_ref </span>= <span class="src-str">'$_REQUEST'</span><span class="src-sym">;</span></li>
<li><a name="a2070"></a>                    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2071"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a2072"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_init_smarty_vars </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a2073"></a>                <span class="src-sym">}</span></li>
<li><a name="a2074"></a>                <span class="src-key">return </span><span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a2075"></a>&nbsp;</li>
<li><a name="a2076"></a>            <span class="src-key">case </span><span class="src-str">'capture'</span>:</li>
<li><a name="a2077"></a>                <span class="src-key">return </span><span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a2078"></a>&nbsp;</li>
<li><a name="a2079"></a>            <span class="src-key">case </span><span class="src-str">'template'</span>:</li>
<li><a name="a2080"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-str">&quot;</span><span class="src-str">'<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_file</span>'</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2081"></a>                <span class="src-var">$_max_index </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a2082"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2083"></a>&nbsp;</li>
<li><a name="a2084"></a>            <span class="src-key">case </span><span class="src-str">'version'</span>:</li>
<li><a name="a2085"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-str">&quot;</span><span class="src-str">'<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_version</span>'</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2086"></a>                <span class="src-var">$_max_index </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a2087"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2088"></a>&nbsp;</li>
<li><a name="a2089"></a>            <span class="src-key">case </span><span class="src-str">'const'</span>:</li>
<li><a name="a2090"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">security </span>&amp;&amp; <span class="src-sym">!</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">security_settings</span><span class="src-sym">[</span><span class="src-str">'ALLOW_CONSTANTS'</span><span class="src-sym">]</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2091"></a>                    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;(secure mode) constants not permitted&quot;</span><span class="src-sym">,</span></li>
<li><a name="a2092"></a>                                         <span class="src-id">E_USER_WARNING</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2093"></a>                    <span class="src-key">return</span><span class="src-sym">;</span></li>
<li><a name="a2094"></a>                <span class="src-sym">}</span></li>
<li><a name="a2095"></a>                <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2096"></a>                <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">'!^\.\w+$!'</span><span class="src-sym">, </span><span class="src-var">$indexes</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a2097"></a>                    <span class="src-var">$compiled_ref </span>= <span class="src-str">'@' </span>. <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2098"></a>                <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a2099"></a>                    <span class="src-var">$_val </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_parse_var_props">_parse_var_props</a><span class="src-sym">(</span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-num">1</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a2100"></a>                    <span class="src-var">$compiled_ref </span>= <span class="src-str">'@constant(' </span>. <span class="src-var">$_val </span>. <span class="src-str">')'</span><span class="src-sym">;</span></li>
<li><a name="a2101"></a>                <span class="src-sym">}</span></li>
<li><a name="a2102"></a>                <span class="src-var">$_max_index </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a2103"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2104"></a>&nbsp;</li>
<li><a name="a2105"></a>            <span class="src-key">case </span><span class="src-str">'config'</span>:</li>
<li><a name="a2106"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-str">&quot;\$this-&gt;_config[0]['vars']&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2107"></a>                <span class="src-var">$_max_index </span>= <span class="src-num">3</span><span class="src-sym">;</span></li>
<li><a name="a2108"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2109"></a>&nbsp;</li>
<li><a name="a2110"></a>            <span class="src-key">case </span><span class="src-str">'ldelim'</span>:</li>
<li><a name="a2111"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-str">&quot;</span><span class="src-str">'<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">left_delimiter</span>'</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2112"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2113"></a>&nbsp;</li>
<li><a name="a2114"></a>            <span class="src-key">case </span><span class="src-str">'rdelim'</span>:</li>
<li><a name="a2115"></a>                <span class="src-var">$compiled_ref </span>= <span class="src-str">&quot;</span><span class="src-str">'<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">right_delimiter</span>'</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2116"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2117"></a>                </li>
<li><a name="a2118"></a>            <span class="src-key">default</span>:</li>
<li><a name="a2119"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">'$smarty.' </span>. <span class="src-var">$_ref </span>. <span class="src-str">' is an unknown reference'</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2120"></a>                <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a2121"></a>        <span class="src-sym">}</span></li>
<li><a name="a2122"></a>&nbsp;</li>
<li><a name="a2123"></a>        <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$_max_index</span><span class="src-sym">) </span>&amp;&amp; <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">) </span>&gt; <span class="src-var">$_max_index</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2124"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">'$smarty' </span>. <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">''</span><span class="src-sym">, </span><span class="src-var">$indexes</span><span class="src-sym">) </span>.<span class="src-str">' is an invalid reference'</span><span class="src-sym">, </span><span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2125"></a>        <span class="src-sym">}</span></li>
<li><a name="a2126"></a>&nbsp;</li>
<li><a name="a2127"></a>        <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$indexes</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2128"></a>        <span class="src-key">return </span><span class="src-var">$compiled_ref</span><span class="src-sym">;</span></li>
<li><a name="a2129"></a>    <span class="src-sym">}</span></li>
<li><a name="a2130"></a>&nbsp;</li>
<li><a name="a2131"></a>    <span class="src-doc">/**</span></li>
<li><a name="a2132"></a><span class="src-doc">     * compiles call to plugin of type $type with name $name</span></li>
<li><a name="a2133"></a><span class="src-doc">     * returns a string containing the function-name or method call</span></li>
<li><a name="a2134"></a><span class="src-doc">     * without the paramter-list that would have follow to make the</span></li>
<li><a name="a2135"></a><span class="src-doc">     * call valid php-syntax</span></li>
<li><a name="a2136"></a><span class="src-doc">     *</span></li>
<li><a name="a2137"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$type </span></li>
<li><a name="a2138"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$name </span></li>
<li><a name="a2139"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a2140"></a><span class="src-doc">     */</span></li>
<li><a name="a2141"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_compile_plugin_call">_compile_plugin_call</a><span class="src-sym">(</span><span class="src-var">$type</span><span class="src-sym">, </span><span class="src-var">$name</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2142"></a>        <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a2143"></a>            <span class="src-comm">/* plugin loaded */</span></li>
<li><a name="a2144"></a>            <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/is_array">is_array</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a2145"></a>                <span class="src-key">return </span><span class="src-sym">((</span><a href="http://www.php.net/is_object">is_object</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">)) </span>?</li>
<li><a name="a2146"></a>                        <span class="src-str">&quot;</span><span class="src-str">\$<span class="src-id">this</span><span class="src-sym">-&gt;</span><span class="src-id">_plugins</span><span class="src-sym">[</span>'<span class="src-var">$type</span>'<span class="src-sym">]</span><span class="src-sym">[</span>'<span class="src-var">$name</span>'<span class="src-sym">]</span><span class="src-sym">[</span>0<span class="src-sym">]</span><span class="src-sym">[</span>0<span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-str">"</span>    </span><span class="src-comm">/* method callback */</span></li>
<li><a name="a2147"></a>                        : (string)<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">)</span>.<span class="src-str">'::'    </span><span class="src-comm">/* class callback */</span></li>
<li><a name="a2148"></a>                       <span class="src-sym">)</span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a2149"></a>&nbsp;</li>
<li><a name="a2150"></a>            <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a2151"></a>                <span class="src-comm">/* function callback */</span></li>
<li><a name="a2152"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a2153"></a>&nbsp;</li>
<li><a name="a2154"></a>            <span class="src-sym">}</span></li>
<li><a name="a2155"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a2156"></a>            <span class="src-comm">/* plugin not loaded -&gt; auto-loadable-plugin */</span></li>
<li><a name="a2157"></a>            <span class="src-key">return </span><span class="src-str">'smarty_'</span>.<span class="src-var">$type</span>.<span class="src-str">'_'</span>.<span class="src-var">$name</span><span class="src-sym">;</span></li>
<li><a name="a2158"></a>&nbsp;</li>
<li><a name="a2159"></a>        <span class="src-sym">}</span></li>
<li><a name="a2160"></a>    <span class="src-sym">}</span></li>
<li><a name="a2161"></a>&nbsp;</li>
<li><a name="a2162"></a>    <span class="src-doc">/**</span></li>
<li><a name="a2163"></a><span class="src-doc">     * load pre- and post-filters</span></li>
<li><a name="a2164"></a><span class="src-doc">     */</span></li>
<li><a name="a2165"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_load_filters">_load_filters</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a2166"></a>    <span class="src-sym">{</span></li>
<li><a name="a2167"></a>        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'prefilter'</span><span class="src-sym">]</span><span class="src-sym">) </span>&gt; <span class="src-num">0</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2168"></a>            <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'prefilter'</span><span class="src-sym">] </span><span class="src-key">as </span><span class="src-var">$filter_name </span>=&gt; <span class="src-var">$prefilter</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2169"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$prefilter </span>=== <span class="src-id">false</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2170"></a>                    unset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'prefilter'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$filter_name</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2171"></a>                    <span class="src-var">$_params </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'plugins' </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'prefilter'</span><span class="src-sym">, </span><span class="src-var">$filter_name</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a2172"></a>                    <span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-id"><a href="../lib/smarty/_smarty_Smarty_class_php.html#defineSMARTY_CORE_DIR">SMARTY_CORE_DIR</a> </span>. <span class="src-str">'core.load_plugins.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2173"></a>                    <a href="../Smarty/plugins/_smarty_internals_core_load_plugins_php.html#functionsmarty_core_load_plugins">smarty_core_load_plugins</a><span class="src-sym">(</span><span class="src-var">$_params</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2174"></a>                <span class="src-sym">}</span></li>
<li><a name="a2175"></a>            <span class="src-sym">}</span></li>
<li><a name="a2176"></a>        <span class="src-sym">}</span></li>
<li><a name="a2177"></a>        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'postfilter'</span><span class="src-sym">]</span><span class="src-sym">) </span>&gt; <span class="src-num">0</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2178"></a>            <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'postfilter'</span><span class="src-sym">] </span><span class="src-key">as </span><span class="src-var">$filter_name </span>=&gt; <span class="src-var">$postfilter</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2179"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$postfilter </span>=== <span class="src-id">false</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2180"></a>                    unset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-str">'postfilter'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$filter_name</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2181"></a>                    <span class="src-var">$_params </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'plugins' </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'postfilter'</span><span class="src-sym">, </span><span class="src-var">$filter_name</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a2182"></a>                    <span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-id"><a href="../lib/smarty/_smarty_Smarty_class_php.html#defineSMARTY_CORE_DIR">SMARTY_CORE_DIR</a> </span>. <span class="src-str">'core.load_plugins.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2183"></a>                    <a href="../Smarty/plugins/_smarty_internals_core_load_plugins_php.html#functionsmarty_core_load_plugins">smarty_core_load_plugins</a><span class="src-sym">(</span><span class="src-var">$_params</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2184"></a>                <span class="src-sym">}</span></li>
<li><a name="a2185"></a>            <span class="src-sym">}</span></li>
<li><a name="a2186"></a>        <span class="src-sym">}</span></li>
<li><a name="a2187"></a>    <span class="src-sym">}</span></li>
<li><a name="a2188"></a>&nbsp;</li>
<li><a name="a2189"></a>&nbsp;</li>
<li><a name="a2190"></a>    <span class="src-doc">/**</span></li>
<li><a name="a2191"></a><span class="src-doc">     * Quote subpattern references</span></li>
<li><a name="a2192"></a><span class="src-doc">     *</span></li>
<li><a name="a2193"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$string </span></li>
<li><a name="a2194"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a2195"></a><span class="src-doc">     */</span></li>
<li><a name="a2196"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_quote_replace">_quote_replace</a><span class="src-sym">(</span><span class="src-var">$string</span><span class="src-sym">)</span></li>
<li><a name="a2197"></a>    <span class="src-sym">{</span></li>
<li><a name="a2198"></a>        <span class="src-key">return </span><a href="http://www.php.net/strtr">strtr</a><span class="src-sym">(</span><span class="src-var">$string</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'\\' </span>=&gt; <span class="src-str">'\\\\'</span><span class="src-sym">, </span><span class="src-str">'$' </span>=&gt; <span class="src-str">'\\$'</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a2199"></a>    <span class="src-sym">}</span></li>
<li><a name="a2200"></a>&nbsp;</li>
<li><a name="a2201"></a>    <span class="src-doc">/**</span></li>
<li><a name="a2202"></a><span class="src-doc">     * display Smarty syntax error</span></li>
<li><a name="a2203"></a><span class="src-doc">     *</span></li>
<li><a name="a2204"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$error_msg </span></li>
<li><a name="a2205"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">integer </span><span class="src-doc-var">$error_type </span></li>
<li><a name="a2206"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$file </span></li>
<li><a name="a2207"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">integer </span><span class="src-doc-var">$line </span></li>
<li><a name="a2208"></a><span class="src-doc">     */</span></li>
<li><a name="a2209"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-var">$error_msg</span><span class="src-sym">, </span><span class="src-var">$error_type </span>= <span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span><span class="src-var">$file</span>=<span class="src-id">null</span><span class="src-sym">, </span><span class="src-var">$line</span>=<span class="src-id">null</span><span class="src-sym">)</span></li>
<li><a name="a2210"></a>    <span class="src-sym">{</span></li>
<li><a name="a2211"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_trigger_fatal_error</span><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">syntax</span> <span class="src-id">error</span>: <span class="src-var">$error_msg</span></span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_file</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_line_no</span><span class="src-sym">, </span><span class="src-var">$file</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">, </span><span class="src-var">$error_type</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2212"></a>    <span class="src-sym">}</span></li>
<li><a name="a2213"></a>&nbsp;</li>
<li><a name="a2214"></a>&nbsp;</li>
<li><a name="a2215"></a>    <span class="src-doc">/**</span></li>
<li><a name="a2216"></a><span class="src-doc">     * check if the compilation changes from cacheable to</span></li>
<li><a name="a2217"></a><span class="src-doc">     * non-cacheable state with the beginning of the current</span></li>
<li><a name="a2218"></a><span class="src-doc">     * plugin. return php-code to reflect the transition.</span></li>
<li><a name="a2219"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a2220"></a><span class="src-doc">     */</span></li>
<li><a name="a2221"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_push_cacheable_state">_push_cacheable_state</a><span class="src-sym">(</span><span class="src-var">$type</span><span class="src-sym">, </span><span class="src-var">$name</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2222"></a>        <span class="src-var">$_cacheable </span>= <span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">) </span>|| <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">4</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a2223"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_cacheable</span></li>
<li><a name="a2224"></a>            || <span class="src-num">0</span>&lt;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cacheable_state</span>++<span class="src-sym">) </span><span class="src-key">return </span><span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a2225"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cache_serial</span><span class="src-sym">)) </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cache_serial </span>= <a href="http://www.php.net/md5">md5</a><span class="src-sym">(</span><a href="http://www.php.net/uniqid">uniqid</a><span class="src-sym">(</span><span class="src-str">'Smarty'</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a2226"></a>        <span class="src-var">$_ret </span>= <span class="src-str">'if ($this-&gt;caching &amp;&amp; !$this-&gt;_cache_including) { echo \'{nocache:'</span></li>
<li><a name="a2227"></a>            . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cache_serial </span>. <span class="src-str">'#' </span>. <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_nocache_count</span></li>
<li><a name="a2228"></a>            . <span class="src-str">'}\';}'</span><span class="src-sym">;</span></li>
<li><a name="a2229"></a>        <span class="src-key">return </span><span class="src-var">$_ret</span><span class="src-sym">;</span></li>
<li><a name="a2230"></a>    <span class="src-sym">}</span></li>
<li><a name="a2231"></a>&nbsp;</li>
<li><a name="a2232"></a>&nbsp;</li>
<li><a name="a2233"></a>    <span class="src-doc">/**</span></li>
<li><a name="a2234"></a><span class="src-doc">     * check if the compilation changes from non-cacheable to</span></li>
<li><a name="a2235"></a><span class="src-doc">     * cacheable state with the end of the current plugin return</span></li>
<li><a name="a2236"></a><span class="src-doc">     * php-code to reflect the transition.</span></li>
<li><a name="a2237"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span></li>
<li><a name="a2238"></a><span class="src-doc">     */</span></li>
<li><a name="a2239"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_pop_cacheable_state">_pop_cacheable_state</a><span class="src-sym">(</span><span class="src-var">$type</span><span class="src-sym">, </span><span class="src-var">$name</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2240"></a>        <span class="src-var">$_cacheable </span>= <span class="src-sym">!</span>isset<span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">) </span>|| <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_plugins</span><span class="src-sym">[</span><span class="src-var">$type</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-num">4</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a2241"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_cacheable</span></li>
<li><a name="a2242"></a>            || --<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cacheable_state</span>&gt;<span class="src-num">0</span><span class="src-sym">) </span><span class="src-key">return </span><span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a2243"></a>        <span class="src-key">return </span><span class="src-str">'if ($this-&gt;caching &amp;&amp; !$this-&gt;_cache_including) { echo \'{/nocache:'</span></li>
<li><a name="a2244"></a>            . <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_cache_serial </span>. <span class="src-str">'#' </span>. <span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_nocache_count</span>++<span class="src-sym">)</span></li>
<li><a name="a2245"></a>            . <span class="src-str">'}\';}'</span><span class="src-sym">;</span></li>
<li><a name="a2246"></a>    <span class="src-sym">}</span></li>
<li><a name="a2247"></a>&nbsp;</li>
<li><a name="a2248"></a>&nbsp;</li>
<li><a name="a2249"></a>    <span class="src-doc">/**</span></li>
<li><a name="a2250"></a><span class="src-doc">     * push opening tag-name, file-name and line-number on the tag-stack</span></li>
<li><a name="a2251"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc">the opening tag's name</span></li>
<li><a name="a2252"></a><span class="src-doc">     */</span></li>
<li><a name="a2253"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_push_tag">_push_tag</a><span class="src-sym">(</span><span class="src-var">$open_tag</span><span class="src-sym">)</span></li>
<li><a name="a2254"></a>    <span class="src-sym">{</span></li>
<li><a name="a2255"></a>        <a href="http://www.php.net/array_push">array_push</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_tag_stack</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-var">$open_tag</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_current_line_no</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a2256"></a>    <span class="src-sym">}</span></li>
<li><a name="a2257"></a>&nbsp;</li>
<li><a name="a2258"></a>    <span class="src-doc">/**</span></li>
<li><a name="a2259"></a><span class="src-doc">     * pop closing tag-name</span></li>
<li><a name="a2260"></a><span class="src-doc">     * raise an error if this stack-top doesn't match with the closing tag</span></li>
<li><a name="a2261"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc">the closing tag's name</span></li>
<li><a name="a2262"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span><span class="src-doc">the opening tag's name</span></li>
<li><a name="a2263"></a><span class="src-doc">     */</span></li>
<li><a name="a2264"></a>    <span class="src-key">function </span><a href="../Smarty/Smarty_Compiler.html#method_pop_tag">_pop_tag</a><span class="src-sym">(</span><span class="src-var">$close_tag</span><span class="src-sym">)</span></li>
<li><a name="a2265"></a>    <span class="src-sym">{</span></li>
<li><a name="a2266"></a>        <span class="src-var">$message </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a2267"></a>        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_tag_stack</span><span class="src-sym">)</span>&gt;<span class="src-num">0</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2268"></a>            list<span class="src-sym">(</span><span class="src-var">$_open_tag</span><span class="src-sym">, </span><span class="src-var">$_line_no</span><span class="src-sym">) </span>= <a href="http://www.php.net/array_pop">array_pop</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_tag_stack</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2269"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$close_tag </span>== <span class="src-var">$_open_tag</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2270"></a>                <span class="src-key">return </span><span class="src-var">$_open_tag</span><span class="src-sym">;</span></li>
<li><a name="a2271"></a>            <span class="src-sym">}</span></li>
<li><a name="a2272"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$close_tag </span>== <span class="src-str">'if' </span>&amp;&amp; <span class="src-sym">(</span><span class="src-var">$_open_tag </span>== <span class="src-str">'else' </span>|| <span class="src-var">$_open_tag </span>== <span class="src-str">'elseif' </span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a2273"></a>                <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_pop_tag">_pop_tag</a><span class="src-sym">(</span><span class="src-var">$close_tag</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2274"></a>            <span class="src-sym">}</span></li>
<li><a name="a2275"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$close_tag </span>== <span class="src-str">'section' </span>&amp;&amp; <span class="src-var">$_open_tag </span>== <span class="src-str">'sectionelse'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2276"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_pop_tag">_pop_tag</a><span class="src-sym">(</span><span class="src-var">$close_tag</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2277"></a>                <span class="src-key">return </span><span class="src-var">$_open_tag</span><span class="src-sym">;</span></li>
<li><a name="a2278"></a>            <span class="src-sym">}</span></li>
<li><a name="a2279"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$close_tag </span>== <span class="src-str">'foreach' </span>&amp;&amp; <span class="src-var">$_open_tag </span>== <span class="src-str">'foreachelse'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2280"></a>                <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_pop_tag">_pop_tag</a><span class="src-sym">(</span><span class="src-var">$close_tag</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2281"></a>                <span class="src-key">return </span><span class="src-var">$_open_tag</span><span class="src-sym">;</span></li>
<li><a name="a2282"></a>            <span class="src-sym">}</span></li>
<li><a name="a2283"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$_open_tag </span>== <span class="src-str">'else' </span>|| <span class="src-var">$_open_tag </span>== <span class="src-str">'elseif'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2284"></a>                <span class="src-var">$_open_tag </span>= <span class="src-str">'if'</span><span class="src-sym">;</span></li>
<li><a name="a2285"></a>            <span class="src-sym">} </span><span class="src-key">elseif </span><span class="src-sym">(</span><span class="src-var">$_open_tag </span>== <span class="src-str">'sectionelse'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2286"></a>                <span class="src-var">$_open_tag </span>= <span class="src-str">'section'</span><span class="src-sym">;</span></li>
<li><a name="a2287"></a>            <span class="src-sym">} </span><span class="src-key">elseif </span><span class="src-sym">(</span><span class="src-var">$_open_tag </span>== <span class="src-str">'foreachelse'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a2288"></a>                <span class="src-var">$_open_tag </span>= <span class="src-str">'foreach'</span><span class="src-sym">;</span></li>
<li><a name="a2289"></a>            <span class="src-sym">}</span></li>
<li><a name="a2290"></a>            <span class="src-var">$message </span>= <span class="src-str">&quot;</span><span class="src-str"> <span class="src-id">expected</span> <span class="src-sym">{</span>/<span class="src-var">$_open_tag</span><span class="src-sym">}</span> (<span class="src-id">opened</span> <span class="src-id">line</span> <span class="src-var">$_line_no</span>).</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a2291"></a>        <span class="src-sym">}</span></li>
<li><a name="a2292"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Smarty/Smarty_Compiler.html#method_syntax_error">_syntax_error</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">mismatched</span> <span class="src-id">tag</span> <span class="src-sym">{</span>/<span class="src-var">$close_tag</span><span class="src-sym">}</span>.<span class="src-var">$message</span></span><span class="src-str">&quot;</span><span class="src-sym">,</span></li>
<li><a name="a2293"></a>                             <span class="src-id">E_USER_ERROR</span><span class="src-sym">, </span>__FILE__<span class="src-sym">, </span>__LINE__<span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a2294"></a>    <span class="src-sym">}</span></li>
<li><a name="a2295"></a>&nbsp;</li>
<li><a name="a2296"></a><span class="src-sym">}</span></li>
<li><a name="a2297"></a>&nbsp;</li>
<li><a name="a2298"></a><span class="src-doc">/**</span></li>
<li><a name="a2299"></a><span class="src-doc"> * compare to values by their string length</span></li>
<li><a name="a2300"></a><span class="src-doc"> *</span></li>
<li><a name="a2301"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@access</span><span class="src-doc"> private</span></li>
<li><a name="a2302"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$a </span></li>
<li><a name="a2303"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$b </span></li>
<li><a name="a2304"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@return </span>0<span class="src-doc">|</span><span class="src-doc-type">-1</span><span class="src-doc">|</span><span class="src-doc-type">1</span></li>
<li><a name="a2305"></a><span class="src-doc"> */</span></li>
<li><a name="a2306"></a><span class="src-key">function </span><span class="src-id">_smarty_sort_length</span><span class="src-sym">(</span><span class="src-var">$a</span><span class="src-sym">, </span><span class="src-var">$b</span><span class="src-sym">)</span></li>
<li><a name="a2307"></a><span class="src-sym">{</span></li>
<li><a name="a2308"></a>    <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$a </span>== <span class="src-var">$b</span><span class="src-sym">)</span></li>
<li><a name="a2309"></a>        <span class="src-key">return </span><span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a2310"></a>&nbsp;</li>
<li><a name="a2311"></a>    <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/strlen">strlen</a><span class="src-sym">(</span><span class="src-var">$a</span><span class="src-sym">) </span>== <a href="http://www.php.net/strlen">strlen</a><span class="src-sym">(</span><span class="src-var">$b</span><span class="src-sym">))</span></li>
<li><a name="a2312"></a>        <span class="src-key">return </span><span class="src-sym">(</span><span class="src-var">$a </span>&gt; <span class="src-var">$b</span><span class="src-sym">) </span>? -<span class="src-num">1 </span>: <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a2313"></a>&nbsp;</li>
<li><a name="a2314"></a>    <span class="src-key">return </span><span class="src-sym">(</span><a href="http://www.php.net/strlen">strlen</a><span class="src-sym">(</span><span class="src-var">$a</span><span class="src-sym">) </span>&gt; <a href="http://www.php.net/strlen">strlen</a><span class="src-sym">(</span><span class="src-var">$b</span><span class="src-sym">)) </span>? -<span class="src-num">1 </span>: <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a2315"></a><span class="src-sym">}</span></li>
<li><a name="a2316"></a>&nbsp;</li>
<li><a name="a2317"></a>&nbsp;</li>
<li><a name="a2318"></a><span class="src-comm">/* vim: set et: */</span></li>
<li><a name="a2319"></a>&nbsp;</li>
<li><a name="a2320"></a><span class="src-php">?&gt;</span></li>
</ol></pre>
</div>
	<p class="notes" id="credit">
		Documentation generated on Wed, 05 Aug 2009 07:41:10 +0000 by <a href="http://www.phpdoc.org" target="_blank">phpDocumentor 1.3.0RC3</a>
	</p>
	</body>
</html>